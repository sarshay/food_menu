{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_render_VectorContext_ from '../vectorcontext.js';\nimport _ol_transform_ from '../../transform.js';\nimport _ol_vec_Mat4_ from '../../vec/mat4.js';\nimport _ol_webgl_ from '../../webgl.js';\n/**\n * @constructor\n * @abstract\n * @extends {ol.render.VectorContext}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\n\nvar _ol_render_webgl_Replay_ = function (tolerance, maxExtent) {\n  _ol_render_VectorContext_.call(this);\n  /**\n   * @protected\n   * @type {number}\n   */\n\n\n  this.tolerance = tolerance;\n  /**\n   * @protected\n   * @const\n   * @type {ol.Extent}\n   */\n\n  this.maxExtent = maxExtent;\n  /**\n   * The origin of the coordinate system for the point coordinates sent to\n   * the GPU. To eliminate jitter caused by precision problems in the GPU\n   * we use the \"Rendering Relative to Eye\" technique described in the \"3D\n   * Engine Design for Virtual Globes\" book.\n   * @protected\n   * @type {ol.Coordinate}\n   */\n\n  this.origin = _ol_extent_.getCenter(maxExtent);\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n\n  this.projectionMatrix_ = _ol_transform_.create();\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n\n  this.offsetRotateMatrix_ = _ol_transform_.create();\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n\n  this.offsetScaleMatrix_ = _ol_transform_.create();\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n\n  this.tmpMat4_ = _ol_vec_Mat4_.create();\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n\n  this.indices = [];\n  /**\n   * @protected\n   * @type {?ol.webgl.Buffer}\n   */\n\n  this.indicesBuffer = null;\n  /**\n   * Start index per feature (the index).\n   * @protected\n   * @type {Array.<number>}\n   */\n\n  this.startIndices = [];\n  /**\n   * Start index per feature (the feature).\n   * @protected\n   * @type {Array.<ol.Feature|ol.render.Feature>}\n   */\n\n  this.startIndicesFeature = [];\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n\n  this.vertices = [];\n  /**\n   * @protected\n   * @type {?ol.webgl.Buffer}\n   */\n\n  this.verticesBuffer = null;\n  /**\n   * Optional parameter for PolygonReplay instances.\n   * @protected\n   * @type {ol.render.webgl.LineStringReplay|undefined}\n   */\n\n  this.lineStringReplay = undefined;\n};\n\n_ol_.inherits(_ol_render_webgl_Replay_, _ol_render_VectorContext_);\n/**\n * @abstract\n * @param {ol.webgl.Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\n\n\n_ol_render_webgl_Replay_.prototype.getDeleteResourcesFunction = function (context) {};\n/**\n * @abstract\n * @param {ol.webgl.Context} context Context.\n */\n\n\n_ol_render_webgl_Replay_.prototype.finish = function (context) {};\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @return {ol.render.webgl.circlereplay.defaultshader.Locations|\n            ol.render.webgl.linestringreplay.defaultshader.Locations|\n            ol.render.webgl.polygonreplay.defaultshader.Locations|\n            ol.render.webgl.texturereplay.defaultshader.Locations} Locations.\n */\n\n\n_ol_render_webgl_Replay_.prototype.setUpProgram = function (gl, context, size, pixelRatio) {};\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.render.webgl.circlereplay.defaultshader.Locations|\n           ol.render.webgl.linestringreplay.defaultshader.Locations|\n           ol.render.webgl.polygonreplay.defaultshader.Locations|\n           ol.render.webgl.texturereplay.defaultshader.Locations} locations Locations.\n */\n\n\n_ol_render_webgl_Replay_.prototype.shutDownProgram = function (gl, locations) {};\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {boolean} hitDetection Hit detection mode.\n */\n\n\n_ol_render_webgl_Replay_.prototype.drawReplay = function (gl, context, skippedFeaturesHash, hitDetection) {};\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayOneByOne = function (gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {};\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplay = function (gl, context, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\n  if (!oneByOne) {\n    // draw all hit-detection features in \"once\" (by texture group)\n    return this.drawHitDetectionReplayAll(gl, context, skippedFeaturesHash, featureCallback);\n  } else {\n    // draw hit-detection features one by one\n    return this.drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent);\n  }\n};\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayAll = function (gl, context, skippedFeaturesHash, featureCallback) {\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  this.drawReplay(gl, context, skippedFeaturesHash, true);\n  var result = featureCallback(null);\n\n  if (result) {\n    return result;\n  } else {\n    return undefined;\n  }\n};\n/**\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_Replay_.prototype.replay = function (context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\n  var gl = context.getGL();\n  var tmpStencil, tmpStencilFunc, tmpStencilMaskVal, tmpStencilRef, tmpStencilMask, tmpStencilOpFail, tmpStencilOpPass, tmpStencilOpZFail;\n\n  if (this.lineStringReplay) {\n    tmpStencil = gl.isEnabled(gl.STENCIL_TEST);\n    tmpStencilFunc = gl.getParameter(gl.STENCIL_FUNC);\n    tmpStencilMaskVal = gl.getParameter(gl.STENCIL_VALUE_MASK);\n    tmpStencilRef = gl.getParameter(gl.STENCIL_REF);\n    tmpStencilMask = gl.getParameter(gl.STENCIL_WRITEMASK);\n    tmpStencilOpFail = gl.getParameter(gl.STENCIL_FAIL);\n    tmpStencilOpPass = gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS);\n    tmpStencilOpZFail = gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL);\n    gl.enable(gl.STENCIL_TEST);\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilMask(255);\n    gl.stencilFunc(gl.ALWAYS, 1, 255);\n    gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\n    this.lineStringReplay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);\n    gl.stencilMask(0);\n    gl.stencilFunc(gl.NOTEQUAL, 1, 255);\n  }\n\n  context.bindBuffer(_ol_webgl_.ARRAY_BUFFER, this.verticesBuffer);\n  context.bindBuffer(_ol_webgl_.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n  var locations = this.setUpProgram(gl, context, size, pixelRatio); // set the \"uniform\" values\n\n  var projectionMatrix = _ol_transform_.reset(this.projectionMatrix_);\n\n  _ol_transform_.scale(projectionMatrix, 2 / (resolution * size[0]), 2 / (resolution * size[1]));\n\n  _ol_transform_.rotate(projectionMatrix, -rotation);\n\n  _ol_transform_.translate(projectionMatrix, -(center[0] - this.origin[0]), -(center[1] - this.origin[1]));\n\n  var offsetScaleMatrix = _ol_transform_.reset(this.offsetScaleMatrix_);\n\n  _ol_transform_.scale(offsetScaleMatrix, 2 / size[0], 2 / size[1]);\n\n  var offsetRotateMatrix = _ol_transform_.reset(this.offsetRotateMatrix_);\n\n  if (rotation !== 0) {\n    _ol_transform_.rotate(offsetRotateMatrix, -rotation);\n  }\n\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false, _ol_vec_Mat4_.fromTransform(this.tmpMat4_, projectionMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetScaleMatrix, false, _ol_vec_Mat4_.fromTransform(this.tmpMat4_, offsetScaleMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetRotateMatrix, false, _ol_vec_Mat4_.fromTransform(this.tmpMat4_, offsetRotateMatrix));\n  gl.uniform1f(locations.u_opacity, opacity); // draw!\n\n  var result;\n\n  if (featureCallback === undefined) {\n    this.drawReplay(gl, context, skippedFeaturesHash, false);\n  } else {\n    // draw feature by feature for the hit-detection\n    result = this.drawHitDetectionReplay(gl, context, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);\n  } // disable the vertex attrib arrays\n\n\n  this.shutDownProgram(gl, locations);\n\n  if (this.lineStringReplay) {\n    if (!tmpStencil) {\n      gl.disable(gl.STENCIL_TEST);\n    }\n\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilFunc(\n    /** @type {number} */\n    tmpStencilFunc,\n    /** @type {number} */\n    tmpStencilRef,\n    /** @type {number} */\n    tmpStencilMaskVal);\n    gl.stencilMask(\n    /** @type {number} */\n    tmpStencilMask);\n    gl.stencilOp(\n    /** @type {number} */\n    tmpStencilOpFail,\n    /** @type {number} */\n    tmpStencilOpZFail,\n    /** @type {number} */\n    tmpStencilOpPass);\n  }\n\n  return result;\n};\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {number} start Start index.\n * @param {number} end End index.\n */\n\n\n_ol_render_webgl_Replay_.prototype.drawElements = function (gl, context, start, end) {\n  var elementType = context.hasOESElementIndexUint ? _ol_webgl_.UNSIGNED_INT : _ol_webgl_.UNSIGNED_SHORT;\n  var elementSize = context.hasOESElementIndexUint ? 4 : 2;\n  var numItems = end - start;\n  var offsetInBytes = start * elementSize;\n  gl.drawElements(_ol_webgl_.TRIANGLES, numItems, elementType, offsetInBytes);\n};\n\nexport default _ol_render_webgl_Replay_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/render/webgl/replay.js"],"names":["_ol_","_ol_extent_","_ol_render_VectorContext_","_ol_transform_","_ol_vec_Mat4_","_ol_webgl_","_ol_render_webgl_Replay_","tolerance","maxExtent","call","origin","getCenter","projectionMatrix_","create","offsetRotateMatrix_","offsetScaleMatrix_","tmpMat4_","indices","indicesBuffer","startIndices","startIndicesFeature","vertices","verticesBuffer","lineStringReplay","undefined","inherits","prototype","getDeleteResourcesFunction","context","finish","setUpProgram","gl","size","pixelRatio","shutDownProgram","locations","drawReplay","skippedFeaturesHash","hitDetection","drawHitDetectionReplayOneByOne","featureCallback","opt_hitExtent","drawHitDetectionReplay","oneByOne","drawHitDetectionReplayAll","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","result","replay","center","resolution","rotation","opacity","getGL","tmpStencil","tmpStencilFunc","tmpStencilMaskVal","tmpStencilRef","tmpStencilMask","tmpStencilOpFail","tmpStencilOpPass","tmpStencilOpZFail","isEnabled","STENCIL_TEST","getParameter","STENCIL_FUNC","STENCIL_VALUE_MASK","STENCIL_REF","STENCIL_WRITEMASK","STENCIL_FAIL","STENCIL_PASS_DEPTH_PASS","STENCIL_PASS_DEPTH_FAIL","enable","STENCIL_BUFFER_BIT","stencilMask","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","NOTEQUAL","bindBuffer","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","projectionMatrix","reset","scale","rotate","translate","offsetScaleMatrix","offsetRotateMatrix","uniformMatrix4fv","u_projectionMatrix","fromTransform","u_offsetScaleMatrix","u_offsetRotateMatrix","uniform1f","u_opacity","disable","drawElements","start","end","elementType","hasOESElementIndexUint","UNSIGNED_INT","UNSIGNED_SHORT","elementSize","numItems","offsetInBytes","TRIANGLES"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_render_VectorContext_ from '../vectorcontext.js';\nimport _ol_transform_ from '../../transform.js';\nimport _ol_vec_Mat4_ from '../../vec/mat4.js';\nimport _ol_webgl_ from '../../webgl.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {ol.render.VectorContext}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\nvar _ol_render_webgl_Replay_ = function(tolerance, maxExtent) {\n  _ol_render_VectorContext_.call(this);\n\n  /**\n   * @protected\n   * @type {number}\n   */\n  this.tolerance = tolerance;\n\n  /**\n   * @protected\n   * @const\n   * @type {ol.Extent}\n   */\n  this.maxExtent = maxExtent;\n\n  /**\n   * The origin of the coordinate system for the point coordinates sent to\n   * the GPU. To eliminate jitter caused by precision problems in the GPU\n   * we use the \"Rendering Relative to Eye\" technique described in the \"3D\n   * Engine Design for Virtual Globes\" book.\n   * @protected\n   * @type {ol.Coordinate}\n   */\n  this.origin = _ol_extent_.getCenter(maxExtent);\n\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n  this.projectionMatrix_ = _ol_transform_.create();\n\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n  this.offsetRotateMatrix_ = _ol_transform_.create();\n\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n  this.offsetScaleMatrix_ = _ol_transform_.create();\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.tmpMat4_ = _ol_vec_Mat4_.create();\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.indices = [];\n\n  /**\n   * @protected\n   * @type {?ol.webgl.Buffer}\n   */\n  this.indicesBuffer = null;\n\n  /**\n   * Start index per feature (the index).\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.startIndices = [];\n\n  /**\n   * Start index per feature (the feature).\n   * @protected\n   * @type {Array.<ol.Feature|ol.render.Feature>}\n   */\n  this.startIndicesFeature = [];\n\n  /**\n   * @protected\n   * @type {Array.<number>}\n   */\n  this.vertices = [];\n\n  /**\n   * @protected\n   * @type {?ol.webgl.Buffer}\n   */\n  this.verticesBuffer = null;\n\n  /**\n   * Optional parameter for PolygonReplay instances.\n   * @protected\n   * @type {ol.render.webgl.LineStringReplay|undefined}\n   */\n  this.lineStringReplay = undefined;\n\n};\n\n_ol_.inherits(_ol_render_webgl_Replay_, _ol_render_VectorContext_);\n\n\n/**\n * @abstract\n * @param {ol.webgl.Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\n_ol_render_webgl_Replay_.prototype.getDeleteResourcesFunction = function(context) {};\n\n\n/**\n * @abstract\n * @param {ol.webgl.Context} context Context.\n */\n_ol_render_webgl_Replay_.prototype.finish = function(context) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @return {ol.render.webgl.circlereplay.defaultshader.Locations|\n            ol.render.webgl.linestringreplay.defaultshader.Locations|\n            ol.render.webgl.polygonreplay.defaultshader.Locations|\n            ol.render.webgl.texturereplay.defaultshader.Locations} Locations.\n */\n_ol_render_webgl_Replay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.render.webgl.circlereplay.defaultshader.Locations|\n           ol.render.webgl.linestringreplay.defaultshader.Locations|\n           ol.render.webgl.polygonreplay.defaultshader.Locations|\n           ol.render.webgl.texturereplay.defaultshader.Locations} locations Locations.\n */\n_ol_render_webgl_Replay_.prototype.shutDownProgram = function(gl, locations) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {boolean} hitDetection Hit detection mode.\n */\n_ol_render_webgl_Replay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {};\n\n\n/**\n * @abstract\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {};\n\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplay = function(gl, context, skippedFeaturesHash,\n    featureCallback, oneByOne, opt_hitExtent) {\n  if (!oneByOne) {\n    // draw all hit-detection features in \"once\" (by texture group)\n    return this.drawHitDetectionReplayAll(gl, context,\n        skippedFeaturesHash, featureCallback);\n  } else {\n    // draw hit-detection features one by one\n    return this.drawHitDetectionReplayOneByOne(gl, context,\n        skippedFeaturesHash, featureCallback, opt_hitExtent);\n  }\n};\n\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_Replay_.prototype.drawHitDetectionReplayAll = function(gl, context, skippedFeaturesHash,\n    featureCallback) {\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n  this.drawReplay(gl, context, skippedFeaturesHash, true);\n\n  var result = featureCallback(null);\n  if (result) {\n    return result;\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_Replay_.prototype.replay = function(context,\n    center, resolution, rotation, size, pixelRatio,\n    opacity, skippedFeaturesHash,\n    featureCallback, oneByOne, opt_hitExtent) {\n  var gl = context.getGL();\n  var tmpStencil, tmpStencilFunc, tmpStencilMaskVal, tmpStencilRef, tmpStencilMask,\n      tmpStencilOpFail, tmpStencilOpPass, tmpStencilOpZFail;\n\n  if (this.lineStringReplay) {\n    tmpStencil = gl.isEnabled(gl.STENCIL_TEST);\n    tmpStencilFunc = gl.getParameter(gl.STENCIL_FUNC);\n    tmpStencilMaskVal = gl.getParameter(gl.STENCIL_VALUE_MASK);\n    tmpStencilRef = gl.getParameter(gl.STENCIL_REF);\n    tmpStencilMask = gl.getParameter(gl.STENCIL_WRITEMASK);\n    tmpStencilOpFail = gl.getParameter(gl.STENCIL_FAIL);\n    tmpStencilOpPass = gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS);\n    tmpStencilOpZFail = gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL);\n\n    gl.enable(gl.STENCIL_TEST);\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilMask(255);\n    gl.stencilFunc(gl.ALWAYS, 1, 255);\n    gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\n\n    this.lineStringReplay.replay(context,\n        center, resolution, rotation, size, pixelRatio,\n        opacity, skippedFeaturesHash,\n        featureCallback, oneByOne, opt_hitExtent);\n\n    gl.stencilMask(0);\n    gl.stencilFunc(gl.NOTEQUAL, 1, 255);\n  }\n\n  context.bindBuffer(_ol_webgl_.ARRAY_BUFFER, this.verticesBuffer);\n\n  context.bindBuffer(_ol_webgl_.ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\n\n  var locations = this.setUpProgram(gl, context, size, pixelRatio);\n\n  // set the \"uniform\" values\n  var projectionMatrix = _ol_transform_.reset(this.projectionMatrix_);\n  _ol_transform_.scale(projectionMatrix, 2 / (resolution * size[0]), 2 / (resolution * size[1]));\n  _ol_transform_.rotate(projectionMatrix, -rotation);\n  _ol_transform_.translate(projectionMatrix, -(center[0] - this.origin[0]), -(center[1] - this.origin[1]));\n\n  var offsetScaleMatrix = _ol_transform_.reset(this.offsetScaleMatrix_);\n  _ol_transform_.scale(offsetScaleMatrix, 2 / size[0], 2 / size[1]);\n\n  var offsetRotateMatrix = _ol_transform_.reset(this.offsetRotateMatrix_);\n  if (rotation !== 0) {\n    _ol_transform_.rotate(offsetRotateMatrix, -rotation);\n  }\n\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false,\n      _ol_vec_Mat4_.fromTransform(this.tmpMat4_, projectionMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetScaleMatrix, false,\n      _ol_vec_Mat4_.fromTransform(this.tmpMat4_, offsetScaleMatrix));\n  gl.uniformMatrix4fv(locations.u_offsetRotateMatrix, false,\n      _ol_vec_Mat4_.fromTransform(this.tmpMat4_, offsetRotateMatrix));\n  gl.uniform1f(locations.u_opacity, opacity);\n\n  // draw!\n  var result;\n  if (featureCallback === undefined) {\n    this.drawReplay(gl, context, skippedFeaturesHash, false);\n  } else {\n    // draw feature by feature for the hit-detection\n    result = this.drawHitDetectionReplay(gl, context, skippedFeaturesHash,\n        featureCallback, oneByOne, opt_hitExtent);\n  }\n\n  // disable the vertex attrib arrays\n  this.shutDownProgram(gl, locations);\n\n  if (this.lineStringReplay) {\n    if (!tmpStencil) {\n      gl.disable(gl.STENCIL_TEST);\n    }\n    gl.clear(gl.STENCIL_BUFFER_BIT);\n    gl.stencilFunc(/** @type {number} */ (tmpStencilFunc),\n        /** @type {number} */ (tmpStencilRef), /** @type {number} */ (tmpStencilMaskVal));\n    gl.stencilMask(/** @type {number} */ (tmpStencilMask));\n    gl.stencilOp(/** @type {number} */ (tmpStencilOpFail),\n        /** @type {number} */ (tmpStencilOpZFail), /** @type {number} */ (tmpStencilOpPass));\n  }\n\n  return result;\n};\n\n/**\n * @protected\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {number} start Start index.\n * @param {number} end End index.\n */\n_ol_render_webgl_Replay_.prototype.drawElements = function(\n    gl, context, start, end) {\n  var elementType = context.hasOESElementIndexUint ?\n    _ol_webgl_.UNSIGNED_INT : _ol_webgl_.UNSIGNED_SHORT;\n  var elementSize = context.hasOESElementIndexUint ? 4 : 2;\n\n  var numItems = end - start;\n  var offsetInBytes = start * elementSize;\n  gl.drawElements(_ol_webgl_.TRIANGLES, numItems, elementType, offsetInBytes);\n};\nexport default _ol_render_webgl_Replay_;\n"]},"metadata":{},"sourceType":"module"}