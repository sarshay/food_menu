{"ast":null,"code":"// FIXME check against gl.getParameter(webgl.MAX_TEXTURE_SIZE)\nimport _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_css_ from '../../css.js';\nimport _ol_dom_ from '../../dom.js';\nimport _ol_events_ from '../../events.js';\nimport _ol_has_ from '../../has.js';\nimport _ol_layer_Layer_ from '../../layer/layer.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_webgl_Immediate_ from '../../render/webgl/immediate.js';\nimport _ol_renderer_Map_ from '../map.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_source_State_ from '../../source/state.js';\nimport _ol_structs_LRUCache_ from '../../structs/lrucache.js';\nimport _ol_structs_PriorityQueue_ from '../../structs/priorityqueue.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Context_ from '../../webgl/context.js';\nimport _ol_webgl_ContextEventType_ from '../../webgl/contexteventtype.js';\n/**\n * @constructor\n * @extends {ol.renderer.Map}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @api\n */\n\nvar _ol_renderer_webgl_Map_ = function (container, map) {\n  _ol_renderer_Map_.call(this, container, map);\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n\n\n  this.canvas_ =\n  /** @type {HTMLCanvasElement} */\n  document.createElement('CANVAS');\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = _ol_css_.CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n  /**\n   * @private\n   * @type {number}\n   */\n\n  this.clipTileCanvasWidth_ = 0;\n  /**\n   * @private\n   * @type {number}\n   */\n\n  this.clipTileCanvasHeight_ = 0;\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n\n  this.clipTileContext_ = _ol_dom_.createCanvasContext2D();\n  /**\n   * @private\n   * @type {boolean}\n   */\n\n  this.renderedVisible_ = true;\n  /**\n   * @private\n   * @type {WebGLRenderingContext}\n   */\n\n  this.gl_ = _ol_webgl_.getContext(this.canvas_, {\n    antialias: true,\n    depth: true,\n    failIfMajorPerformanceCaveat: true,\n    preserveDrawingBuffer: false,\n    stencil: true\n  });\n  /**\n   * @private\n   * @type {ol.webgl.Context}\n   */\n\n  this.context_ = new _ol_webgl_Context_(this.canvas_, this.gl_);\n\n  _ol_events_.listen(this.canvas_, _ol_webgl_ContextEventType_.LOST, this.handleWebGLContextLost, this);\n\n  _ol_events_.listen(this.canvas_, _ol_webgl_ContextEventType_.RESTORED, this.handleWebGLContextRestored, this);\n  /**\n   * @private\n   * @type {ol.structs.LRUCache.<ol.WebglTextureCacheEntry|null>}\n   */\n\n\n  this.textureCache_ = new _ol_structs_LRUCache_();\n  /**\n   * @private\n   * @type {ol.Coordinate}\n   */\n\n  this.focus_ = null;\n  /**\n   * @private\n   * @type {ol.structs.PriorityQueue.<Array>}\n   */\n\n  this.tileTextureQueue_ = new _ol_structs_PriorityQueue_(\n  /**\n   * @param {Array.<*>} element Element.\n   * @return {number} Priority.\n   * @this {ol.renderer.webgl.Map}\n   */\n  function (element) {\n    var tileCenter =\n    /** @type {ol.Coordinate} */\n    element[1];\n    var tileResolution =\n    /** @type {number} */\n    element[2];\n    var deltaX = tileCenter[0] - this.focus_[0];\n    var deltaY = tileCenter[1] - this.focus_[1];\n    return 65536 * Math.log(tileResolution) + Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n  }.bind(this),\n  /**\n   * @param {Array.<*>} element Element.\n   * @return {string} Key.\n   */\n  function (element) {\n    return (\n      /** @type {ol.Tile} */\n      element[0].getKey()\n    );\n  });\n  /**\n   * @param {ol.PluggableMap} map Map.\n   * @param {?olx.FrameState} frameState Frame state.\n   * @return {boolean} false.\n   * @this {ol.renderer.webgl.Map}\n   */\n\n  this.loadNextTileTexture_ = function (map, frameState) {\n    if (!this.tileTextureQueue_.isEmpty()) {\n      this.tileTextureQueue_.reprioritize();\n      var element = this.tileTextureQueue_.dequeue();\n      var tile =\n      /** @type {ol.Tile} */\n      element[0];\n      var tileSize =\n      /** @type {ol.Size} */\n      element[3];\n      var tileGutter =\n      /** @type {number} */\n      element[4];\n      this.bindTileTexture(tile, tileSize, tileGutter, _ol_webgl_.LINEAR, _ol_webgl_.LINEAR);\n    }\n\n    return false;\n  }.bind(this);\n  /**\n   * @private\n   * @type {number}\n   */\n\n\n  this.textureCacheFrameMarkerCount_ = 0;\n  this.initializeGL_();\n};\n\n_ol_.inherits(_ol_renderer_webgl_Map_, _ol_renderer_Map_);\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @return {boolean} The renderer can render the layer.\n */\n\n\n_ol_renderer_webgl_Map_['handles'] = function (type) {\n  return _ol_has_.WEBGL && type === _ol_renderer_Type_.WEBGL;\n};\n/**\n * Create the map renderer.\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @return {ol.renderer.webgl.Map} The map renderer.\n */\n\n\n_ol_renderer_webgl_Map_['create'] = function (container, map) {\n  return new _ol_renderer_webgl_Map_(container, map);\n};\n/**\n * @param {ol.Tile} tile Tile.\n * @param {ol.Size} tileSize Tile size.\n * @param {number} tileGutter Tile gutter.\n * @param {number} magFilter Mag filter.\n * @param {number} minFilter Min filter.\n */\n\n\n_ol_renderer_webgl_Map_.prototype.bindTileTexture = function (tile, tileSize, tileGutter, magFilter, minFilter) {\n  var gl = this.getGL();\n  var tileKey = tile.getKey();\n\n  if (this.textureCache_.containsKey(tileKey)) {\n    var textureCacheEntry = this.textureCache_.get(tileKey);\n    gl.bindTexture(_ol_webgl_.TEXTURE_2D, textureCacheEntry.texture);\n\n    if (textureCacheEntry.magFilter != magFilter) {\n      gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MAG_FILTER, magFilter);\n      textureCacheEntry.magFilter = magFilter;\n    }\n\n    if (textureCacheEntry.minFilter != minFilter) {\n      gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MIN_FILTER, minFilter);\n      textureCacheEntry.minFilter = minFilter;\n    }\n  } else {\n    var texture = gl.createTexture();\n    gl.bindTexture(_ol_webgl_.TEXTURE_2D, texture);\n\n    if (tileGutter > 0) {\n      var clipTileCanvas = this.clipTileContext_.canvas;\n      var clipTileContext = this.clipTileContext_;\n\n      if (this.clipTileCanvasWidth_ !== tileSize[0] || this.clipTileCanvasHeight_ !== tileSize[1]) {\n        clipTileCanvas.width = tileSize[0];\n        clipTileCanvas.height = tileSize[1];\n        this.clipTileCanvasWidth_ = tileSize[0];\n        this.clipTileCanvasHeight_ = tileSize[1];\n      } else {\n        clipTileContext.clearRect(0, 0, tileSize[0], tileSize[1]);\n      }\n\n      clipTileContext.drawImage(tile.getImage(), tileGutter, tileGutter, tileSize[0], tileSize[1], 0, 0, tileSize[0], tileSize[1]);\n      gl.texImage2D(_ol_webgl_.TEXTURE_2D, 0, _ol_webgl_.RGBA, _ol_webgl_.RGBA, _ol_webgl_.UNSIGNED_BYTE, clipTileCanvas);\n    } else {\n      gl.texImage2D(_ol_webgl_.TEXTURE_2D, 0, _ol_webgl_.RGBA, _ol_webgl_.RGBA, _ol_webgl_.UNSIGNED_BYTE, tile.getImage());\n    }\n\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MAG_FILTER, magFilter);\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_WRAP_S, _ol_webgl_.CLAMP_TO_EDGE);\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_WRAP_T, _ol_webgl_.CLAMP_TO_EDGE);\n    this.textureCache_.set(tileKey, {\n      texture: texture,\n      magFilter: magFilter,\n      minFilter: minFilter\n    });\n  }\n};\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n\n_ol_renderer_webgl_Map_.prototype.dispatchComposeEvent_ = function (type, frameState) {\n  var map = this.getMap();\n\n  if (map.hasListener(type)) {\n    var context = this.context_;\n    var extent = frameState.extent;\n    var size = frameState.size;\n    var viewState = frameState.viewState;\n    var pixelRatio = frameState.pixelRatio;\n    var resolution = viewState.resolution;\n    var center = viewState.center;\n    var rotation = viewState.rotation;\n    var vectorContext = new _ol_render_webgl_Immediate_(context, center, resolution, rotation, size, extent, pixelRatio);\n    var composeEvent = new _ol_render_Event_(type, vectorContext, frameState, null, context);\n    map.dispatchEvent(composeEvent);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.disposeInternal = function () {\n  var gl = this.getGL();\n\n  if (!gl.isContextLost()) {\n    this.textureCache_.forEach(\n    /**\n     * @param {?ol.WebglTextureCacheEntry} textureCacheEntry\n     *     Texture cache entry.\n     */\n    function (textureCacheEntry) {\n      if (textureCacheEntry) {\n        gl.deleteTexture(textureCacheEntry.texture);\n      }\n    });\n  }\n\n  this.context_.dispose();\n\n  _ol_renderer_Map_.prototype.disposeInternal.call(this);\n};\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n\n_ol_renderer_webgl_Map_.prototype.expireCache_ = function (map, frameState) {\n  var gl = this.getGL();\n  var textureCacheEntry;\n\n  while (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ > _ol_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    textureCacheEntry = this.textureCache_.peekLast();\n\n    if (!textureCacheEntry) {\n      if (+this.textureCache_.peekLastKey() == frameState.index) {\n        break;\n      } else {\n        --this.textureCacheFrameMarkerCount_;\n      }\n    } else {\n      gl.deleteTexture(textureCacheEntry.texture);\n    }\n\n    this.textureCache_.pop();\n  }\n};\n/**\n * @return {ol.webgl.Context} The context.\n */\n\n\n_ol_renderer_webgl_Map_.prototype.getContext = function () {\n  return this.context_;\n};\n/**\n * @return {WebGLRenderingContext} GL.\n */\n\n\n_ol_renderer_webgl_Map_.prototype.getGL = function () {\n  return this.gl_;\n};\n/**\n * @return {ol.structs.PriorityQueue.<Array>} Tile texture queue.\n */\n\n\n_ol_renderer_webgl_Map_.prototype.getTileTextureQueue = function () {\n  return this.tileTextureQueue_;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.getType = function () {\n  return _ol_renderer_Type_.WEBGL;\n};\n/**\n * @param {ol.events.Event} event Event.\n * @protected\n */\n\n\n_ol_renderer_webgl_Map_.prototype.handleWebGLContextLost = function (event) {\n  event.preventDefault();\n  this.textureCache_.clear();\n  this.textureCacheFrameMarkerCount_ = 0;\n  var renderers = this.getLayerRenderers();\n\n  for (var id in renderers) {\n    var renderer =\n    /** @type {ol.renderer.webgl.Layer} */\n    renderers[id];\n    renderer.handleWebGLContextLost();\n  }\n};\n/**\n * @protected\n */\n\n\n_ol_renderer_webgl_Map_.prototype.handleWebGLContextRestored = function () {\n  this.initializeGL_();\n  this.getMap().render();\n};\n/**\n * @private\n */\n\n\n_ol_renderer_webgl_Map_.prototype.initializeGL_ = function () {\n  var gl = this.gl_;\n  gl.activeTexture(_ol_webgl_.TEXTURE0);\n  gl.blendFuncSeparate(_ol_webgl_.SRC_ALPHA, _ol_webgl_.ONE_MINUS_SRC_ALPHA, _ol_webgl_.ONE, _ol_webgl_.ONE_MINUS_SRC_ALPHA);\n  gl.disable(_ol_webgl_.CULL_FACE);\n  gl.disable(_ol_webgl_.DEPTH_TEST);\n  gl.disable(_ol_webgl_.SCISSOR_TEST);\n  gl.disable(_ol_webgl_.STENCIL_TEST);\n};\n/**\n * @param {ol.Tile} tile Tile.\n * @return {boolean} Is tile texture loaded.\n */\n\n\n_ol_renderer_webgl_Map_.prototype.isTileTextureLoaded = function (tile) {\n  return this.textureCache_.containsKey(tile.getKey());\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.renderFrame = function (frameState) {\n  var context = this.getContext();\n  var gl = this.getGL();\n\n  if (gl.isContextLost()) {\n    return false;\n  }\n\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n\n    return false;\n  }\n\n  this.focus_ = frameState.focus;\n  this.textureCache_.set((-frameState.index).toString(), null);\n  ++this.textureCacheFrameMarkerCount_;\n  this.dispatchComposeEvent_(_ol_render_EventType_.PRECOMPOSE, frameState);\n  /** @type {Array.<ol.LayerState>} */\n\n  var layerStatesToDraw = [];\n  var layerStatesArray = frameState.layerStatesArray;\n\n  _ol_array_.stableSort(layerStatesArray, _ol_renderer_Map_.sortByZIndex);\n\n  var viewResolution = frameState.viewState.resolution;\n  var i, ii, layerRenderer, layerState;\n\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) && layerState.sourceState == _ol_source_State_.READY) {\n      layerRenderer =\n      /** @type {ol.renderer.webgl.Layer} */\n      this.getLayerRenderer(layerState.layer);\n\n      if (layerRenderer.prepareFrame(frameState, layerState, context)) {\n        layerStatesToDraw.push(layerState);\n      }\n    }\n  }\n\n  var width = frameState.size[0] * frameState.pixelRatio;\n  var height = frameState.size[1] * frameState.pixelRatio;\n\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  }\n\n  gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, null);\n  gl.clearColor(0, 0, 0, 0);\n  gl.clear(_ol_webgl_.COLOR_BUFFER_BIT);\n  gl.enable(_ol_webgl_.BLEND);\n  gl.viewport(0, 0, this.canvas_.width, this.canvas_.height);\n\n  for (i = 0, ii = layerStatesToDraw.length; i < ii; ++i) {\n    layerState = layerStatesToDraw[i];\n    layerRenderer =\n    /** @type {ol.renderer.webgl.Layer} */\n    this.getLayerRenderer(layerState.layer);\n    layerRenderer.composeFrame(frameState, layerState, context);\n  }\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.calculateMatrices2D(frameState);\n\n  if (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ > _ol_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    frameState.postRenderFunctions.push(\n    /** @type {ol.PostRenderFunction} */\n    this.expireCache_.bind(this));\n  }\n\n  if (!this.tileTextureQueue_.isEmpty()) {\n    frameState.postRenderFunctions.push(this.loadNextTileTexture_);\n    frameState.animate = true;\n  }\n\n  this.dispatchComposeEvent_(_ol_render_EventType_.POSTCOMPOSE, frameState);\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, thisArg, layerFilter, thisArg2) {\n  var result;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg2, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n      result = layerRenderer.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);\n\n      if (result) {\n        return result;\n      }\n    }\n  }\n\n  return undefined;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.hasFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  var hasFeature = false;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n      hasFeature = layerRenderer.hasFeatureAtCoordinate(coordinate, frameState);\n\n      if (hasFeature) {\n        return true;\n      }\n    }\n  }\n\n  return hasFeature;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_Map_.prototype.forEachLayerAtPixel = function (pixel, frameState, callback, thisArg, layerFilter, thisArg2) {\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n  var result;\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) && layerFilter.call(thisArg, layer)) {\n      var layerRenderer =\n      /** @type {ol.renderer.webgl.Layer} */\n      this.getLayerRenderer(layer);\n      result = layerRenderer.forEachLayerAtPixel(pixel, frameState, callback, thisArg);\n\n      if (result) {\n        return result;\n      }\n    }\n  }\n\n  return undefined;\n};\n\nexport default _ol_renderer_webgl_Map_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/webgl/map.js"],"names":["_ol_","_ol_array_","_ol_css_","_ol_dom_","_ol_events_","_ol_has_","_ol_layer_Layer_","_ol_render_Event_","_ol_render_EventType_","_ol_render_webgl_Immediate_","_ol_renderer_Map_","_ol_renderer_Type_","_ol_source_State_","_ol_structs_LRUCache_","_ol_structs_PriorityQueue_","_ol_webgl_","_ol_webgl_Context_","_ol_webgl_ContextEventType_","_ol_renderer_webgl_Map_","container","map","call","canvas_","document","createElement","style","width","height","display","className","CLASS_UNSELECTABLE","insertBefore","childNodes","clipTileCanvasWidth_","clipTileCanvasHeight_","clipTileContext_","createCanvasContext2D","renderedVisible_","gl_","getContext","antialias","depth","failIfMajorPerformanceCaveat","preserveDrawingBuffer","stencil","context_","listen","LOST","handleWebGLContextLost","RESTORED","handleWebGLContextRestored","textureCache_","focus_","tileTextureQueue_","element","tileCenter","tileResolution","deltaX","deltaY","Math","log","sqrt","bind","getKey","loadNextTileTexture_","frameState","isEmpty","reprioritize","dequeue","tile","tileSize","tileGutter","bindTileTexture","LINEAR","textureCacheFrameMarkerCount_","initializeGL_","inherits","type","WEBGL","prototype","magFilter","minFilter","gl","getGL","tileKey","containsKey","textureCacheEntry","get","bindTexture","TEXTURE_2D","texture","texParameteri","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","createTexture","clipTileCanvas","canvas","clipTileContext","clearRect","drawImage","getImage","texImage2D","RGBA","UNSIGNED_BYTE","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","set","dispatchComposeEvent_","getMap","hasListener","context","extent","size","viewState","pixelRatio","resolution","center","rotation","vectorContext","composeEvent","dispatchEvent","disposeInternal","isContextLost","forEach","deleteTexture","dispose","expireCache_","getCount","WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK","peekLast","peekLastKey","index","pop","getTileTextureQueue","getType","event","preventDefault","clear","renderers","getLayerRenderers","id","renderer","render","activeTexture","TEXTURE0","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","disable","CULL_FACE","DEPTH_TEST","SCISSOR_TEST","STENCIL_TEST","isTileTextureLoaded","renderFrame","focus","toString","PRECOMPOSE","layerStatesToDraw","layerStatesArray","stableSort","sortByZIndex","viewResolution","i","ii","layerRenderer","layerState","length","visibleAtResolution","sourceState","READY","getLayerRenderer","layer","prepareFrame","push","bindFramebuffer","FRAMEBUFFER","clearColor","COLOR_BUFFER_BIT","enable","BLEND","viewport","composeFrame","calculateMatrices2D","postRenderFunctions","animate","POSTCOMPOSE","scheduleRemoveUnusedLayerRenderers","scheduleExpireIconCache","forEachFeatureAtCoordinate","coordinate","hitTolerance","callback","thisArg","layerFilter","thisArg2","result","layerStates","numLayers","undefined","hasFeatureAtCoordinate","hasFeature","forEachLayerAtPixel","pixel"],"mappings":"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","sourcesContent":["// FIXME check against gl.getParameter(webgl.MAX_TEXTURE_SIZE)\n\nimport _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_css_ from '../../css.js';\nimport _ol_dom_ from '../../dom.js';\nimport _ol_events_ from '../../events.js';\nimport _ol_has_ from '../../has.js';\nimport _ol_layer_Layer_ from '../../layer/layer.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_webgl_Immediate_ from '../../render/webgl/immediate.js';\nimport _ol_renderer_Map_ from '../map.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_source_State_ from '../../source/state.js';\nimport _ol_structs_LRUCache_ from '../../structs/lrucache.js';\nimport _ol_structs_PriorityQueue_ from '../../structs/priorityqueue.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Context_ from '../../webgl/context.js';\nimport _ol_webgl_ContextEventType_ from '../../webgl/contexteventtype.js';\n\n/**\n * @constructor\n * @extends {ol.renderer.Map}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @api\n */\nvar _ol_renderer_webgl_Map_ = function(container, map) {\n  _ol_renderer_Map_.call(this, container, map);\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = /** @type {HTMLCanvasElement} */\n    (document.createElement('CANVAS'));\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = _ol_css_.CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.clipTileCanvasWidth_ = 0;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.clipTileCanvasHeight_ = 0;\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.clipTileContext_ = _ol_dom_.createCanvasContext2D();\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = true;\n\n  /**\n   * @private\n   * @type {WebGLRenderingContext}\n   */\n  this.gl_ = _ol_webgl_.getContext(this.canvas_, {\n    antialias: true,\n    depth: true,\n    failIfMajorPerformanceCaveat: true,\n    preserveDrawingBuffer: false,\n    stencil: true\n  });\n\n  /**\n   * @private\n   * @type {ol.webgl.Context}\n   */\n  this.context_ = new _ol_webgl_Context_(this.canvas_, this.gl_);\n\n  _ol_events_.listen(this.canvas_, _ol_webgl_ContextEventType_.LOST,\n      this.handleWebGLContextLost, this);\n  _ol_events_.listen(this.canvas_, _ol_webgl_ContextEventType_.RESTORED,\n      this.handleWebGLContextRestored, this);\n\n  /**\n   * @private\n   * @type {ol.structs.LRUCache.<ol.WebglTextureCacheEntry|null>}\n   */\n  this.textureCache_ = new _ol_structs_LRUCache_();\n\n  /**\n   * @private\n   * @type {ol.Coordinate}\n   */\n  this.focus_ = null;\n\n  /**\n   * @private\n   * @type {ol.structs.PriorityQueue.<Array>}\n   */\n  this.tileTextureQueue_ = new _ol_structs_PriorityQueue_(\n      /**\n       * @param {Array.<*>} element Element.\n       * @return {number} Priority.\n       * @this {ol.renderer.webgl.Map}\n       */\n      (function(element) {\n        var tileCenter = /** @type {ol.Coordinate} */ (element[1]);\n        var tileResolution = /** @type {number} */ (element[2]);\n        var deltaX = tileCenter[0] - this.focus_[0];\n        var deltaY = tileCenter[1] - this.focus_[1];\n        return 65536 * Math.log(tileResolution) +\n            Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\n      }).bind(this),\n      /**\n       * @param {Array.<*>} element Element.\n       * @return {string} Key.\n       */\n      function(element) {\n        return /** @type {ol.Tile} */ (element[0]).getKey();\n      });\n\n\n  /**\n   * @param {ol.PluggableMap} map Map.\n   * @param {?olx.FrameState} frameState Frame state.\n   * @return {boolean} false.\n   * @this {ol.renderer.webgl.Map}\n   */\n  this.loadNextTileTexture_ =\n      function(map, frameState) {\n        if (!this.tileTextureQueue_.isEmpty()) {\n          this.tileTextureQueue_.reprioritize();\n          var element = this.tileTextureQueue_.dequeue();\n          var tile = /** @type {ol.Tile} */ (element[0]);\n          var tileSize = /** @type {ol.Size} */ (element[3]);\n          var tileGutter = /** @type {number} */ (element[4]);\n          this.bindTileTexture(\n              tile, tileSize, tileGutter, _ol_webgl_.LINEAR, _ol_webgl_.LINEAR);\n        }\n        return false;\n      }.bind(this);\n\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.textureCacheFrameMarkerCount_ = 0;\n\n  this.initializeGL_();\n};\n\n_ol_.inherits(_ol_renderer_webgl_Map_, _ol_renderer_Map_);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @return {boolean} The renderer can render the layer.\n */\n_ol_renderer_webgl_Map_['handles'] = function(type) {\n  return _ol_has_.WEBGL && type === _ol_renderer_Type_.WEBGL;\n};\n\n\n/**\n * Create the map renderer.\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @return {ol.renderer.webgl.Map} The map renderer.\n */\n_ol_renderer_webgl_Map_['create'] = function(container, map) {\n  return new _ol_renderer_webgl_Map_(container, map);\n};\n\n\n/**\n * @param {ol.Tile} tile Tile.\n * @param {ol.Size} tileSize Tile size.\n * @param {number} tileGutter Tile gutter.\n * @param {number} magFilter Mag filter.\n * @param {number} minFilter Min filter.\n */\n_ol_renderer_webgl_Map_.prototype.bindTileTexture = function(tile, tileSize, tileGutter, magFilter, minFilter) {\n  var gl = this.getGL();\n  var tileKey = tile.getKey();\n  if (this.textureCache_.containsKey(tileKey)) {\n    var textureCacheEntry = this.textureCache_.get(tileKey);\n    gl.bindTexture(_ol_webgl_.TEXTURE_2D, textureCacheEntry.texture);\n    if (textureCacheEntry.magFilter != magFilter) {\n      gl.texParameteri(\n          _ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MAG_FILTER, magFilter);\n      textureCacheEntry.magFilter = magFilter;\n    }\n    if (textureCacheEntry.minFilter != minFilter) {\n      gl.texParameteri(\n          _ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MIN_FILTER, minFilter);\n      textureCacheEntry.minFilter = minFilter;\n    }\n  } else {\n    var texture = gl.createTexture();\n    gl.bindTexture(_ol_webgl_.TEXTURE_2D, texture);\n    if (tileGutter > 0) {\n      var clipTileCanvas = this.clipTileContext_.canvas;\n      var clipTileContext = this.clipTileContext_;\n      if (this.clipTileCanvasWidth_ !== tileSize[0] ||\n          this.clipTileCanvasHeight_ !== tileSize[1]) {\n        clipTileCanvas.width = tileSize[0];\n        clipTileCanvas.height = tileSize[1];\n        this.clipTileCanvasWidth_ = tileSize[0];\n        this.clipTileCanvasHeight_ = tileSize[1];\n      } else {\n        clipTileContext.clearRect(0, 0, tileSize[0], tileSize[1]);\n      }\n      clipTileContext.drawImage(tile.getImage(), tileGutter, tileGutter,\n          tileSize[0], tileSize[1], 0, 0, tileSize[0], tileSize[1]);\n      gl.texImage2D(_ol_webgl_.TEXTURE_2D, 0,\n          _ol_webgl_.RGBA, _ol_webgl_.RGBA,\n          _ol_webgl_.UNSIGNED_BYTE, clipTileCanvas);\n    } else {\n      gl.texImage2D(_ol_webgl_.TEXTURE_2D, 0,\n          _ol_webgl_.RGBA, _ol_webgl_.RGBA,\n          _ol_webgl_.UNSIGNED_BYTE, tile.getImage());\n    }\n    gl.texParameteri(\n        _ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MAG_FILTER, magFilter);\n    gl.texParameteri(\n        _ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_WRAP_S,\n        _ol_webgl_.CLAMP_TO_EDGE);\n    gl.texParameteri(_ol_webgl_.TEXTURE_2D, _ol_webgl_.TEXTURE_WRAP_T,\n        _ol_webgl_.CLAMP_TO_EDGE);\n    this.textureCache_.set(tileKey, {\n      texture: texture,\n      magFilter: magFilter,\n      minFilter: minFilter\n    });\n  }\n};\n\n\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_webgl_Map_.prototype.dispatchComposeEvent_ = function(type, frameState) {\n  var map = this.getMap();\n  if (map.hasListener(type)) {\n    var context = this.context_;\n\n    var extent = frameState.extent;\n    var size = frameState.size;\n    var viewState = frameState.viewState;\n    var pixelRatio = frameState.pixelRatio;\n\n    var resolution = viewState.resolution;\n    var center = viewState.center;\n    var rotation = viewState.rotation;\n\n    var vectorContext = new _ol_render_webgl_Immediate_(context,\n        center, resolution, rotation, size, extent, pixelRatio);\n    var composeEvent = new _ol_render_Event_(type, vectorContext,\n        frameState, null, context);\n    map.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.disposeInternal = function() {\n  var gl = this.getGL();\n  if (!gl.isContextLost()) {\n    this.textureCache_.forEach(\n        /**\n         * @param {?ol.WebglTextureCacheEntry} textureCacheEntry\n         *     Texture cache entry.\n         */\n        function(textureCacheEntry) {\n          if (textureCacheEntry) {\n            gl.deleteTexture(textureCacheEntry.texture);\n          }\n        });\n  }\n  this.context_.dispose();\n  _ol_renderer_Map_.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_webgl_Map_.prototype.expireCache_ = function(map, frameState) {\n  var gl = this.getGL();\n  var textureCacheEntry;\n  while (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ >\n      _ol_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    textureCacheEntry = this.textureCache_.peekLast();\n    if (!textureCacheEntry) {\n      if (+this.textureCache_.peekLastKey() == frameState.index) {\n        break;\n      } else {\n        --this.textureCacheFrameMarkerCount_;\n      }\n    } else {\n      gl.deleteTexture(textureCacheEntry.texture);\n    }\n    this.textureCache_.pop();\n  }\n};\n\n\n/**\n * @return {ol.webgl.Context} The context.\n */\n_ol_renderer_webgl_Map_.prototype.getContext = function() {\n  return this.context_;\n};\n\n\n/**\n * @return {WebGLRenderingContext} GL.\n */\n_ol_renderer_webgl_Map_.prototype.getGL = function() {\n  return this.gl_;\n};\n\n\n/**\n * @return {ol.structs.PriorityQueue.<Array>} Tile texture queue.\n */\n_ol_renderer_webgl_Map_.prototype.getTileTextureQueue = function() {\n  return this.tileTextureQueue_;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.getType = function() {\n  return _ol_renderer_Type_.WEBGL;\n};\n\n\n/**\n * @param {ol.events.Event} event Event.\n * @protected\n */\n_ol_renderer_webgl_Map_.prototype.handleWebGLContextLost = function(event) {\n  event.preventDefault();\n  this.textureCache_.clear();\n  this.textureCacheFrameMarkerCount_ = 0;\n\n  var renderers = this.getLayerRenderers();\n  for (var id in renderers) {\n    var renderer = /** @type {ol.renderer.webgl.Layer} */ (renderers[id]);\n    renderer.handleWebGLContextLost();\n  }\n};\n\n\n/**\n * @protected\n */\n_ol_renderer_webgl_Map_.prototype.handleWebGLContextRestored = function() {\n  this.initializeGL_();\n  this.getMap().render();\n};\n\n\n/**\n * @private\n */\n_ol_renderer_webgl_Map_.prototype.initializeGL_ = function() {\n  var gl = this.gl_;\n  gl.activeTexture(_ol_webgl_.TEXTURE0);\n  gl.blendFuncSeparate(\n      _ol_webgl_.SRC_ALPHA, _ol_webgl_.ONE_MINUS_SRC_ALPHA,\n      _ol_webgl_.ONE, _ol_webgl_.ONE_MINUS_SRC_ALPHA);\n  gl.disable(_ol_webgl_.CULL_FACE);\n  gl.disable(_ol_webgl_.DEPTH_TEST);\n  gl.disable(_ol_webgl_.SCISSOR_TEST);\n  gl.disable(_ol_webgl_.STENCIL_TEST);\n};\n\n\n/**\n * @param {ol.Tile} tile Tile.\n * @return {boolean} Is tile texture loaded.\n */\n_ol_renderer_webgl_Map_.prototype.isTileTextureLoaded = function(tile) {\n  return this.textureCache_.containsKey(tile.getKey());\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.renderFrame = function(frameState) {\n\n  var context = this.getContext();\n  var gl = this.getGL();\n\n  if (gl.isContextLost()) {\n    return false;\n  }\n\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return false;\n  }\n\n  this.focus_ = frameState.focus;\n\n  this.textureCache_.set((-frameState.index).toString(), null);\n  ++this.textureCacheFrameMarkerCount_;\n\n  this.dispatchComposeEvent_(_ol_render_EventType_.PRECOMPOSE, frameState);\n\n  /** @type {Array.<ol.LayerState>} */\n  var layerStatesToDraw = [];\n  var layerStatesArray = frameState.layerStatesArray;\n  _ol_array_.stableSort(layerStatesArray, _ol_renderer_Map_.sortByZIndex);\n\n  var viewResolution = frameState.viewState.resolution;\n  var i, ii, layerRenderer, layerState;\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) &&\n        layerState.sourceState == _ol_source_State_.READY) {\n      layerRenderer = /** @type {ol.renderer.webgl.Layer} */ (this.getLayerRenderer(layerState.layer));\n      if (layerRenderer.prepareFrame(frameState, layerState, context)) {\n        layerStatesToDraw.push(layerState);\n      }\n    }\n  }\n\n  var width = frameState.size[0] * frameState.pixelRatio;\n  var height = frameState.size[1] * frameState.pixelRatio;\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  }\n\n  gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, null);\n\n  gl.clearColor(0, 0, 0, 0);\n  gl.clear(_ol_webgl_.COLOR_BUFFER_BIT);\n  gl.enable(_ol_webgl_.BLEND);\n  gl.viewport(0, 0, this.canvas_.width, this.canvas_.height);\n\n  for (i = 0, ii = layerStatesToDraw.length; i < ii; ++i) {\n    layerState = layerStatesToDraw[i];\n    layerRenderer = /** @type {ol.renderer.webgl.Layer} */ (this.getLayerRenderer(layerState.layer));\n    layerRenderer.composeFrame(frameState, layerState, context);\n  }\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.calculateMatrices2D(frameState);\n\n  if (this.textureCache_.getCount() - this.textureCacheFrameMarkerCount_ >\n      _ol_.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK) {\n    frameState.postRenderFunctions.push(\n        /** @type {ol.PostRenderFunction} */ (this.expireCache_.bind(this))\n    );\n  }\n\n  if (!this.tileTextureQueue_.isEmpty()) {\n    frameState.postRenderFunctions.push(this.loadNextTileTexture_);\n    frameState.animate = true;\n  }\n\n  this.dispatchComposeEvent_(_ol_render_EventType_.POSTCOMPOSE, frameState);\n\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg,\n    layerFilter, thisArg2) {\n  var result;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg2, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n      result = layerRenderer.forEachFeatureAtCoordinate(\n          coordinate, frameState, hitTolerance, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  var hasFeature = false;\n\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n      hasFeature =\n          layerRenderer.hasFeatureAtCoordinate(coordinate, frameState);\n      if (hasFeature) {\n        return true;\n      }\n    }\n  }\n  return hasFeature;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg,\n    layerFilter, thisArg2) {\n  if (this.getGL().isContextLost()) {\n    return false;\n  }\n\n  var viewState = frameState.viewState;\n  var result;\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewState.resolution) &&\n        layerFilter.call(thisArg, layer)) {\n      var layerRenderer = /** @type {ol.renderer.webgl.Layer} */ (this.getLayerRenderer(layer));\n      result = layerRenderer.forEachLayerAtPixel(\n          pixel, frameState, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\nexport default _ol_renderer_webgl_Map_;"]},"metadata":{},"sourceType":"module"}