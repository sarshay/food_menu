{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_color_ from '../../color.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_geom_flat_contains_ from '../../geom/flat/contains.js';\nimport _ol_geom_flat_orient_ from '../../geom/flat/orient.js';\nimport _ol_geom_flat_transform_ from '../../geom/flat/transform.js';\nimport _ol_render_webgl_polygonreplay_defaultshader_ from '../webgl/polygonreplay/defaultshader.js';\nimport _ol_render_webgl_polygonreplay_defaultshader_Locations_ from '../webgl/polygonreplay/defaultshader/locations.js';\nimport _ol_render_webgl_LineStringReplay_ from '../webgl/linestringreplay.js';\nimport _ol_render_webgl_Replay_ from '../webgl/replay.js';\nimport _ol_render_webgl_ from '../webgl.js';\nimport _ol_style_Stroke_ from '../../style/stroke.js';\nimport _ol_structs_LinkedList_ from '../../structs/linkedlist.js';\nimport _ol_structs_RBush_ from '../../structs/rbush.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\n/**\n * @constructor\n * @extends {ol.render.webgl.Replay}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\n\nvar _ol_render_webgl_PolygonReplay_ = function (tolerance, maxExtent) {\n  _ol_render_webgl_Replay_.call(this, tolerance, maxExtent);\n\n  this.lineStringReplay = new _ol_render_webgl_LineStringReplay_(tolerance, maxExtent);\n  /**\n   * @private\n   * @type {ol.render.webgl.polygonreplay.defaultshader.Locations}\n   */\n\n  this.defaultLocations_ = null;\n  /**\n   * @private\n   * @type {Array.<Array.<number>>}\n   */\n\n  this.styles_ = [];\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n\n  this.styleIndices_ = [];\n  /**\n   * @private\n   * @type {{fillColor: (Array.<number>|null),\n   *         changed: boolean}|null}\n   */\n\n  this.state_ = {\n    fillColor: null,\n    changed: false\n  };\n};\n\n_ol_.inherits(_ol_render_webgl_PolygonReplay_, _ol_render_webgl_Replay_);\n/**\n * Draw one polygon.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n * @private\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawCoordinates_ = function (flatCoordinates, holeFlatCoordinates, stride) {\n  // Triangulate the polygon\n  var outerRing = new _ol_structs_LinkedList_();\n  var rtree = new _ol_structs_RBush_(); // Initialize the outer ring\n\n  this.processFlatCoordinates_(flatCoordinates, stride, outerRing, rtree, true);\n  var maxCoords = this.getMaxCoords_(outerRing); // Eliminate holes, if there are any\n\n  if (holeFlatCoordinates.length) {\n    var i, ii;\n    var holeLists = [];\n\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      var holeList = {\n        list: new _ol_structs_LinkedList_(),\n        maxCoords: undefined,\n        rtree: new _ol_structs_RBush_()\n      };\n      holeLists.push(holeList);\n      this.processFlatCoordinates_(holeFlatCoordinates[i], stride, holeList.list, holeList.rtree, false);\n      this.classifyPoints_(holeList.list, holeList.rtree, true);\n      holeList.maxCoords = this.getMaxCoords_(holeList.list);\n    }\n\n    holeLists.sort(function (a, b) {\n      return b.maxCoords[0] === a.maxCoords[0] ? a.maxCoords[1] - b.maxCoords[1] : b.maxCoords[0] - a.maxCoords[0];\n    });\n\n    for (i = 0; i < holeLists.length; ++i) {\n      var currList = holeLists[i].list;\n      var start = currList.firstItem();\n      var currItem = start;\n      var intersection;\n\n      do {\n        //TODO: Triangulate holes when they intersect the outer ring.\n        if (this.getIntersections_(currItem, rtree).length) {\n          intersection = true;\n          break;\n        }\n\n        currItem = currList.nextItem();\n      } while (start !== currItem);\n\n      if (!intersection) {\n        if (this.bridgeHole_(currList, holeLists[i].maxCoords[0], outerRing, maxCoords[0], rtree)) {\n          rtree.concat(holeLists[i].rtree);\n          this.classifyPoints_(outerRing, rtree, false);\n        }\n      }\n    }\n  } else {\n    this.classifyPoints_(outerRing, rtree, false);\n  }\n\n  this.triangulate_(outerRing, rtree);\n};\n/**\n * Inserts flat coordinates in a linked list and adds them to the vertex buffer.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {ol.structs.LinkedList} list Linked list.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} clockwise Coordinate order should be clockwise.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.processFlatCoordinates_ = function (flatCoordinates, stride, list, rtree, clockwise) {\n  var isClockwise = _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates, 0, flatCoordinates.length, stride);\n\n  var i, ii;\n  var n = this.vertices.length / 2;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var start;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var p0;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var p1;\n  var extents = [];\n  var segments = [];\n\n  if (clockwise === isClockwise) {\n    start = this.createPoint_(flatCoordinates[0], flatCoordinates[1], n++);\n    p0 = start;\n\n    for (i = stride, ii = flatCoordinates.length; i < ii; i += stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n  } else {\n    var end = flatCoordinates.length - stride;\n    start = this.createPoint_(flatCoordinates[end], flatCoordinates[end + 1], n++);\n    p0 = start;\n\n    for (i = end - stride, ii = 0; i >= ii; i -= stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n  }\n\n  rtree.load(extents, segments);\n};\n/**\n * Returns the rightmost coordinates of a polygon on the X axis.\n * @private\n * @param {ol.structs.LinkedList} list Polygons ring.\n * @return {Array.<number>} Max X coordinates.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.getMaxCoords_ = function (list) {\n  var start = list.firstItem();\n  var seg = start;\n  var maxCoords = [seg.p0.x, seg.p0.y];\n\n  do {\n    seg = list.nextItem();\n\n    if (seg.p0.x > maxCoords[0]) {\n      maxCoords = [seg.p0.x, seg.p0.y];\n    }\n  } while (seg !== start);\n\n  return maxCoords;\n};\n/**\n * Classifies the points of a polygon list as convex, reflex. Removes collinear vertices.\n * @private\n * @param {ol.structs.LinkedList} list Polygon ring.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} ccw The orientation of the polygon is counter-clockwise.\n * @return {boolean} There were reclassified points.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.classifyPoints_ = function (list, rtree, ccw) {\n  var start = list.firstItem();\n  var s0 = start;\n  var s1 = list.nextItem();\n  var pointsReclassified = false;\n\n  do {\n    var reflex = ccw ? _ol_render_webgl_.triangleIsCounterClockwise(s1.p1.x, s1.p1.y, s0.p1.x, s0.p1.y, s0.p0.x, s0.p0.y) : _ol_render_webgl_.triangleIsCounterClockwise(s0.p0.x, s0.p0.y, s0.p1.x, s0.p1.y, s1.p1.x, s1.p1.y);\n\n    if (reflex === undefined) {\n      this.removeItem_(s0, s1, list, rtree);\n      pointsReclassified = true;\n\n      if (s1 === start) {\n        start = list.getNextItem();\n      }\n\n      s1 = s0;\n      list.prevItem();\n    } else if (s0.p1.reflex !== reflex) {\n      s0.p1.reflex = reflex;\n      pointsReclassified = true;\n    }\n\n    s0 = s1;\n    s1 = list.nextItem();\n  } while (s0 !== start);\n\n  return pointsReclassified;\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} hole Linked list of the hole.\n * @param {number} holeMaxX Maximum X value of the hole.\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {number} listMaxX Maximum X value of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @return {boolean} Bridging was successful.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.bridgeHole_ = function (hole, holeMaxX, list, listMaxX, rtree) {\n  var seg = hole.firstItem();\n\n  while (seg.p1.x !== holeMaxX) {\n    seg = hole.nextItem();\n  }\n\n  var p1 = seg.p1;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var p2 = {\n    x: listMaxX,\n    y: p1.y,\n    i: -1\n  };\n  var minDist = Infinity;\n  var i, ii, bestPoint;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var p5;\n  var intersectingSegments = this.getIntersections_({\n    p0: p1,\n    p1: p2\n  }, rtree, true);\n\n  for (i = 0, ii = intersectingSegments.length; i < ii; ++i) {\n    var currSeg = intersectingSegments[i];\n    var intersection = this.calculateIntersection_(p1, p2, currSeg.p0, currSeg.p1, true);\n    var dist = Math.abs(p1.x - intersection[0]);\n\n    if (dist < minDist && _ol_render_webgl_.triangleIsCounterClockwise(p1.x, p1.y, currSeg.p0.x, currSeg.p0.y, currSeg.p1.x, currSeg.p1.y) !== undefined) {\n      minDist = dist;\n      p5 = {\n        x: intersection[0],\n        y: intersection[1],\n        i: -1\n      };\n      seg = currSeg;\n    }\n  }\n\n  if (minDist === Infinity) {\n    return false;\n  }\n\n  bestPoint = seg.p1;\n\n  if (minDist > 0) {\n    var pointsInTriangle = this.getPointsInTriangle_(p1, p5, seg.p1, rtree);\n\n    if (pointsInTriangle.length) {\n      var theta = Infinity;\n\n      for (i = 0, ii = pointsInTriangle.length; i < ii; ++i) {\n        var currPoint = pointsInTriangle[i];\n        var currTheta = Math.atan2(p1.y - currPoint.y, p2.x - currPoint.x);\n\n        if (currTheta < theta || currTheta === theta && currPoint.x < bestPoint.x) {\n          theta = currTheta;\n          bestPoint = currPoint;\n        }\n      }\n    }\n  }\n\n  seg = list.firstItem();\n\n  while (seg.p1.x !== bestPoint.x || seg.p1.y !== bestPoint.y) {\n    seg = list.nextItem();\n  } //We clone the bridge points as they can have different convexity.\n\n\n  var p0Bridge = {\n    x: p1.x,\n    y: p1.y,\n    i: p1.i,\n    reflex: undefined\n  };\n  var p1Bridge = {\n    x: seg.p1.x,\n    y: seg.p1.y,\n    i: seg.p1.i,\n    reflex: undefined\n  };\n  hole.getNextItem().p0 = p0Bridge;\n  this.insertItem_(p1, seg.p1, hole, rtree);\n  this.insertItem_(p1Bridge, p0Bridge, hole, rtree);\n  seg.p1 = p1Bridge;\n  hole.setFirstItem();\n  list.concat(hole);\n  return true;\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.triangulate_ = function (list, rtree) {\n  var ccw = false;\n  var simple = this.isSimple_(list, rtree); // Start clipping ears\n\n  while (list.getLength() > 3) {\n    if (simple) {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // Due to the behavior of OL's PIP algorithm, the ear clipping cannot\n          // introduce touching segments. However, the original data may have some.\n          if (!this.resolveSelfIntersections_(list, rtree, true)) {\n            break;\n          }\n        }\n      }\n    } else {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        // We ran out of ears, try to reclassify.\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // We have a bad polygon, try to resolve local self-intersections.\n          if (!this.resolveSelfIntersections_(list, rtree)) {\n            simple = this.isSimple_(list, rtree);\n\n            if (!simple) {\n              // We have a really bad polygon, try more time consuming methods.\n              this.splitPolygon_(list, rtree);\n              break;\n            } else {\n              ccw = !this.isClockwise_(list);\n              this.classifyPoints_(list, rtree, ccw);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  if (list.getLength() === 3) {\n    var numIndices = this.indices.length;\n    this.indices[numIndices++] = list.getPrevItem().p0.i;\n    this.indices[numIndices++] = list.getCurrItem().p0.i;\n    this.indices[numIndices++] = list.getNextItem().p0.i;\n  }\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} simple The polygon is simple.\n * @param {boolean} ccw Orientation of the polygon is counter-clockwise.\n * @return {boolean} There were processed ears.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.clipEars_ = function (list, rtree, simple, ccw) {\n  var numIndices = this.indices.length;\n  var start = list.firstItem();\n  var s0 = list.getPrevItem();\n  var s1 = start;\n  var s2 = list.nextItem();\n  var s3 = list.getNextItem();\n  var p0, p1, p2;\n  var processedEars = false;\n\n  do {\n    p0 = s1.p0;\n    p1 = s1.p1;\n    p2 = s2.p1;\n\n    if (p1.reflex === false) {\n      // We might have a valid ear\n      var variableCriterion;\n\n      if (simple) {\n        variableCriterion = this.getPointsInTriangle_(p0, p1, p2, rtree, true).length === 0;\n      } else {\n        variableCriterion = ccw ? this.diagonalIsInside_(s3.p1, p2, p1, p0, s0.p0) : this.diagonalIsInside_(s0.p0, p0, p1, p2, s3.p1);\n      }\n\n      if ((simple || this.getIntersections_({\n        p0: p0,\n        p1: p2\n      }, rtree).length === 0) && variableCriterion) {\n        //The diagonal is completely inside the polygon\n        if (simple || p0.reflex === false || p2.reflex === false || _ol_geom_flat_orient_.linearRingIsClockwise([s0.p0.x, s0.p0.y, p0.x, p0.y, p1.x, p1.y, p2.x, p2.y, s3.p1.x, s3.p1.y], 0, 10, 2) === !ccw) {\n          //The diagonal is persumably valid, we have an ear\n          this.indices[numIndices++] = p0.i;\n          this.indices[numIndices++] = p1.i;\n          this.indices[numIndices++] = p2.i;\n          this.removeItem_(s1, s2, list, rtree);\n\n          if (s2 === start) {\n            start = s3;\n          }\n\n          processedEars = true;\n        }\n      }\n    } // Else we have a reflex point.\n\n\n    s0 = list.getPrevItem();\n    s1 = list.getCurrItem();\n    s2 = list.nextItem();\n    s3 = list.getNextItem();\n  } while (s1 !== start && list.getLength() > 3);\n\n  return processedEars;\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Resolve touching segments.\n * @return {boolean} There were resolved intersections.\n*/\n\n\n_ol_render_webgl_PolygonReplay_.prototype.resolveSelfIntersections_ = function (list, rtree, opt_touch) {\n  var start = list.firstItem();\n  list.nextItem();\n  var s0 = start;\n  var s1 = list.nextItem();\n  var resolvedIntersections = false;\n\n  do {\n    var intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1, opt_touch);\n\n    if (intersection) {\n      var breakCond = false;\n      var numVertices = this.vertices.length;\n      var numIndices = this.indices.length;\n      var n = numVertices / 2;\n      var seg = list.prevItem();\n      list.removeItem();\n      rtree.remove(seg);\n      breakCond = seg === start;\n      var p;\n\n      if (opt_touch) {\n        if (intersection[0] === s0.p0.x && intersection[1] === s0.p0.y) {\n          list.prevItem();\n          p = s0.p0;\n          s1.p0 = p;\n          rtree.remove(s0);\n          breakCond = breakCond || s0 === start;\n        } else {\n          p = s1.p1;\n          s0.p1 = p;\n          rtree.remove(s1);\n          breakCond = breakCond || s1 === start;\n        }\n\n        list.removeItem();\n      } else {\n        p = this.createPoint_(intersection[0], intersection[1], n);\n        s0.p1 = p;\n        s1.p0 = p;\n        rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y), Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n        rtree.update([Math.min(s1.p0.x, s1.p1.x), Math.min(s1.p0.y, s1.p1.y), Math.max(s1.p0.x, s1.p1.x), Math.max(s1.p0.y, s1.p1.y)], s1);\n      }\n\n      this.indices[numIndices++] = seg.p0.i;\n      this.indices[numIndices++] = seg.p1.i;\n      this.indices[numIndices++] = p.i;\n      resolvedIntersections = true;\n\n      if (breakCond) {\n        break;\n      }\n    }\n\n    s0 = list.getPrevItem();\n    s1 = list.nextItem();\n  } while (s0 !== start);\n\n  return resolvedIntersections;\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @return {boolean} The polygon is simple.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.isSimple_ = function (list, rtree) {\n  var start = list.firstItem();\n  var seg = start;\n\n  do {\n    if (this.getIntersections_(seg, rtree).length) {\n      return false;\n    }\n\n    seg = list.nextItem();\n  } while (seg !== start);\n\n  return true;\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @return {boolean} Orientation is clockwise.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.isClockwise_ = function (list) {\n  var length = list.getLength() * 2;\n  var flatCoordinates = new Array(length);\n  var start = list.firstItem();\n  var seg = start;\n  var i = 0;\n\n  do {\n    flatCoordinates[i++] = seg.p0.x;\n    flatCoordinates[i++] = seg.p0.y;\n    seg = list.nextItem();\n  } while (seg !== start);\n\n  return _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates, 0, length, 2);\n};\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.splitPolygon_ = function (list, rtree) {\n  var start = list.firstItem();\n  var s0 = start;\n\n  do {\n    var intersections = this.getIntersections_(s0, rtree);\n\n    if (intersections.length) {\n      var s1 = intersections[0];\n      var n = this.vertices.length / 2;\n      var intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1);\n      var p = this.createPoint_(intersection[0], intersection[1], n);\n      var newPolygon = new _ol_structs_LinkedList_();\n      var newRtree = new _ol_structs_RBush_();\n      this.insertItem_(p, s0.p1, newPolygon, newRtree);\n      s0.p1 = p;\n      rtree.update([Math.min(s0.p0.x, p.x), Math.min(s0.p0.y, p.y), Math.max(s0.p0.x, p.x), Math.max(s0.p0.y, p.y)], s0);\n      var currItem = list.nextItem();\n\n      while (currItem !== s1) {\n        this.insertItem_(currItem.p0, currItem.p1, newPolygon, newRtree);\n        rtree.remove(currItem);\n        list.removeItem();\n        currItem = list.getCurrItem();\n      }\n\n      this.insertItem_(s1.p0, p, newPolygon, newRtree);\n      s1.p0 = p;\n      rtree.update([Math.min(s1.p1.x, p.x), Math.min(s1.p1.y, p.y), Math.max(s1.p1.x, p.x), Math.max(s1.p1.y, p.y)], s1);\n      this.classifyPoints_(list, rtree, false);\n      this.triangulate_(list, rtree);\n      this.classifyPoints_(newPolygon, newRtree, false);\n      this.triangulate_(newPolygon, newRtree);\n      break;\n    }\n\n    s0 = list.nextItem();\n  } while (s0 !== start);\n};\n/**\n * @private\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n * @param {number} i Index.\n * @return {ol.WebglPolygonVertex} List item.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.createPoint_ = function (x, y, i) {\n  var numVertices = this.vertices.length;\n  this.vertices[numVertices++] = x;\n  this.vertices[numVertices++] = y;\n  /** @type {ol.WebglPolygonVertex} */\n\n  var p = {\n    x: x,\n    y: y,\n    i: i,\n    reflex: undefined\n  };\n  return p;\n};\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point of segment.\n * @param {ol.WebglPolygonVertex} p1 Second point of segment.\n * @param {ol.structs.LinkedList} list Polygon ring.\n * @param {ol.structs.RBush=} opt_rtree Insert the segment into the R-Tree.\n * @return {ol.WebglPolygonSegment} segment.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.insertItem_ = function (p0, p1, list, opt_rtree) {\n  var seg = {\n    p0: p0,\n    p1: p1\n  };\n  list.insertItem(seg);\n\n  if (opt_rtree) {\n    opt_rtree.insert([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)], seg);\n  }\n\n  return seg;\n};\n/**\n  * @private\n  * @param {ol.WebglPolygonSegment} s0 Segment before the remove candidate.\n  * @param {ol.WebglPolygonSegment} s1 Remove candidate segment.\n  * @param {ol.structs.LinkedList} list Polygon ring.\n  * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n  */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.removeItem_ = function (s0, s1, list, rtree) {\n  if (list.getCurrItem() === s1) {\n    list.removeItem();\n    s0.p1 = s1.p1;\n    rtree.remove(s1);\n    rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y), Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n  }\n};\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point.\n * @param {ol.WebglPolygonVertex} p1 Second point.\n * @param {ol.WebglPolygonVertex} p2 Third point.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_reflex Only include reflex points.\n * @return {Array.<ol.WebglPolygonVertex>} Points in the triangle.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.getPointsInTriangle_ = function (p0, p1, p2, rtree, opt_reflex) {\n  var i, ii, j, p;\n  var result = [];\n  var segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x, p2.x), Math.min(p0.y, p1.y, p2.y), Math.max(p0.x, p1.x, p2.x), Math.max(p0.y, p1.y, p2.y)]);\n\n  for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    for (j in segmentsInExtent[i]) {\n      p = segmentsInExtent[i][j];\n\n      if (typeof p === 'object' && (!opt_reflex || p.reflex)) {\n        if ((p.x !== p0.x || p.y !== p0.y) && (p.x !== p1.x || p.y !== p1.y) && (p.x !== p2.x || p.y !== p2.y) && result.indexOf(p) === -1 && _ol_geom_flat_contains_.linearRingContainsXY([p0.x, p0.y, p1.x, p1.y, p2.x, p2.y], 0, 6, 2, p.x, p.y)) {\n          result.push(p);\n        }\n      }\n    }\n  }\n\n  return result;\n};\n/**\n * @private\n * @param {ol.WebglPolygonSegment} segment Segment.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<ol.WebglPolygonSegment>} Intersecting segments.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.getIntersections_ = function (segment, rtree, opt_touch) {\n  var p0 = segment.p0;\n  var p1 = segment.p1;\n  var segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n  var result = [];\n  var i, ii;\n\n  for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    var currSeg = segmentsInExtent[i];\n\n    if (segment !== currSeg && (opt_touch || currSeg.p0 !== p1 || currSeg.p1 !== p0) && this.calculateIntersection_(p0, p1, currSeg.p0, currSeg.p1, opt_touch)) {\n      result.push(currSeg);\n    }\n  }\n\n  return result;\n};\n/**\n * Line intersection algorithm by Paul Bourke.\n * @see http://paulbourke.net/geometry/pointlineplane/\n *\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point.\n * @param {ol.WebglPolygonVertex} p1 Second point.\n * @param {ol.WebglPolygonVertex} p2 Third point.\n * @param {ol.WebglPolygonVertex} p3 Fourth point.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<number>|undefined} Intersection coordinates.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.calculateIntersection_ = function (p0, p1, p2, p3, opt_touch) {\n  var denom = (p3.y - p2.y) * (p1.x - p0.x) - (p3.x - p2.x) * (p1.y - p0.y);\n\n  if (denom !== 0) {\n    var ua = ((p3.x - p2.x) * (p0.y - p2.y) - (p3.y - p2.y) * (p0.x - p2.x)) / denom;\n    var ub = ((p1.x - p0.x) * (p0.y - p2.y) - (p1.y - p0.y) * (p0.x - p2.x)) / denom;\n\n    if (!opt_touch && ua > _ol_render_webgl_.EPSILON && ua < 1 - _ol_render_webgl_.EPSILON && ub > _ol_render_webgl_.EPSILON && ub < 1 - _ol_render_webgl_.EPSILON || opt_touch && ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1) {\n      return [p0.x + ua * (p1.x - p0.x), p0.y + ua * (p1.y - p0.y)];\n    }\n  }\n\n  return undefined;\n};\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 Point before the start of the diagonal.\n * @param {ol.WebglPolygonVertex} p1 Start point of the diagonal.\n * @param {ol.WebglPolygonVertex} p2 Ear candidate.\n * @param {ol.WebglPolygonVertex} p3 End point of the diagonal.\n * @param {ol.WebglPolygonVertex} p4 Point after the end of the diagonal.\n * @return {boolean} Diagonal is inside the polygon.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.diagonalIsInside_ = function (p0, p1, p2, p3, p4) {\n  if (p1.reflex === undefined || p3.reflex === undefined) {\n    return false;\n  }\n\n  var p1IsLeftOf = (p2.x - p3.x) * (p1.y - p3.y) > (p2.y - p3.y) * (p1.x - p3.x);\n  var p1IsRightOf = (p4.x - p3.x) * (p1.y - p3.y) < (p4.y - p3.y) * (p1.x - p3.x);\n  var p3IsLeftOf = (p0.x - p1.x) * (p3.y - p1.y) > (p0.y - p1.y) * (p3.x - p1.x);\n  var p3IsRightOf = (p2.x - p1.x) * (p3.y - p1.y) < (p2.y - p1.y) * (p3.x - p1.x);\n  var p1InCone = p3.reflex ? p1IsRightOf || p1IsLeftOf : p1IsRightOf && p1IsLeftOf;\n  var p3InCone = p1.reflex ? p3IsRightOf || p3IsLeftOf : p3IsRightOf && p3IsLeftOf;\n  return p1InCone && p3InCone;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawMultiPolygon = function (multiPolygonGeometry, feature) {\n  var endss = multiPolygonGeometry.getEndss();\n  var stride = multiPolygonGeometry.getStride();\n  var currIndex = this.indices.length;\n  var currLineIndex = this.lineStringReplay.getCurrentIndex();\n  var flatCoordinates = multiPolygonGeometry.getFlatCoordinates();\n  var i, ii, j, jj;\n  var start = 0;\n\n  for (i = 0, ii = endss.length; i < ii; ++i) {\n    var ends = endss[i];\n\n    if (ends.length > 0) {\n      var outerRing = _ol_geom_flat_transform_.translate(flatCoordinates, start, ends[0], stride, -this.origin[0], -this.origin[1]);\n\n      if (outerRing.length) {\n        var holes = [];\n        var holeFlatCoords;\n\n        for (j = 1, jj = ends.length; j < jj; ++j) {\n          if (ends[j] !== ends[j - 1]) {\n            holeFlatCoords = _ol_geom_flat_transform_.translate(flatCoordinates, ends[j - 1], ends[j], stride, -this.origin[0], -this.origin[1]);\n            holes.push(holeFlatCoords);\n          }\n        }\n\n        this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n        this.drawCoordinates_(outerRing, holes, stride);\n      }\n    }\n\n    start = ends[ends.length - 1];\n  }\n\n  if (this.indices.length > currIndex) {\n    this.startIndices.push(currIndex);\n    this.startIndicesFeature.push(feature);\n\n    if (this.state_.changed) {\n      this.styleIndices_.push(currIndex);\n      this.state_.changed = false;\n    }\n  }\n\n  if (this.lineStringReplay.getCurrentIndex() > currLineIndex) {\n    this.lineStringReplay.setPolygonStyle(feature, currLineIndex);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawPolygon = function (polygonGeometry, feature) {\n  var ends = polygonGeometry.getEnds();\n  var stride = polygonGeometry.getStride();\n\n  if (ends.length > 0) {\n    var flatCoordinates = polygonGeometry.getFlatCoordinates().map(Number);\n\n    var outerRing = _ol_geom_flat_transform_.translate(flatCoordinates, 0, ends[0], stride, -this.origin[0], -this.origin[1]);\n\n    if (outerRing.length) {\n      var holes = [];\n      var i, ii, holeFlatCoords;\n\n      for (i = 1, ii = ends.length; i < ii; ++i) {\n        if (ends[i] !== ends[i - 1]) {\n          holeFlatCoords = _ol_geom_flat_transform_.translate(flatCoordinates, ends[i - 1], ends[i], stride, -this.origin[0], -this.origin[1]);\n          holes.push(holeFlatCoords);\n        }\n      }\n\n      this.startIndices.push(this.indices.length);\n      this.startIndicesFeature.push(feature);\n\n      if (this.state_.changed) {\n        this.styleIndices_.push(this.indices.length);\n        this.state_.changed = false;\n      }\n\n      this.lineStringReplay.setPolygonStyle(feature);\n      this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n      this.drawCoordinates_(outerRing, holes, stride);\n    }\n  }\n};\n/**\n * @inheritDoc\n **/\n\n\n_ol_render_webgl_PolygonReplay_.prototype.finish = function (context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new _ol_webgl_Buffer_(this.vertices); // create, bind, and populate the indices buffer\n\n  this.indicesBuffer = new _ol_webgl_Buffer_(this.indices);\n  this.startIndices.push(this.indices.length);\n  this.lineStringReplay.finish(context); //Clean up, if there is nothing to draw\n\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.getDeleteResourcesFunction = function (context) {\n  var verticesBuffer = this.verticesBuffer;\n  var indicesBuffer = this.indicesBuffer;\n  var lineDeleter = this.lineStringReplay.getDeleteResourcesFunction(context);\n  return function () {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n    lineDeleter();\n  };\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.setUpProgram = function (gl, context, size, pixelRatio) {\n  // get the program\n  var fragmentShader, vertexShader;\n  fragmentShader = _ol_render_webgl_polygonreplay_defaultshader_.fragment;\n  vertexShader = _ol_render_webgl_polygonreplay_defaultshader_.vertex;\n  var program = context.getProgram(fragmentShader, vertexShader); // get the locations\n\n  var locations;\n\n  if (!this.defaultLocations_) {\n    locations = new _ol_render_webgl_polygonreplay_defaultshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program); // enable the vertex attrib arrays\n\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, _ol_webgl_.FLOAT, false, 8, 0);\n  return locations;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.shutDownProgram = function (gl, locations) {\n  gl.disableVertexAttribArray(locations.a_position);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawReplay = function (gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  var tmpDepthFunc =\n  /** @type {number} */\n  gl.getParameter(gl.DEPTH_FUNC);\n  var tmpDepthMask =\n  /** @type {boolean} */\n  gl.getParameter(gl.DEPTH_WRITEMASK);\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!_ol_obj_.isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    var i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setFillStyle_(gl, nextStyle);\n      this.drawElements(gl, context, start, end);\n      end = start;\n    }\n  }\n\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT); //Restore GL parameters.\n\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawHitDetectionReplayOneByOne = function (gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _ol_extent_.intersects(\n      /** @type {Array<number>} */\n      opt_hitExtent, feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n        var result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n      }\n\n      featureIndex--;\n      end = start;\n    }\n  }\n\n  return undefined;\n};\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.drawReplaySkipping_ = function (gl, context, skippedFeaturesHash) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n\n        end = featureStart;\n      }\n\n      featureIndex--;\n      start = featureStart;\n    }\n\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n\n    start = end = groupStart;\n  }\n};\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.setFillStyle_ = function (gl, color) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_PolygonReplay_.prototype.setFillStrokeStyle = function (fillStyle, strokeStyle) {\n  var fillStyleColor = fillStyle ? fillStyle.getColor() : [0, 0, 0, 0];\n\n  if (!(fillStyleColor instanceof CanvasGradient) && !(fillStyleColor instanceof CanvasPattern)) {\n    fillStyleColor = _ol_color_.asArray(fillStyleColor).map(function (c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || _ol_render_webgl_.defaultFillStyle;\n  } else {\n    fillStyleColor = _ol_render_webgl_.defaultFillStyle;\n  }\n\n  if (!this.state_.fillColor || !_ol_array_.equals(fillStyleColor, this.state_.fillColor)) {\n    this.state_.fillColor = fillStyleColor;\n    this.state_.changed = true;\n    this.styles_.push(fillStyleColor);\n  } //Provide a null stroke style, if no strokeStyle is provided. Required for the draw interaction to work.\n\n\n  if (strokeStyle) {\n    this.lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n  } else {\n    var nullStrokeStyle = new _ol_style_Stroke_({\n      color: [0, 0, 0, 0],\n      lineWidth: 0\n    });\n    this.lineStringReplay.setFillStrokeStyle(null, nullStrokeStyle);\n  }\n};\n\nexport default _ol_render_webgl_PolygonReplay_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/render/webgl/polygonreplay.js"],"names":["_ol_","_ol_array_","_ol_color_","_ol_extent_","_ol_obj_","_ol_geom_flat_contains_","_ol_geom_flat_orient_","_ol_geom_flat_transform_","_ol_render_webgl_polygonreplay_defaultshader_","_ol_render_webgl_polygonreplay_defaultshader_Locations_","_ol_render_webgl_LineStringReplay_","_ol_render_webgl_Replay_","_ol_render_webgl_","_ol_style_Stroke_","_ol_structs_LinkedList_","_ol_structs_RBush_","_ol_webgl_","_ol_webgl_Buffer_","_ol_render_webgl_PolygonReplay_","tolerance","maxExtent","call","lineStringReplay","defaultLocations_","styles_","styleIndices_","state_","fillColor","changed","inherits","prototype","drawCoordinates_","flatCoordinates","holeFlatCoordinates","stride","outerRing","rtree","processFlatCoordinates_","maxCoords","getMaxCoords_","length","i","ii","holeLists","holeList","list","undefined","push","classifyPoints_","sort","a","b","currList","start","firstItem","currItem","intersection","getIntersections_","nextItem","bridgeHole_","concat","triangulate_","clockwise","isClockwise","linearRingIsClockwise","n","vertices","p0","p1","extents","segments","createPoint_","insertItem_","Math","min","x","y","max","end","load","seg","ccw","s0","s1","pointsReclassified","reflex","triangleIsCounterClockwise","removeItem_","getNextItem","prevItem","hole","holeMaxX","listMaxX","p2","minDist","Infinity","bestPoint","p5","intersectingSegments","currSeg","calculateIntersection_","dist","abs","pointsInTriangle","getPointsInTriangle_","theta","currPoint","currTheta","atan2","p0Bridge","p1Bridge","setFirstItem","simple","isSimple_","getLength","clipEars_","resolveSelfIntersections_","splitPolygon_","isClockwise_","numIndices","indices","getPrevItem","getCurrItem","s2","s3","processedEars","variableCriterion","diagonalIsInside_","opt_touch","resolvedIntersections","breakCond","numVertices","removeItem","remove","p","update","Array","intersections","newPolygon","newRtree","opt_rtree","insertItem","insert","opt_reflex","j","result","segmentsInExtent","getInExtent","indexOf","linearRingContainsXY","segment","p3","denom","ua","ub","EPSILON","p4","p1IsLeftOf","p1IsRightOf","p3IsLeftOf","p3IsRightOf","p1InCone","p3InCone","drawMultiPolygon","multiPolygonGeometry","feature","endss","getEndss","getStride","currIndex","currLineIndex","getCurrentIndex","getFlatCoordinates","jj","ends","translate","origin","holes","holeFlatCoords","drawPolygonCoordinates","startIndices","startIndicesFeature","setPolygonStyle","drawPolygon","polygonGeometry","getEnds","map","Number","finish","context","verticesBuffer","indicesBuffer","getDeleteResourcesFunction","lineDeleter","deleteBuffer","setUpProgram","gl","size","pixelRatio","fragmentShader","vertexShader","fragment","vertex","program","getProgram","locations","useProgram","enableVertexAttribArray","a_position","vertexAttribPointer","FLOAT","shutDownProgram","disableVertexAttribArray","drawReplay","skippedFeaturesHash","hitDetection","tmpDepthFunc","getParameter","DEPTH_FUNC","tmpDepthMask","DEPTH_WRITEMASK","enable","DEPTH_TEST","depthMask","depthFunc","NOTEQUAL","isEmpty","drawReplaySkipping_","nextStyle","setFillStyle_","drawElements","disable","clear","DEPTH_BUFFER_BIT","drawHitDetectionReplayOneByOne","featureCallback","opt_hitExtent","groupStart","featureUid","featureIndex","getUid","toString","getGeometry","intersects","getExtent","COLOR_BUFFER_BIT","featureStart","color","uniform4fv","u_color","setFillStrokeStyle","fillStyle","strokeStyle","fillStyleColor","getColor","CanvasGradient","CanvasPattern","asArray","c","defaultFillStyle","equals","nullStrokeStyle","lineWidth"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_color_ from '../../color.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_geom_flat_contains_ from '../../geom/flat/contains.js';\nimport _ol_geom_flat_orient_ from '../../geom/flat/orient.js';\nimport _ol_geom_flat_transform_ from '../../geom/flat/transform.js';\nimport _ol_render_webgl_polygonreplay_defaultshader_ from '../webgl/polygonreplay/defaultshader.js';\nimport _ol_render_webgl_polygonreplay_defaultshader_Locations_ from '../webgl/polygonreplay/defaultshader/locations.js';\nimport _ol_render_webgl_LineStringReplay_ from '../webgl/linestringreplay.js';\nimport _ol_render_webgl_Replay_ from '../webgl/replay.js';\nimport _ol_render_webgl_ from '../webgl.js';\nimport _ol_style_Stroke_ from '../../style/stroke.js';\nimport _ol_structs_LinkedList_ from '../../structs/linkedlist.js';\nimport _ol_structs_RBush_ from '../../structs/rbush.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\n\n/**\n * @constructor\n * @extends {ol.render.webgl.Replay}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\nvar _ol_render_webgl_PolygonReplay_ = function(tolerance, maxExtent) {\n  _ol_render_webgl_Replay_.call(this, tolerance, maxExtent);\n\n  this.lineStringReplay = new _ol_render_webgl_LineStringReplay_(\n      tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {ol.render.webgl.polygonreplay.defaultshader.Locations}\n   */\n  this.defaultLocations_ = null;\n\n  /**\n   * @private\n   * @type {Array.<Array.<number>>}\n   */\n  this.styles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.styleIndices_ = [];\n\n  /**\n   * @private\n   * @type {{fillColor: (Array.<number>|null),\n   *         changed: boolean}|null}\n   */\n  this.state_ = {\n    fillColor: null,\n    changed: false\n  };\n\n};\n\n_ol_.inherits(_ol_render_webgl_PolygonReplay_, _ol_render_webgl_Replay_);\n\n\n/**\n * Draw one polygon.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n * @private\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawCoordinates_ = function(\n    flatCoordinates, holeFlatCoordinates, stride) {\n  // Triangulate the polygon\n  var outerRing = new _ol_structs_LinkedList_();\n  var rtree = new _ol_structs_RBush_();\n  // Initialize the outer ring\n  this.processFlatCoordinates_(flatCoordinates, stride, outerRing, rtree, true);\n  var maxCoords = this.getMaxCoords_(outerRing);\n\n  // Eliminate holes, if there are any\n  if (holeFlatCoordinates.length) {\n    var i, ii;\n    var holeLists = [];\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      var holeList = {\n        list: new _ol_structs_LinkedList_(),\n        maxCoords: undefined,\n        rtree: new _ol_structs_RBush_()\n      };\n      holeLists.push(holeList);\n      this.processFlatCoordinates_(holeFlatCoordinates[i],\n          stride, holeList.list, holeList.rtree, false);\n      this.classifyPoints_(holeList.list, holeList.rtree, true);\n      holeList.maxCoords = this.getMaxCoords_(holeList.list);\n    }\n    holeLists.sort(function(a, b) {\n      return b.maxCoords[0] === a.maxCoords[0] ?\n        a.maxCoords[1] - b.maxCoords[1] : b.maxCoords[0] - a.maxCoords[0];\n    });\n    for (i = 0; i < holeLists.length; ++i) {\n      var currList = holeLists[i].list;\n      var start = currList.firstItem();\n      var currItem = start;\n      var intersection;\n      do {\n        //TODO: Triangulate holes when they intersect the outer ring.\n        if (this.getIntersections_(currItem, rtree).length) {\n          intersection = true;\n          break;\n        }\n        currItem = currList.nextItem();\n      } while (start !== currItem);\n      if (!intersection) {\n        if (this.bridgeHole_(currList, holeLists[i].maxCoords[0], outerRing, maxCoords[0], rtree)) {\n          rtree.concat(holeLists[i].rtree);\n          this.classifyPoints_(outerRing, rtree, false);\n        }\n      }\n    }\n  } else {\n    this.classifyPoints_(outerRing, rtree, false);\n  }\n  this.triangulate_(outerRing, rtree);\n};\n\n\n/**\n * Inserts flat coordinates in a linked list and adds them to the vertex buffer.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {ol.structs.LinkedList} list Linked list.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} clockwise Coordinate order should be clockwise.\n */\n_ol_render_webgl_PolygonReplay_.prototype.processFlatCoordinates_ = function(\n    flatCoordinates, stride, list, rtree, clockwise) {\n  var isClockwise = _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates,\n      0, flatCoordinates.length, stride);\n  var i, ii;\n  var n = this.vertices.length / 2;\n  /** @type {ol.WebglPolygonVertex} */\n  var start;\n  /** @type {ol.WebglPolygonVertex} */\n  var p0;\n  /** @type {ol.WebglPolygonVertex} */\n  var p1;\n  var extents = [];\n  var segments = [];\n  if (clockwise === isClockwise) {\n    start = this.createPoint_(flatCoordinates[0], flatCoordinates[1], n++);\n    p0 = start;\n    for (i = stride, ii = flatCoordinates.length; i < ii; i += stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n        Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n      Math.max(p0.y, p1.y)]);\n  } else {\n    var end = flatCoordinates.length - stride;\n    start = this.createPoint_(flatCoordinates[end], flatCoordinates[end + 1], n++);\n    p0 = start;\n    for (i = end - stride, ii = 0; i >= ii; i -= stride) {\n      p1 = this.createPoint_(flatCoordinates[i], flatCoordinates[i + 1], n++);\n      segments.push(this.insertItem_(p0, p1, list));\n      extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n        Math.max(p0.y, p1.y)]);\n      p0 = p1;\n    }\n    segments.push(this.insertItem_(p1, start, list));\n    extents.push([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y), Math.max(p0.x, p1.x),\n      Math.max(p0.y, p1.y)]);\n  }\n  rtree.load(extents, segments);\n};\n\n\n/**\n * Returns the rightmost coordinates of a polygon on the X axis.\n * @private\n * @param {ol.structs.LinkedList} list Polygons ring.\n * @return {Array.<number>} Max X coordinates.\n */\n_ol_render_webgl_PolygonReplay_.prototype.getMaxCoords_ = function(list) {\n  var start = list.firstItem();\n  var seg = start;\n  var maxCoords = [seg.p0.x, seg.p0.y];\n\n  do {\n    seg = list.nextItem();\n    if (seg.p0.x > maxCoords[0]) {\n      maxCoords = [seg.p0.x, seg.p0.y];\n    }\n  } while (seg !== start);\n\n  return maxCoords;\n};\n\n\n/**\n * Classifies the points of a polygon list as convex, reflex. Removes collinear vertices.\n * @private\n * @param {ol.structs.LinkedList} list Polygon ring.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} ccw The orientation of the polygon is counter-clockwise.\n * @return {boolean} There were reclassified points.\n */\n_ol_render_webgl_PolygonReplay_.prototype.classifyPoints_ = function(list, rtree, ccw) {\n  var start = list.firstItem();\n  var s0 = start;\n  var s1 = list.nextItem();\n  var pointsReclassified = false;\n  do {\n    var reflex = ccw ? _ol_render_webgl_.triangleIsCounterClockwise(s1.p1.x,\n        s1.p1.y, s0.p1.x, s0.p1.y, s0.p0.x, s0.p0.y) :\n      _ol_render_webgl_.triangleIsCounterClockwise(s0.p0.x, s0.p0.y, s0.p1.x,\n          s0.p1.y, s1.p1.x, s1.p1.y);\n    if (reflex === undefined) {\n      this.removeItem_(s0, s1, list, rtree);\n      pointsReclassified = true;\n      if (s1 === start) {\n        start = list.getNextItem();\n      }\n      s1 = s0;\n      list.prevItem();\n    } else if (s0.p1.reflex !== reflex) {\n      s0.p1.reflex = reflex;\n      pointsReclassified = true;\n    }\n    s0 = s1;\n    s1 = list.nextItem();\n  } while (s0 !== start);\n  return pointsReclassified;\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} hole Linked list of the hole.\n * @param {number} holeMaxX Maximum X value of the hole.\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {number} listMaxX Maximum X value of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @return {boolean} Bridging was successful.\n */\n_ol_render_webgl_PolygonReplay_.prototype.bridgeHole_ = function(hole, holeMaxX,\n    list, listMaxX, rtree) {\n  var seg = hole.firstItem();\n  while (seg.p1.x !== holeMaxX) {\n    seg = hole.nextItem();\n  }\n\n  var p1 = seg.p1;\n  /** @type {ol.WebglPolygonVertex} */\n  var p2 = {x: listMaxX, y: p1.y, i: -1};\n  var minDist = Infinity;\n  var i, ii, bestPoint;\n  /** @type {ol.WebglPolygonVertex} */\n  var p5;\n\n  var intersectingSegments = this.getIntersections_({p0: p1, p1: p2}, rtree, true);\n  for (i = 0, ii = intersectingSegments.length; i < ii; ++i) {\n    var currSeg = intersectingSegments[i];\n    var intersection = this.calculateIntersection_(p1, p2, currSeg.p0,\n        currSeg.p1, true);\n    var dist = Math.abs(p1.x - intersection[0]);\n    if (dist < minDist && _ol_render_webgl_.triangleIsCounterClockwise(p1.x, p1.y,\n        currSeg.p0.x, currSeg.p0.y, currSeg.p1.x, currSeg.p1.y) !== undefined) {\n      minDist = dist;\n      p5 = {x: intersection[0], y: intersection[1], i: -1};\n      seg = currSeg;\n    }\n  }\n  if (minDist === Infinity) {\n    return false;\n  }\n  bestPoint = seg.p1;\n\n  if (minDist > 0) {\n    var pointsInTriangle = this.getPointsInTriangle_(p1, p5, seg.p1, rtree);\n    if (pointsInTriangle.length) {\n      var theta = Infinity;\n      for (i = 0, ii = pointsInTriangle.length; i < ii; ++i) {\n        var currPoint = pointsInTriangle[i];\n        var currTheta = Math.atan2(p1.y - currPoint.y, p2.x - currPoint.x);\n        if (currTheta < theta || (currTheta === theta && currPoint.x < bestPoint.x)) {\n          theta = currTheta;\n          bestPoint = currPoint;\n        }\n      }\n    }\n  }\n\n  seg = list.firstItem();\n  while (seg.p1.x !== bestPoint.x || seg.p1.y !== bestPoint.y) {\n    seg = list.nextItem();\n  }\n\n  //We clone the bridge points as they can have different convexity.\n  var p0Bridge = {x: p1.x, y: p1.y, i: p1.i, reflex: undefined};\n  var p1Bridge = {x: seg.p1.x, y: seg.p1.y, i: seg.p1.i, reflex: undefined};\n\n  hole.getNextItem().p0 = p0Bridge;\n  this.insertItem_(p1, seg.p1, hole, rtree);\n  this.insertItem_(p1Bridge, p0Bridge, hole, rtree);\n  seg.p1 = p1Bridge;\n  hole.setFirstItem();\n  list.concat(hole);\n\n  return true;\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n */\n_ol_render_webgl_PolygonReplay_.prototype.triangulate_ = function(list, rtree) {\n  var ccw = false;\n  var simple = this.isSimple_(list, rtree);\n\n  // Start clipping ears\n  while (list.getLength() > 3) {\n    if (simple) {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // Due to the behavior of OL's PIP algorithm, the ear clipping cannot\n          // introduce touching segments. However, the original data may have some.\n          if (!this.resolveSelfIntersections_(list, rtree, true)) {\n            break;\n          }\n        }\n      }\n    } else {\n      if (!this.clipEars_(list, rtree, simple, ccw)) {\n        // We ran out of ears, try to reclassify.\n        if (!this.classifyPoints_(list, rtree, ccw)) {\n          // We have a bad polygon, try to resolve local self-intersections.\n          if (!this.resolveSelfIntersections_(list, rtree)) {\n            simple = this.isSimple_(list, rtree);\n            if (!simple) {\n              // We have a really bad polygon, try more time consuming methods.\n              this.splitPolygon_(list, rtree);\n              break;\n            } else {\n              ccw = !this.isClockwise_(list);\n              this.classifyPoints_(list, rtree, ccw);\n            }\n          }\n        }\n      }\n    }\n  }\n  if (list.getLength() === 3) {\n    var numIndices = this.indices.length;\n    this.indices[numIndices++] = list.getPrevItem().p0.i;\n    this.indices[numIndices++] = list.getCurrItem().p0.i;\n    this.indices[numIndices++] = list.getNextItem().p0.i;\n  }\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean} simple The polygon is simple.\n * @param {boolean} ccw Orientation of the polygon is counter-clockwise.\n * @return {boolean} There were processed ears.\n */\n_ol_render_webgl_PolygonReplay_.prototype.clipEars_ = function(list, rtree, simple, ccw) {\n  var numIndices = this.indices.length;\n  var start = list.firstItem();\n  var s0 = list.getPrevItem();\n  var s1 = start;\n  var s2 = list.nextItem();\n  var s3 = list.getNextItem();\n  var p0, p1, p2;\n  var processedEars = false;\n  do {\n    p0 = s1.p0;\n    p1 = s1.p1;\n    p2 = s2.p1;\n    if (p1.reflex === false) {\n      // We might have a valid ear\n      var variableCriterion;\n      if (simple) {\n        variableCriterion = this.getPointsInTriangle_(p0, p1, p2, rtree, true).length === 0;\n      } else {\n        variableCriterion = ccw ? this.diagonalIsInside_(s3.p1, p2, p1, p0,\n            s0.p0) : this.diagonalIsInside_(s0.p0, p0, p1, p2, s3.p1);\n      }\n      if ((simple || this.getIntersections_({p0: p0, p1: p2}, rtree).length === 0) &&\n          variableCriterion) {\n        //The diagonal is completely inside the polygon\n        if (simple || p0.reflex === false || p2.reflex === false ||\n            _ol_geom_flat_orient_.linearRingIsClockwise([s0.p0.x, s0.p0.y, p0.x,\n              p0.y, p1.x, p1.y, p2.x, p2.y, s3.p1.x, s3.p1.y], 0, 10, 2) === !ccw) {\n          //The diagonal is persumably valid, we have an ear\n          this.indices[numIndices++] = p0.i;\n          this.indices[numIndices++] = p1.i;\n          this.indices[numIndices++] = p2.i;\n          this.removeItem_(s1, s2, list, rtree);\n          if (s2 === start) {\n            start = s3;\n          }\n          processedEars = true;\n        }\n      }\n    }\n    // Else we have a reflex point.\n    s0 = list.getPrevItem();\n    s1 = list.getCurrItem();\n    s2 = list.nextItem();\n    s3 = list.getNextItem();\n  } while (s1 !== start && list.getLength() > 3);\n\n  return processedEars;\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Resolve touching segments.\n * @return {boolean} There were resolved intersections.\n*/\n_ol_render_webgl_PolygonReplay_.prototype.resolveSelfIntersections_ = function(\n    list, rtree, opt_touch) {\n  var start = list.firstItem();\n  list.nextItem();\n  var s0 = start;\n  var s1 = list.nextItem();\n  var resolvedIntersections = false;\n\n  do {\n    var intersection = this.calculateIntersection_(s0.p0, s0.p1, s1.p0, s1.p1,\n        opt_touch);\n    if (intersection) {\n      var breakCond = false;\n      var numVertices = this.vertices.length;\n      var numIndices = this.indices.length;\n      var n = numVertices / 2;\n      var seg = list.prevItem();\n      list.removeItem();\n      rtree.remove(seg);\n      breakCond = (seg === start);\n      var p;\n      if (opt_touch) {\n        if (intersection[0] === s0.p0.x && intersection[1] === s0.p0.y) {\n          list.prevItem();\n          p = s0.p0;\n          s1.p0 = p;\n          rtree.remove(s0);\n          breakCond = breakCond || (s0 === start);\n        } else {\n          p = s1.p1;\n          s0.p1 = p;\n          rtree.remove(s1);\n          breakCond = breakCond || (s1 === start);\n        }\n        list.removeItem();\n      } else {\n        p = this.createPoint_(intersection[0], intersection[1], n);\n        s0.p1 = p;\n        s1.p0 = p;\n        rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y),\n          Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n        rtree.update([Math.min(s1.p0.x, s1.p1.x), Math.min(s1.p0.y, s1.p1.y),\n          Math.max(s1.p0.x, s1.p1.x), Math.max(s1.p0.y, s1.p1.y)], s1);\n      }\n\n      this.indices[numIndices++] = seg.p0.i;\n      this.indices[numIndices++] = seg.p1.i;\n      this.indices[numIndices++] = p.i;\n\n      resolvedIntersections = true;\n      if (breakCond) {\n        break;\n      }\n    }\n\n    s0 = list.getPrevItem();\n    s1 = list.nextItem();\n  } while (s0 !== start);\n  return resolvedIntersections;\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @return {boolean} The polygon is simple.\n */\n_ol_render_webgl_PolygonReplay_.prototype.isSimple_ = function(list, rtree) {\n  var start = list.firstItem();\n  var seg = start;\n  do {\n    if (this.getIntersections_(seg, rtree).length) {\n      return false;\n    }\n    seg = list.nextItem();\n  } while (seg !== start);\n  return true;\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @return {boolean} Orientation is clockwise.\n */\n_ol_render_webgl_PolygonReplay_.prototype.isClockwise_ = function(list) {\n  var length = list.getLength() * 2;\n  var flatCoordinates = new Array(length);\n  var start = list.firstItem();\n  var seg = start;\n  var i = 0;\n  do {\n    flatCoordinates[i++] = seg.p0.x;\n    flatCoordinates[i++] = seg.p0.y;\n    seg = list.nextItem();\n  } while (seg !== start);\n  return _ol_geom_flat_orient_.linearRingIsClockwise(flatCoordinates, 0, length, 2);\n};\n\n\n/**\n * @private\n * @param {ol.structs.LinkedList} list Linked list of the polygon.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n */\n_ol_render_webgl_PolygonReplay_.prototype.splitPolygon_ = function(list, rtree) {\n  var start = list.firstItem();\n  var s0 = start;\n  do {\n    var intersections = this.getIntersections_(s0, rtree);\n    if (intersections.length) {\n      var s1 = intersections[0];\n      var n = this.vertices.length / 2;\n      var intersection = this.calculateIntersection_(s0.p0,\n          s0.p1, s1.p0, s1.p1);\n      var p = this.createPoint_(intersection[0], intersection[1], n);\n      var newPolygon = new _ol_structs_LinkedList_();\n      var newRtree = new _ol_structs_RBush_();\n      this.insertItem_(p, s0.p1, newPolygon, newRtree);\n      s0.p1 = p;\n      rtree.update([Math.min(s0.p0.x, p.x), Math.min(s0.p0.y, p.y),\n        Math.max(s0.p0.x, p.x), Math.max(s0.p0.y, p.y)], s0);\n      var currItem = list.nextItem();\n      while (currItem !== s1) {\n        this.insertItem_(currItem.p0, currItem.p1, newPolygon, newRtree);\n        rtree.remove(currItem);\n        list.removeItem();\n        currItem = list.getCurrItem();\n      }\n      this.insertItem_(s1.p0, p, newPolygon, newRtree);\n      s1.p0 = p;\n      rtree.update([Math.min(s1.p1.x, p.x), Math.min(s1.p1.y, p.y),\n        Math.max(s1.p1.x, p.x), Math.max(s1.p1.y, p.y)], s1);\n      this.classifyPoints_(list, rtree, false);\n      this.triangulate_(list, rtree);\n      this.classifyPoints_(newPolygon, newRtree, false);\n      this.triangulate_(newPolygon, newRtree);\n      break;\n    }\n    s0 = list.nextItem();\n  } while (s0 !== start);\n};\n\n\n/**\n * @private\n * @param {number} x X coordinate.\n * @param {number} y Y coordinate.\n * @param {number} i Index.\n * @return {ol.WebglPolygonVertex} List item.\n */\n_ol_render_webgl_PolygonReplay_.prototype.createPoint_ = function(x, y, i) {\n  var numVertices = this.vertices.length;\n  this.vertices[numVertices++] = x;\n  this.vertices[numVertices++] = y;\n  /** @type {ol.WebglPolygonVertex} */\n  var p = {\n    x: x,\n    y: y,\n    i: i,\n    reflex: undefined\n  };\n  return p;\n};\n\n\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point of segment.\n * @param {ol.WebglPolygonVertex} p1 Second point of segment.\n * @param {ol.structs.LinkedList} list Polygon ring.\n * @param {ol.structs.RBush=} opt_rtree Insert the segment into the R-Tree.\n * @return {ol.WebglPolygonSegment} segment.\n */\n_ol_render_webgl_PolygonReplay_.prototype.insertItem_ = function(p0, p1, list, opt_rtree) {\n  var seg = {\n    p0: p0,\n    p1: p1\n  };\n  list.insertItem(seg);\n  if (opt_rtree) {\n    opt_rtree.insert([Math.min(p0.x, p1.x), Math.min(p0.y, p1.y),\n      Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)], seg);\n  }\n  return seg;\n};\n\n\n/**\n  * @private\n  * @param {ol.WebglPolygonSegment} s0 Segment before the remove candidate.\n  * @param {ol.WebglPolygonSegment} s1 Remove candidate segment.\n  * @param {ol.structs.LinkedList} list Polygon ring.\n  * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n  */\n_ol_render_webgl_PolygonReplay_.prototype.removeItem_ = function(s0, s1, list, rtree) {\n  if (list.getCurrItem() === s1) {\n    list.removeItem();\n    s0.p1 = s1.p1;\n    rtree.remove(s1);\n    rtree.update([Math.min(s0.p0.x, s0.p1.x), Math.min(s0.p0.y, s0.p1.y),\n      Math.max(s0.p0.x, s0.p1.x), Math.max(s0.p0.y, s0.p1.y)], s0);\n  }\n};\n\n\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point.\n * @param {ol.WebglPolygonVertex} p1 Second point.\n * @param {ol.WebglPolygonVertex} p2 Third point.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_reflex Only include reflex points.\n * @return {Array.<ol.WebglPolygonVertex>} Points in the triangle.\n */\n_ol_render_webgl_PolygonReplay_.prototype.getPointsInTriangle_ = function(p0, p1,\n    p2, rtree, opt_reflex) {\n  var i, ii, j, p;\n  var result = [];\n  var segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x, p2.x),\n    Math.min(p0.y, p1.y, p2.y), Math.max(p0.x, p1.x, p2.x), Math.max(p0.y,\n        p1.y, p2.y)]);\n  for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    for (j in segmentsInExtent[i]) {\n      p = segmentsInExtent[i][j];\n      if (typeof p === 'object' && (!opt_reflex || p.reflex)) {\n        if ((p.x !== p0.x || p.y !== p0.y) && (p.x !== p1.x || p.y !== p1.y) &&\n            (p.x !== p2.x || p.y !== p2.y) && result.indexOf(p) === -1 &&\n            _ol_geom_flat_contains_.linearRingContainsXY([p0.x, p0.y, p1.x, p1.y,\n              p2.x, p2.y], 0, 6, 2, p.x, p.y)) {\n          result.push(p);\n        }\n      }\n    }\n  }\n  return result;\n};\n\n\n/**\n * @private\n * @param {ol.WebglPolygonSegment} segment Segment.\n * @param {ol.structs.RBush} rtree R-Tree of the polygon.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<ol.WebglPolygonSegment>} Intersecting segments.\n */\n_ol_render_webgl_PolygonReplay_.prototype.getIntersections_ = function(segment, rtree, opt_touch) {\n  var p0 = segment.p0;\n  var p1 = segment.p1;\n  var segmentsInExtent = rtree.getInExtent([Math.min(p0.x, p1.x),\n    Math.min(p0.y, p1.y), Math.max(p0.x, p1.x), Math.max(p0.y, p1.y)]);\n  var result = [];\n  var i, ii;\n  for (i = 0, ii = segmentsInExtent.length; i < ii; ++i) {\n    var currSeg = segmentsInExtent[i];\n    if (segment !== currSeg && (opt_touch || currSeg.p0 !== p1 || currSeg.p1 !== p0) &&\n        this.calculateIntersection_(p0, p1, currSeg.p0, currSeg.p1, opt_touch)) {\n      result.push(currSeg);\n    }\n  }\n  return result;\n};\n\n\n/**\n * Line intersection algorithm by Paul Bourke.\n * @see http://paulbourke.net/geometry/pointlineplane/\n *\n * @private\n * @param {ol.WebglPolygonVertex} p0 First point.\n * @param {ol.WebglPolygonVertex} p1 Second point.\n * @param {ol.WebglPolygonVertex} p2 Third point.\n * @param {ol.WebglPolygonVertex} p3 Fourth point.\n * @param {boolean=} opt_touch Touching segments should be considered an intersection.\n * @return {Array.<number>|undefined} Intersection coordinates.\n */\n_ol_render_webgl_PolygonReplay_.prototype.calculateIntersection_ = function(p0,\n    p1, p2, p3, opt_touch) {\n  var denom = (p3.y - p2.y) * (p1.x - p0.x) - (p3.x - p2.x) * (p1.y - p0.y);\n  if (denom !== 0) {\n    var ua = ((p3.x - p2.x) * (p0.y - p2.y) - (p3.y - p2.y) * (p0.x - p2.x)) / denom;\n    var ub = ((p1.x - p0.x) * (p0.y - p2.y) - (p1.y - p0.y) * (p0.x - p2.x)) / denom;\n    if ((!opt_touch && ua > _ol_render_webgl_.EPSILON && ua < 1 - _ol_render_webgl_.EPSILON &&\n        ub > _ol_render_webgl_.EPSILON && ub < 1 - _ol_render_webgl_.EPSILON) || (opt_touch &&\n        ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1)) {\n      return [p0.x + ua * (p1.x - p0.x), p0.y + ua * (p1.y - p0.y)];\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {ol.WebglPolygonVertex} p0 Point before the start of the diagonal.\n * @param {ol.WebglPolygonVertex} p1 Start point of the diagonal.\n * @param {ol.WebglPolygonVertex} p2 Ear candidate.\n * @param {ol.WebglPolygonVertex} p3 End point of the diagonal.\n * @param {ol.WebglPolygonVertex} p4 Point after the end of the diagonal.\n * @return {boolean} Diagonal is inside the polygon.\n */\n_ol_render_webgl_PolygonReplay_.prototype.diagonalIsInside_ = function(p0, p1, p2, p3, p4) {\n  if (p1.reflex === undefined || p3.reflex === undefined) {\n    return false;\n  }\n  var p1IsLeftOf = (p2.x - p3.x) * (p1.y - p3.y) > (p2.y - p3.y) * (p1.x - p3.x);\n  var p1IsRightOf = (p4.x - p3.x) * (p1.y - p3.y) < (p4.y - p3.y) * (p1.x - p3.x);\n  var p3IsLeftOf = (p0.x - p1.x) * (p3.y - p1.y) > (p0.y - p1.y) * (p3.x - p1.x);\n  var p3IsRightOf = (p2.x - p1.x) * (p3.y - p1.y) < (p2.y - p1.y) * (p3.x - p1.x);\n  var p1InCone = p3.reflex ? p1IsRightOf || p1IsLeftOf : p1IsRightOf && p1IsLeftOf;\n  var p3InCone = p1.reflex ? p3IsRightOf || p3IsLeftOf : p3IsRightOf && p3IsLeftOf;\n  return p1InCone && p3InCone;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawMultiPolygon = function(multiPolygonGeometry, feature) {\n  var endss = multiPolygonGeometry.getEndss();\n  var stride = multiPolygonGeometry.getStride();\n  var currIndex = this.indices.length;\n  var currLineIndex = this.lineStringReplay.getCurrentIndex();\n  var flatCoordinates = multiPolygonGeometry.getFlatCoordinates();\n  var i, ii, j, jj;\n  var start = 0;\n  for (i = 0, ii = endss.length; i < ii; ++i) {\n    var ends = endss[i];\n    if (ends.length > 0) {\n      var outerRing = _ol_geom_flat_transform_.translate(flatCoordinates, start, ends[0],\n          stride, -this.origin[0], -this.origin[1]);\n      if (outerRing.length) {\n        var holes = [];\n        var holeFlatCoords;\n        for (j = 1, jj = ends.length; j < jj; ++j) {\n          if (ends[j] !== ends[j - 1]) {\n            holeFlatCoords = _ol_geom_flat_transform_.translate(flatCoordinates, ends[j - 1],\n                ends[j], stride, -this.origin[0], -this.origin[1]);\n            holes.push(holeFlatCoords);\n          }\n        }\n        this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n        this.drawCoordinates_(outerRing, holes, stride);\n      }\n    }\n    start = ends[ends.length - 1];\n  }\n  if (this.indices.length > currIndex) {\n    this.startIndices.push(currIndex);\n    this.startIndicesFeature.push(feature);\n    if (this.state_.changed) {\n      this.styleIndices_.push(currIndex);\n      this.state_.changed = false;\n    }\n  }\n  if (this.lineStringReplay.getCurrentIndex() > currLineIndex) {\n    this.lineStringReplay.setPolygonStyle(feature, currLineIndex);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawPolygon = function(polygonGeometry, feature) {\n  var ends = polygonGeometry.getEnds();\n  var stride = polygonGeometry.getStride();\n  if (ends.length > 0) {\n    var flatCoordinates = polygonGeometry.getFlatCoordinates().map(Number);\n    var outerRing = _ol_geom_flat_transform_.translate(flatCoordinates, 0, ends[0],\n        stride, -this.origin[0], -this.origin[1]);\n    if (outerRing.length) {\n      var holes = [];\n      var i, ii, holeFlatCoords;\n      for (i = 1, ii = ends.length; i < ii; ++i) {\n        if (ends[i] !== ends[i - 1]) {\n          holeFlatCoords = _ol_geom_flat_transform_.translate(flatCoordinates, ends[i - 1],\n              ends[i], stride, -this.origin[0], -this.origin[1]);\n          holes.push(holeFlatCoords);\n        }\n      }\n\n      this.startIndices.push(this.indices.length);\n      this.startIndicesFeature.push(feature);\n      if (this.state_.changed) {\n        this.styleIndices_.push(this.indices.length);\n        this.state_.changed = false;\n      }\n      this.lineStringReplay.setPolygonStyle(feature);\n\n      this.lineStringReplay.drawPolygonCoordinates(outerRing, holes, stride);\n      this.drawCoordinates_(outerRing, holes, stride);\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n **/\n_ol_render_webgl_PolygonReplay_.prototype.finish = function(context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new _ol_webgl_Buffer_(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new _ol_webgl_Buffer_(this.indices);\n\n  this.startIndices.push(this.indices.length);\n\n  this.lineStringReplay.finish(context);\n\n  //Clean up, if there is nothing to draw\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.getDeleteResourcesFunction = function(context) {\n  var verticesBuffer = this.verticesBuffer;\n  var indicesBuffer = this.indicesBuffer;\n  var lineDeleter = this.lineStringReplay.getDeleteResourcesFunction(context);\n  return function() {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n    lineDeleter();\n  };\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  var fragmentShader, vertexShader;\n  fragmentShader = _ol_render_webgl_polygonreplay_defaultshader_.fragment;\n  vertexShader = _ol_render_webgl_polygonreplay_defaultshader_.vertex;\n  var program = context.getProgram(fragmentShader, vertexShader);\n\n  // get the locations\n  var locations;\n  if (!this.defaultLocations_) {\n    locations = new _ol_render_webgl_polygonreplay_defaultshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, _ol_webgl_.FLOAT,\n      false, 8, 0);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_position);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  var tmpDepthFunc = /** @type {number} */ (gl.getParameter(gl.DEPTH_FUNC));\n  var tmpDepthMask = /** @type {boolean} */ (gl.getParameter(gl.DEPTH_WRITEMASK));\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!_ol_obj_.isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    var i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setFillStyle_(gl, nextStyle);\n      this.drawElements(gl, context, start, end);\n      end = start;\n    }\n  }\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT);\n    //Restore GL parameters.\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n    featureCallback, opt_hitExtent) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || _ol_extent_.intersects(\n              /** @type {Array<number>} */ (opt_hitExtent),\n              feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        var result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n\n      }\n      featureIndex--;\n      end = start;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\n_ol_render_webgl_PolygonReplay_.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setFillStyle_(gl, nextStyle);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        end = featureStart;\n      }\n      featureIndex--;\n      start = featureStart;\n    }\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n    start = end = groupStart;\n  }\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n */\n_ol_render_webgl_PolygonReplay_.prototype.setFillStyle_ = function(gl, color) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_PolygonReplay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  var fillStyleColor = fillStyle ? fillStyle.getColor() : [0, 0, 0, 0];\n  if (!(fillStyleColor instanceof CanvasGradient) &&\n      !(fillStyleColor instanceof CanvasPattern)) {\n    fillStyleColor = _ol_color_.asArray(fillStyleColor).map(function(c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || _ol_render_webgl_.defaultFillStyle;\n  } else {\n    fillStyleColor = _ol_render_webgl_.defaultFillStyle;\n  }\n  if (!this.state_.fillColor || !_ol_array_.equals(fillStyleColor, this.state_.fillColor)) {\n    this.state_.fillColor = fillStyleColor;\n    this.state_.changed = true;\n    this.styles_.push(fillStyleColor);\n  }\n  //Provide a null stroke style, if no strokeStyle is provided. Required for the draw interaction to work.\n  if (strokeStyle) {\n    this.lineStringReplay.setFillStrokeStyle(null, strokeStyle);\n  } else {\n    var nullStrokeStyle = new _ol_style_Stroke_({\n      color: [0, 0, 0, 0],\n      lineWidth: 0\n    });\n    this.lineStringReplay.setFillStrokeStyle(null, nullStrokeStyle);\n  }\n};\nexport default _ol_render_webgl_PolygonReplay_;\n"]},"metadata":{},"sourceType":"module"}