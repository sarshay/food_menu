{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_LayerType_ from '../../layertype.js';\nimport _ol_ViewHint_ from '../../viewhint.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_render_webgl_ReplayGroup_ from '../../render/webgl/replaygroup.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_renderer_vector_ from '../vector.js';\nimport _ol_renderer_webgl_Layer_ from '../webgl/layer.js';\nimport _ol_transform_ from '../../transform.js';\n/**\n * @constructor\n * @extends {ol.renderer.webgl.Layer}\n * @param {ol.renderer.webgl.Map} mapRenderer Map renderer.\n * @param {ol.layer.Vector} vectorLayer Vector layer.\n * @api\n */\n\nvar _ol_renderer_webgl_VectorLayer_ = function (mapRenderer, vectorLayer) {\n  _ol_renderer_webgl_Layer_.call(this, mapRenderer, vectorLayer);\n  /**\n   * @private\n   * @type {boolean}\n   */\n\n\n  this.dirty_ = false;\n  /**\n   * @private\n   * @type {number}\n   */\n\n  this.renderedRevision_ = -1;\n  /**\n   * @private\n   * @type {number}\n   */\n\n  this.renderedResolution_ = NaN;\n  /**\n   * @private\n   * @type {ol.Extent}\n   */\n\n  this.renderedExtent_ = _ol_extent_.createEmpty();\n  /**\n   * @private\n   * @type {function(ol.Feature, ol.Feature): number|null}\n   */\n\n  this.renderedRenderOrder_ = null;\n  /**\n   * @private\n   * @type {ol.render.webgl.ReplayGroup}\n   */\n\n  this.replayGroup_ = null;\n  /**\n   * The last layer state.\n   * @private\n   * @type {?ol.LayerState}\n   */\n\n  this.layerState_ = null;\n};\n\n_ol_.inherits(_ol_renderer_webgl_VectorLayer_, _ol_renderer_webgl_Layer_);\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @param {ol.layer.Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\n\n\n_ol_renderer_webgl_VectorLayer_['handles'] = function (type, layer) {\n  return type === _ol_renderer_Type_.WEBGL && layer.getType() === _ol_LayerType_.VECTOR;\n};\n/**\n * Create a layer renderer.\n * @param {ol.renderer.Map} mapRenderer The map renderer.\n * @param {ol.layer.Layer} layer The layer to be rendererd.\n * @return {ol.renderer.webgl.VectorLayer} The layer renderer.\n */\n\n\n_ol_renderer_webgl_VectorLayer_['create'] = function (mapRenderer, layer) {\n  return new _ol_renderer_webgl_VectorLayer_(\n  /** @type {ol.renderer.webgl.Map} */\n  mapRenderer,\n  /** @type {ol.layer.Vector} */\n  layer);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.composeFrame = function (frameState, layerState, context) {\n  this.layerState_ = layerState;\n  var viewState = frameState.viewState;\n  var replayGroup = this.replayGroup_;\n  var size = frameState.size;\n  var pixelRatio = frameState.pixelRatio;\n  var gl = this.mapRenderer.getGL();\n\n  if (replayGroup && !replayGroup.isEmpty()) {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(0, 0, size[0] * pixelRatio, size[1] * pixelRatio);\n    replayGroup.replay(context, viewState.center, viewState.resolution, viewState.rotation, size, pixelRatio, layerState.opacity, layerState.managed ? frameState.skippedFeatureUids : {});\n    gl.disable(gl.SCISSOR_TEST);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.disposeInternal = function () {\n  var replayGroup = this.replayGroup_;\n\n  if (replayGroup) {\n    var context = this.mapRenderer.getContext();\n    replayGroup.getDeleteResourcesFunction(context)();\n    this.replayGroup_ = null;\n  }\n\n  _ol_renderer_webgl_Layer_.prototype.disposeInternal.call(this);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return undefined;\n  } else {\n    var context = this.mapRenderer.getContext();\n    var viewState = frameState.viewState;\n    var layer = this.getLayer();\n    var layerState = this.layerState_;\n    /** @type {Object.<string, boolean>} */\n\n    var features = {};\n    return this.replayGroup_.forEachFeatureAtCoordinate(coordinate, context, viewState.center, viewState.resolution, viewState.rotation, frameState.size, frameState.pixelRatio, layerState.opacity, {},\n    /**\n     * @param {ol.Feature|ol.render.Feature} feature Feature.\n     * @return {?} Callback result.\n     */\n    function (feature) {\n      var key = _ol_.getUid(feature).toString();\n\n      if (!(key in features)) {\n        features[key] = true;\n        return callback.call(thisArg, feature, layer);\n      }\n    });\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.hasFeatureAtCoordinate = function (coordinate, frameState) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return false;\n  } else {\n    var context = this.mapRenderer.getContext();\n    var viewState = frameState.viewState;\n    var layerState = this.layerState_;\n    return this.replayGroup_.hasFeatureAtCoordinate(coordinate, context, viewState.center, viewState.resolution, viewState.rotation, frameState.size, frameState.pixelRatio, layerState.opacity, frameState.skippedFeatureUids);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.forEachLayerAtPixel = function (pixel, frameState, callback, thisArg) {\n  var coordinate = _ol_transform_.apply(frameState.pixelToCoordinateTransform, pixel.slice());\n\n  var hasFeature = this.hasFeatureAtCoordinate(coordinate, frameState);\n\n  if (hasFeature) {\n    return callback.call(thisArg, this.getLayer(), null);\n  } else {\n    return undefined;\n  }\n};\n/**\n * Handle changes in image style state.\n * @param {ol.events.Event} event Image style change event.\n * @private\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.handleStyleImageChange_ = function (event) {\n  this.renderIfReadyAndVisible();\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.prepareFrame = function (frameState, layerState, context) {\n  var vectorLayer =\n  /** @type {ol.layer.Vector} */\n  this.getLayer();\n  var vectorSource = vectorLayer.getSource();\n  this.updateLogos(frameState, vectorSource);\n  var animating = frameState.viewHints[_ol_ViewHint_.ANIMATING];\n  var interacting = frameState.viewHints[_ol_ViewHint_.INTERACTING];\n  var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n  var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n  if (!this.dirty_ && !updateWhileAnimating && animating || !updateWhileInteracting && interacting) {\n    return true;\n  }\n\n  var frameStateExtent = frameState.extent;\n  var viewState = frameState.viewState;\n  var projection = viewState.projection;\n  var resolution = viewState.resolution;\n  var pixelRatio = frameState.pixelRatio;\n  var vectorLayerRevision = vectorLayer.getRevision();\n  var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n  var vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n  if (vectorLayerRenderOrder === undefined) {\n    vectorLayerRenderOrder = _ol_renderer_vector_.defaultOrder;\n  }\n\n  var extent = _ol_extent_.buffer(frameStateExtent, vectorLayerRenderBuffer * resolution);\n\n  if (!this.dirty_ && this.renderedResolution_ == resolution && this.renderedRevision_ == vectorLayerRevision && this.renderedRenderOrder_ == vectorLayerRenderOrder && _ol_extent_.containsExtent(this.renderedExtent_, extent)) {\n    return true;\n  }\n\n  if (this.replayGroup_) {\n    frameState.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(context));\n  }\n\n  this.dirty_ = false;\n  var replayGroup = new _ol_render_webgl_ReplayGroup_(_ol_renderer_vector_.getTolerance(resolution, pixelRatio), extent, vectorLayer.getRenderBuffer());\n  vectorSource.loadFeatures(extent, resolution, projection);\n  /**\n   * @param {ol.Feature} feature Feature.\n   * @this {ol.renderer.webgl.VectorLayer}\n   */\n\n  var renderFeature = function (feature) {\n    var styles;\n    var styleFunction = feature.getStyleFunction();\n\n    if (styleFunction) {\n      styles = styleFunction.call(feature, resolution);\n    } else {\n      styleFunction = vectorLayer.getStyleFunction();\n\n      if (styleFunction) {\n        styles = styleFunction(feature, resolution);\n      }\n    }\n\n    if (styles) {\n      var dirty = this.renderFeature(feature, resolution, pixelRatio, styles, replayGroup);\n      this.dirty_ = this.dirty_ || dirty;\n    }\n  };\n\n  if (vectorLayerRenderOrder) {\n    /** @type {Array.<ol.Feature>} */\n    var features = [];\n    vectorSource.forEachFeatureInExtent(extent,\n    /**\n     * @param {ol.Feature} feature Feature.\n     */\n    function (feature) {\n      features.push(feature);\n    }, this);\n    features.sort(vectorLayerRenderOrder);\n    features.forEach(renderFeature, this);\n  } else {\n    vectorSource.forEachFeatureInExtent(extent, renderFeature, this);\n  }\n\n  replayGroup.finish(context);\n  this.renderedResolution_ = resolution;\n  this.renderedRevision_ = vectorLayerRevision;\n  this.renderedRenderOrder_ = vectorLayerRenderOrder;\n  this.renderedExtent_ = extent;\n  this.replayGroup_ = replayGroup;\n  return true;\n};\n/**\n * @param {ol.Feature} feature Feature.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {(ol.style.Style|Array.<ol.style.Style>)} styles The style or array of\n *     styles.\n * @param {ol.render.webgl.ReplayGroup} replayGroup Replay group.\n * @return {boolean} `true` if an image is loading.\n */\n\n\n_ol_renderer_webgl_VectorLayer_.prototype.renderFeature = function (feature, resolution, pixelRatio, styles, replayGroup) {\n  if (!styles) {\n    return false;\n  }\n\n  var loading = false;\n\n  if (Array.isArray(styles)) {\n    for (var i = styles.length - 1, ii = 0; i >= ii; --i) {\n      loading = _ol_renderer_vector_.renderFeature(replayGroup, feature, styles[i], _ol_renderer_vector_.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this) || loading;\n    }\n  } else {\n    loading = _ol_renderer_vector_.renderFeature(replayGroup, feature, styles, _ol_renderer_vector_.getSquaredTolerance(resolution, pixelRatio), this.handleStyleImageChange_, this) || loading;\n  }\n\n  return loading;\n};\n\nexport default _ol_renderer_webgl_VectorLayer_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/webgl/vectorlayer.js"],"names":["_ol_","_ol_LayerType_","_ol_ViewHint_","_ol_extent_","_ol_render_webgl_ReplayGroup_","_ol_renderer_Type_","_ol_renderer_vector_","_ol_renderer_webgl_Layer_","_ol_transform_","_ol_renderer_webgl_VectorLayer_","mapRenderer","vectorLayer","call","dirty_","renderedRevision_","renderedResolution_","NaN","renderedExtent_","createEmpty","renderedRenderOrder_","replayGroup_","layerState_","inherits","type","layer","WEBGL","getType","VECTOR","prototype","composeFrame","frameState","layerState","context","viewState","replayGroup","size","pixelRatio","gl","getGL","isEmpty","enable","SCISSOR_TEST","scissor","replay","center","resolution","rotation","opacity","managed","skippedFeatureUids","disable","disposeInternal","getContext","getDeleteResourcesFunction","forEachFeatureAtCoordinate","coordinate","hitTolerance","callback","thisArg","undefined","getLayer","features","feature","key","getUid","toString","hasFeatureAtCoordinate","forEachLayerAtPixel","pixel","apply","pixelToCoordinateTransform","slice","hasFeature","handleStyleImageChange_","event","renderIfReadyAndVisible","prepareFrame","vectorSource","getSource","updateLogos","animating","viewHints","ANIMATING","interacting","INTERACTING","updateWhileAnimating","getUpdateWhileAnimating","updateWhileInteracting","getUpdateWhileInteracting","frameStateExtent","extent","projection","vectorLayerRevision","getRevision","vectorLayerRenderBuffer","getRenderBuffer","vectorLayerRenderOrder","getRenderOrder","defaultOrder","buffer","containsExtent","postRenderFunctions","push","getTolerance","loadFeatures","renderFeature","styles","styleFunction","getStyleFunction","dirty","forEachFeatureInExtent","sort","forEach","finish","loading","Array","isArray","i","length","ii","getSquaredTolerance"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_LayerType_ from '../../layertype.js';\nimport _ol_ViewHint_ from '../../viewhint.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_render_webgl_ReplayGroup_ from '../../render/webgl/replaygroup.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_renderer_vector_ from '../vector.js';\nimport _ol_renderer_webgl_Layer_ from '../webgl/layer.js';\nimport _ol_transform_ from '../../transform.js';\n\n/**\n * @constructor\n * @extends {ol.renderer.webgl.Layer}\n * @param {ol.renderer.webgl.Map} mapRenderer Map renderer.\n * @param {ol.layer.Vector} vectorLayer Vector layer.\n * @api\n */\nvar _ol_renderer_webgl_VectorLayer_ = function(mapRenderer, vectorLayer) {\n\n  _ol_renderer_webgl_Layer_.call(this, mapRenderer, vectorLayer);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.dirty_ = false;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedRevision_ = -1;\n\n  /**\n   * @private\n   * @type {number}\n   */\n  this.renderedResolution_ = NaN;\n\n  /**\n   * @private\n   * @type {ol.Extent}\n   */\n  this.renderedExtent_ = _ol_extent_.createEmpty();\n\n  /**\n   * @private\n   * @type {function(ol.Feature, ol.Feature): number|null}\n   */\n  this.renderedRenderOrder_ = null;\n\n  /**\n   * @private\n   * @type {ol.render.webgl.ReplayGroup}\n   */\n  this.replayGroup_ = null;\n\n  /**\n   * The last layer state.\n   * @private\n   * @type {?ol.LayerState}\n   */\n  this.layerState_ = null;\n\n};\n\n_ol_.inherits(_ol_renderer_webgl_VectorLayer_, _ol_renderer_webgl_Layer_);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @param {ol.layer.Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\n_ol_renderer_webgl_VectorLayer_['handles'] = function(type, layer) {\n  return type === _ol_renderer_Type_.WEBGL && layer.getType() === _ol_LayerType_.VECTOR;\n};\n\n\n/**\n * Create a layer renderer.\n * @param {ol.renderer.Map} mapRenderer The map renderer.\n * @param {ol.layer.Layer} layer The layer to be rendererd.\n * @return {ol.renderer.webgl.VectorLayer} The layer renderer.\n */\n_ol_renderer_webgl_VectorLayer_['create'] = function(mapRenderer, layer) {\n  return new _ol_renderer_webgl_VectorLayer_(\n      /** @type {ol.renderer.webgl.Map} */ (mapRenderer),\n      /** @type {ol.layer.Vector} */ (layer)\n  );\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.composeFrame = function(frameState, layerState, context) {\n  this.layerState_ = layerState;\n  var viewState = frameState.viewState;\n  var replayGroup = this.replayGroup_;\n  var size = frameState.size;\n  var pixelRatio = frameState.pixelRatio;\n  var gl = this.mapRenderer.getGL();\n  if (replayGroup && !replayGroup.isEmpty()) {\n    gl.enable(gl.SCISSOR_TEST);\n    gl.scissor(0, 0, size[0] * pixelRatio, size[1] * pixelRatio);\n    replayGroup.replay(context,\n        viewState.center, viewState.resolution, viewState.rotation,\n        size, pixelRatio, layerState.opacity,\n        layerState.managed ? frameState.skippedFeatureUids : {});\n    gl.disable(gl.SCISSOR_TEST);\n  }\n\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.disposeInternal = function() {\n  var replayGroup = this.replayGroup_;\n  if (replayGroup) {\n    var context = this.mapRenderer.getContext();\n    replayGroup.getDeleteResourcesFunction(context)();\n    this.replayGroup_ = null;\n  }\n  _ol_renderer_webgl_Layer_.prototype.disposeInternal.call(this);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return undefined;\n  } else {\n    var context = this.mapRenderer.getContext();\n    var viewState = frameState.viewState;\n    var layer = this.getLayer();\n    var layerState = this.layerState_;\n    /** @type {Object.<string, boolean>} */\n    var features = {};\n    return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,\n        context, viewState.center, viewState.resolution, viewState.rotation,\n        frameState.size, frameState.pixelRatio, layerState.opacity,\n        {},\n        /**\n         * @param {ol.Feature|ol.render.Feature} feature Feature.\n         * @return {?} Callback result.\n         */\n        function(feature) {\n          var key = _ol_.getUid(feature).toString();\n          if (!(key in features)) {\n            features[key] = true;\n            return callback.call(thisArg, feature, layer);\n          }\n        });\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState) {\n  if (!this.replayGroup_ || !this.layerState_) {\n    return false;\n  } else {\n    var context = this.mapRenderer.getContext();\n    var viewState = frameState.viewState;\n    var layerState = this.layerState_;\n    return this.replayGroup_.hasFeatureAtCoordinate(coordinate,\n        context, viewState.center, viewState.resolution, viewState.rotation,\n        frameState.size, frameState.pixelRatio, layerState.opacity,\n        frameState.skippedFeatureUids);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {\n  var coordinate = _ol_transform_.apply(\n      frameState.pixelToCoordinateTransform, pixel.slice());\n  var hasFeature = this.hasFeatureAtCoordinate(coordinate, frameState);\n\n  if (hasFeature) {\n    return callback.call(thisArg, this.getLayer(), null);\n  } else {\n    return undefined;\n  }\n};\n\n\n/**\n * Handle changes in image style state.\n * @param {ol.events.Event} event Image style change event.\n * @private\n */\n_ol_renderer_webgl_VectorLayer_.prototype.handleStyleImageChange_ = function(event) {\n  this.renderIfReadyAndVisible();\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_webgl_VectorLayer_.prototype.prepareFrame = function(frameState, layerState, context) {\n\n  var vectorLayer = /** @type {ol.layer.Vector} */ (this.getLayer());\n  var vectorSource = vectorLayer.getSource();\n\n  this.updateLogos(frameState, vectorSource);\n\n  var animating = frameState.viewHints[_ol_ViewHint_.ANIMATING];\n  var interacting = frameState.viewHints[_ol_ViewHint_.INTERACTING];\n  var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n  var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n\n  if (!this.dirty_ && (!updateWhileAnimating && animating) ||\n      (!updateWhileInteracting && interacting)) {\n    return true;\n  }\n\n  var frameStateExtent = frameState.extent;\n  var viewState = frameState.viewState;\n  var projection = viewState.projection;\n  var resolution = viewState.resolution;\n  var pixelRatio = frameState.pixelRatio;\n  var vectorLayerRevision = vectorLayer.getRevision();\n  var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n  var vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n\n  if (vectorLayerRenderOrder === undefined) {\n    vectorLayerRenderOrder = _ol_renderer_vector_.defaultOrder;\n  }\n\n  var extent = _ol_extent_.buffer(frameStateExtent,\n      vectorLayerRenderBuffer * resolution);\n\n  if (!this.dirty_ &&\n      this.renderedResolution_ == resolution &&\n      this.renderedRevision_ == vectorLayerRevision &&\n      this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n      _ol_extent_.containsExtent(this.renderedExtent_, extent)) {\n    return true;\n  }\n\n  if (this.replayGroup_) {\n    frameState.postRenderFunctions.push(\n        this.replayGroup_.getDeleteResourcesFunction(context));\n  }\n\n  this.dirty_ = false;\n\n  var replayGroup = new _ol_render_webgl_ReplayGroup_(\n      _ol_renderer_vector_.getTolerance(resolution, pixelRatio),\n      extent, vectorLayer.getRenderBuffer());\n  vectorSource.loadFeatures(extent, resolution, projection);\n  /**\n   * @param {ol.Feature} feature Feature.\n   * @this {ol.renderer.webgl.VectorLayer}\n   */\n  var renderFeature = function(feature) {\n    var styles;\n    var styleFunction = feature.getStyleFunction();\n    if (styleFunction) {\n      styles = styleFunction.call(feature, resolution);\n    } else {\n      styleFunction = vectorLayer.getStyleFunction();\n      if (styleFunction) {\n        styles = styleFunction(feature, resolution);\n      }\n    }\n    if (styles) {\n      var dirty = this.renderFeature(\n          feature, resolution, pixelRatio, styles, replayGroup);\n      this.dirty_ = this.dirty_ || dirty;\n    }\n  };\n  if (vectorLayerRenderOrder) {\n    /** @type {Array.<ol.Feature>} */\n    var features = [];\n    vectorSource.forEachFeatureInExtent(extent,\n        /**\n         * @param {ol.Feature} feature Feature.\n         */\n        function(feature) {\n          features.push(feature);\n        }, this);\n    features.sort(vectorLayerRenderOrder);\n    features.forEach(renderFeature, this);\n  } else {\n    vectorSource.forEachFeatureInExtent(extent, renderFeature, this);\n  }\n  replayGroup.finish(context);\n\n  this.renderedResolution_ = resolution;\n  this.renderedRevision_ = vectorLayerRevision;\n  this.renderedRenderOrder_ = vectorLayerRenderOrder;\n  this.renderedExtent_ = extent;\n  this.replayGroup_ = replayGroup;\n\n  return true;\n};\n\n\n/**\n * @param {ol.Feature} feature Feature.\n * @param {number} resolution Resolution.\n * @param {number} pixelRatio Pixel ratio.\n * @param {(ol.style.Style|Array.<ol.style.Style>)} styles The style or array of\n *     styles.\n * @param {ol.render.webgl.ReplayGroup} replayGroup Replay group.\n * @return {boolean} `true` if an image is loading.\n */\n_ol_renderer_webgl_VectorLayer_.prototype.renderFeature = function(feature, resolution, pixelRatio, styles, replayGroup) {\n  if (!styles) {\n    return false;\n  }\n  var loading = false;\n  if (Array.isArray(styles)) {\n    for (var i = styles.length - 1, ii = 0; i >= ii; --i) {\n      loading = _ol_renderer_vector_.renderFeature(\n          replayGroup, feature, styles[i],\n          _ol_renderer_vector_.getSquaredTolerance(resolution, pixelRatio),\n          this.handleStyleImageChange_, this) || loading;\n    }\n  } else {\n    loading = _ol_renderer_vector_.renderFeature(\n        replayGroup, feature, styles,\n        _ol_renderer_vector_.getSquaredTolerance(resolution, pixelRatio),\n        this.handleStyleImageChange_, this) || loading;\n  }\n  return loading;\n};\nexport default _ol_renderer_webgl_VectorLayer_;\n"]},"metadata":{},"sourceType":"module"}