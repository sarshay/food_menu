{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_render_replay_ from '../replay.js';\nimport _ol_render_ReplayGroup_ from '../replaygroup.js';\nimport _ol_render_webgl_CircleReplay_ from '../webgl/circlereplay.js';\nimport _ol_render_webgl_ImageReplay_ from '../webgl/imagereplay.js';\nimport _ol_render_webgl_LineStringReplay_ from '../webgl/linestringreplay.js';\nimport _ol_render_webgl_PolygonReplay_ from '../webgl/polygonreplay.js';\nimport _ol_render_webgl_TextReplay_ from '../webgl/textreplay.js';\n/**\n * @constructor\n * @extends {ol.render.ReplayGroup}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @param {number=} opt_renderBuffer Render buffer.\n * @struct\n */\n\nvar _ol_render_webgl_ReplayGroup_ = function (tolerance, maxExtent, opt_renderBuffer) {\n  _ol_render_ReplayGroup_.call(this);\n  /**\n   * @type {ol.Extent}\n   * @private\n   */\n\n\n  this.maxExtent_ = maxExtent;\n  /**\n   * @type {number}\n   * @private\n   */\n\n  this.tolerance_ = tolerance;\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n\n  this.renderBuffer_ = opt_renderBuffer;\n  /**\n   * @private\n   * @type {!Object.<string,\n   *        Object.<ol.render.ReplayType, ol.render.webgl.Replay>>}\n   */\n\n  this.replaysByZIndex_ = {};\n};\n\n_ol_.inherits(_ol_render_webgl_ReplayGroup_, _ol_render_ReplayGroup_);\n/**\n * @param {ol.style.Style} style Style.\n * @param {boolean} group Group with previous replay.\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.addDeclutter = function (style, group) {};\n/**\n * @param {ol.webgl.Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.getDeleteResourcesFunction = function (context) {\n  var functions = [];\n  var zKey;\n\n  for (zKey in this.replaysByZIndex_) {\n    var replays = this.replaysByZIndex_[zKey];\n    var replayKey;\n\n    for (replayKey in replays) {\n      functions.push(replays[replayKey].getDeleteResourcesFunction(context));\n    }\n  }\n\n  return function () {\n    var length = functions.length;\n    var result;\n\n    for (var i = 0; i < length; i++) {\n      result = functions[i].apply(this, arguments);\n    }\n\n    return result;\n  };\n};\n/**\n * @param {ol.webgl.Context} context Context.\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.finish = function (context) {\n  var zKey;\n\n  for (zKey in this.replaysByZIndex_) {\n    var replays = this.replaysByZIndex_[zKey];\n    var replayKey;\n\n    for (replayKey in replays) {\n      replays[replayKey].finish(context);\n    }\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.getReplay = function (zIndex, replayType) {\n  var zIndexKey = zIndex !== undefined ? zIndex.toString() : '0';\n  var replays = this.replaysByZIndex_[zIndexKey];\n\n  if (replays === undefined) {\n    replays = {};\n    this.replaysByZIndex_[zIndexKey] = replays;\n  }\n\n  var replay = replays[replayType];\n\n  if (replay === undefined) {\n    /**\n     * @type {Function}\n     */\n    var Constructor = _ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType];\n    replay = new Constructor(this.tolerance_, this.maxExtent_);\n    replays[replayType] = replay;\n  }\n\n  return replay;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.isEmpty = function () {\n  return _ol_obj_.isEmpty(this.replaysByZIndex_);\n};\n/**\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.replay = function (context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash) {\n  /** @type {Array.<number>} */\n  var zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(_ol_array_.numberSafeCompareFunction);\n  var i, ii, j, jj, replays, replay;\n\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n\n    for (j = 0, jj = _ol_render_replay_.ORDER.length; j < jj; ++j) {\n      replay = replays[_ol_render_replay_.ORDER[j]];\n\n      if (replay !== undefined) {\n        replay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, undefined, false);\n      }\n    }\n  }\n};\n/**\n * @private\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.replayHitDetection_ = function (context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\n  /** @type {Array.<number>} */\n  var zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(function (a, b) {\n    return b - a;\n  });\n  var i, ii, j, replays, replay, result;\n\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n\n    for (j = _ol_render_replay_.ORDER.length - 1; j >= 0; --j) {\n      replay = replays[_ol_render_replay_.ORDER[j]];\n\n      if (replay !== undefined) {\n        result = replay.replay(context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);\n\n        if (result) {\n          return result;\n        }\n      }\n    }\n  }\n\n  return undefined;\n};\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} callback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.forEachFeatureAtCoordinate = function (coordinate, context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash, callback) {\n  var gl = context.getGL();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n  /**\n   * @type {ol.Extent}\n   */\n\n  var hitExtent;\n\n  if (this.renderBuffer_ !== undefined) {\n    // build an extent around the coordinate, so that only features that\n    // intersect this extent are checked\n    hitExtent = _ol_extent_.buffer(_ol_extent_.createOrUpdateFromCoordinate(coordinate), resolution * this.renderBuffer_);\n  }\n\n  return this.replayHitDetection_(context, coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_, pixelRatio, opacity, skippedFeaturesHash,\n  /**\n   * @param {ol.Feature|ol.render.Feature} feature Feature.\n   * @return {?} Callback result.\n   */\n  function (feature) {\n    var imageData = new Uint8Array(4);\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n\n    if (imageData[3] > 0) {\n      var result = callback(feature);\n\n      if (result) {\n        return result;\n      }\n    }\n  }, true, hitExtent);\n};\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @return {boolean} Is there a feature at the given coordinate?\n */\n\n\n_ol_render_webgl_ReplayGroup_.prototype.hasFeatureAtCoordinate = function (coordinate, context, center, resolution, rotation, size, pixelRatio, opacity, skippedFeaturesHash) {\n  var gl = context.getGL();\n  gl.bindFramebuffer(gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n  var hasFeature = this.replayHitDetection_(context, coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_, pixelRatio, opacity, skippedFeaturesHash,\n  /**\n   * @param {ol.Feature|ol.render.Feature} feature Feature.\n   * @return {boolean} Is there a feature?\n   */\n  function (feature) {\n    var imageData = new Uint8Array(4);\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n    return imageData[3] > 0;\n  }, false);\n  return hasFeature !== undefined;\n};\n/**\n * @const\n * @private\n * @type {Array.<number>}\n */\n\n\n_ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_ = [1, 1];\n/**\n * @const\n * @private\n * @type {Object.<ol.render.ReplayType,\n *                function(new: ol.render.webgl.Replay, number,\n *                ol.Extent)>}\n */\n\n_ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_ = {\n  'Circle': _ol_render_webgl_CircleReplay_,\n  'Image': _ol_render_webgl_ImageReplay_,\n  'LineString': _ol_render_webgl_LineStringReplay_,\n  'Polygon': _ol_render_webgl_PolygonReplay_,\n  'Text': _ol_render_webgl_TextReplay_\n};\nexport default _ol_render_webgl_ReplayGroup_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/render/webgl/replaygroup.js"],"names":["_ol_","_ol_array_","_ol_extent_","_ol_obj_","_ol_render_replay_","_ol_render_ReplayGroup_","_ol_render_webgl_CircleReplay_","_ol_render_webgl_ImageReplay_","_ol_render_webgl_LineStringReplay_","_ol_render_webgl_PolygonReplay_","_ol_render_webgl_TextReplay_","_ol_render_webgl_ReplayGroup_","tolerance","maxExtent","opt_renderBuffer","call","maxExtent_","tolerance_","renderBuffer_","replaysByZIndex_","inherits","prototype","addDeclutter","style","group","getDeleteResourcesFunction","context","functions","zKey","replays","replayKey","push","length","result","i","apply","arguments","finish","getReplay","zIndex","replayType","zIndexKey","undefined","toString","replay","Constructor","BATCH_CONSTRUCTORS_","isEmpty","center","resolution","rotation","size","pixelRatio","opacity","skippedFeaturesHash","zs","Object","keys","map","Number","sort","numberSafeCompareFunction","ii","j","jj","ORDER","replayHitDetection_","featureCallback","oneByOne","opt_hitExtent","a","b","forEachFeatureAtCoordinate","coordinate","callback","gl","getGL","bindFramebuffer","FRAMEBUFFER","getHitDetectionFramebuffer","hitExtent","buffer","createOrUpdateFromCoordinate","HIT_DETECTION_SIZE_","feature","imageData","Uint8Array","readPixels","RGBA","UNSIGNED_BYTE","hasFeatureAtCoordinate","hasFeature"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_render_replay_ from '../replay.js';\nimport _ol_render_ReplayGroup_ from '../replaygroup.js';\nimport _ol_render_webgl_CircleReplay_ from '../webgl/circlereplay.js';\nimport _ol_render_webgl_ImageReplay_ from '../webgl/imagereplay.js';\nimport _ol_render_webgl_LineStringReplay_ from '../webgl/linestringreplay.js';\nimport _ol_render_webgl_PolygonReplay_ from '../webgl/polygonreplay.js';\nimport _ol_render_webgl_TextReplay_ from '../webgl/textreplay.js';\n\n/**\n * @constructor\n * @extends {ol.render.ReplayGroup}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @param {number=} opt_renderBuffer Render buffer.\n * @struct\n */\nvar _ol_render_webgl_ReplayGroup_ = function(tolerance, maxExtent, opt_renderBuffer) {\n  _ol_render_ReplayGroup_.call(this);\n\n  /**\n   * @type {ol.Extent}\n   * @private\n   */\n  this.maxExtent_ = maxExtent;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.tolerance_ = tolerance;\n\n  /**\n   * @type {number|undefined}\n   * @private\n   */\n  this.renderBuffer_ = opt_renderBuffer;\n\n  /**\n   * @private\n   * @type {!Object.<string,\n   *        Object.<ol.render.ReplayType, ol.render.webgl.Replay>>}\n   */\n  this.replaysByZIndex_ = {};\n\n};\n\n_ol_.inherits(_ol_render_webgl_ReplayGroup_, _ol_render_ReplayGroup_);\n\n\n/**\n * @param {ol.style.Style} style Style.\n * @param {boolean} group Group with previous replay.\n */\n_ol_render_webgl_ReplayGroup_.prototype.addDeclutter = function(style, group) {};\n\n\n/**\n * @param {ol.webgl.Context} context WebGL context.\n * @return {function()} Delete resources function.\n */\n_ol_render_webgl_ReplayGroup_.prototype.getDeleteResourcesFunction = function(context) {\n  var functions = [];\n  var zKey;\n  for (zKey in this.replaysByZIndex_) {\n    var replays = this.replaysByZIndex_[zKey];\n    var replayKey;\n    for (replayKey in replays) {\n      functions.push(\n          replays[replayKey].getDeleteResourcesFunction(context));\n    }\n  }\n  return function() {\n    var length = functions.length;\n    var result;\n    for (var i = 0; i < length; i++) {\n      result = functions[i].apply(this, arguments);\n    }\n    return result;\n  };\n};\n\n\n/**\n * @param {ol.webgl.Context} context Context.\n */\n_ol_render_webgl_ReplayGroup_.prototype.finish = function(context) {\n  var zKey;\n  for (zKey in this.replaysByZIndex_) {\n    var replays = this.replaysByZIndex_[zKey];\n    var replayKey;\n    for (replayKey in replays) {\n      replays[replayKey].finish(context);\n    }\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_ReplayGroup_.prototype.getReplay = function(zIndex, replayType) {\n  var zIndexKey = zIndex !== undefined ? zIndex.toString() : '0';\n  var replays = this.replaysByZIndex_[zIndexKey];\n  if (replays === undefined) {\n    replays = {};\n    this.replaysByZIndex_[zIndexKey] = replays;\n  }\n  var replay = replays[replayType];\n  if (replay === undefined) {\n    /**\n     * @type {Function}\n     */\n    var Constructor = _ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_[replayType];\n    replay = new Constructor(this.tolerance_, this.maxExtent_);\n    replays[replayType] = replay;\n  }\n  return replay;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_ReplayGroup_.prototype.isEmpty = function() {\n  return _ol_obj_.isEmpty(this.replaysByZIndex_);\n};\n\n\n/**\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n */\n_ol_render_webgl_ReplayGroup_.prototype.replay = function(context,\n    center, resolution, rotation, size, pixelRatio,\n    opacity, skippedFeaturesHash) {\n  /** @type {Array.<number>} */\n  var zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(_ol_array_.numberSafeCompareFunction);\n\n  var i, ii, j, jj, replays, replay;\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n    for (j = 0, jj = _ol_render_replay_.ORDER.length; j < jj; ++j) {\n      replay = replays[_ol_render_replay_.ORDER[j]];\n      if (replay !== undefined) {\n        replay.replay(context,\n            center, resolution, rotation, size, pixelRatio,\n            opacity, skippedFeaturesHash,\n            undefined, false);\n      }\n    }\n  }\n};\n\n\n/**\n * @private\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} featureCallback Feature callback.\n * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\n * @param {ol.Extent=} opt_hitExtent Hit extent: Only features intersecting\n *  this extent are checked.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_ReplayGroup_.prototype.replayHitDetection_ = function(context,\n    center, resolution, rotation, size, pixelRatio, opacity,\n    skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\n  /** @type {Array.<number>} */\n  var zs = Object.keys(this.replaysByZIndex_).map(Number);\n  zs.sort(function(a, b) {\n    return b - a;\n  });\n\n  var i, ii, j, replays, replay, result;\n  for (i = 0, ii = zs.length; i < ii; ++i) {\n    replays = this.replaysByZIndex_[zs[i].toString()];\n    for (j = _ol_render_replay_.ORDER.length - 1; j >= 0; --j) {\n      replay = replays[_ol_render_replay_.ORDER[j]];\n      if (replay !== undefined) {\n        result = replay.replay(context,\n            center, resolution, rotation, size, pixelRatio, opacity,\n            skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent);\n        if (result) {\n          return result;\n        }\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @param {function((ol.Feature|ol.render.Feature)): T|undefined} callback Feature callback.\n * @return {T|undefined} Callback result.\n * @template T\n */\n_ol_render_webgl_ReplayGroup_.prototype.forEachFeatureAtCoordinate = function(\n    coordinate, context, center, resolution, rotation, size, pixelRatio,\n    opacity, skippedFeaturesHash,\n    callback) {\n  var gl = context.getGL();\n  gl.bindFramebuffer(\n      gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n\n\n  /**\n   * @type {ol.Extent}\n   */\n  var hitExtent;\n  if (this.renderBuffer_ !== undefined) {\n    // build an extent around the coordinate, so that only features that\n    // intersect this extent are checked\n    hitExtent = _ol_extent_.buffer(\n        _ol_extent_.createOrUpdateFromCoordinate(coordinate),\n        resolution * this.renderBuffer_);\n  }\n\n  return this.replayHitDetection_(context,\n      coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_,\n      pixelRatio, opacity, skippedFeaturesHash,\n      /**\n       * @param {ol.Feature|ol.render.Feature} feature Feature.\n       * @return {?} Callback result.\n       */\n      function(feature) {\n        var imageData = new Uint8Array(4);\n        gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n\n        if (imageData[3] > 0) {\n          var result = callback(feature);\n          if (result) {\n            return result;\n          }\n        }\n      }, true, hitExtent);\n};\n\n\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {ol.webgl.Context} context Context.\n * @param {ol.Coordinate} center Center.\n * @param {number} resolution Resolution.\n * @param {number} rotation Rotation.\n * @param {ol.Size} size Size.\n * @param {number} pixelRatio Pixel ratio.\n * @param {number} opacity Global opacity.\n * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\n *  to skip.\n * @return {boolean} Is there a feature at the given coordinate?\n */\n_ol_render_webgl_ReplayGroup_.prototype.hasFeatureAtCoordinate = function(\n    coordinate, context, center, resolution, rotation, size, pixelRatio,\n    opacity, skippedFeaturesHash) {\n  var gl = context.getGL();\n  gl.bindFramebuffer(\n      gl.FRAMEBUFFER, context.getHitDetectionFramebuffer());\n\n  var hasFeature = this.replayHitDetection_(context,\n      coordinate, resolution, rotation, _ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_,\n      pixelRatio, opacity, skippedFeaturesHash,\n      /**\n       * @param {ol.Feature|ol.render.Feature} feature Feature.\n       * @return {boolean} Is there a feature?\n       */\n      function(feature) {\n        var imageData = new Uint8Array(4);\n        gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, imageData);\n        return imageData[3] > 0;\n      }, false);\n\n  return hasFeature !== undefined;\n};\n\n/**\n * @const\n * @private\n * @type {Array.<number>}\n */\n_ol_render_webgl_ReplayGroup_.HIT_DETECTION_SIZE_ = [1, 1];\n\n/**\n * @const\n * @private\n * @type {Object.<ol.render.ReplayType,\n *                function(new: ol.render.webgl.Replay, number,\n *                ol.Extent)>}\n */\n_ol_render_webgl_ReplayGroup_.BATCH_CONSTRUCTORS_ = {\n  'Circle': _ol_render_webgl_CircleReplay_,\n  'Image': _ol_render_webgl_ImageReplay_,\n  'LineString': _ol_render_webgl_LineStringReplay_,\n  'Polygon': _ol_render_webgl_PolygonReplay_,\n  'Text': _ol_render_webgl_TextReplay_\n};\nexport default _ol_render_webgl_ReplayGroup_;\n"]},"metadata":{},"sourceType":"module"}