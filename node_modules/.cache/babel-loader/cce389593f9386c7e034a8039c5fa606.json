{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_ImageCanvas_ from '../../imagecanvas.js';\nimport _ol_LayerType_ from '../../layertype.js';\nimport _ol_ViewHint_ from '../../viewhint.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_layer_VectorRenderType_ from '../../layer/vectorrendertype.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_plugins_ from '../../plugins.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_renderer_canvas_IntermediateCanvas_ from '../canvas/intermediatecanvas.js';\nimport _ol_transform_ from '../../transform.js';\n/**\n * @constructor\n * @extends {ol.renderer.canvas.IntermediateCanvas}\n * @param {ol.layer.Image} imageLayer Single image layer.\n * @api\n */\n\nvar _ol_renderer_canvas_ImageLayer_ = function (imageLayer) {\n  _ol_renderer_canvas_IntermediateCanvas_.call(this, imageLayer);\n  /**\n   * @private\n   * @type {?ol.ImageBase}\n   */\n\n\n  this.image_ = null;\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n\n  this.imageTransform_ = _ol_transform_.create();\n  /**\n   * @type {!Array.<string>}\n   */\n\n  this.skippedFeatures_ = [];\n  /**\n   * @private\n   * @type {ol.renderer.canvas.VectorLayer}\n   */\n\n  this.vectorRenderer_ = null;\n};\n\n_ol_.inherits(_ol_renderer_canvas_ImageLayer_, _ol_renderer_canvas_IntermediateCanvas_);\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @param {ol.layer.Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\n\n\n_ol_renderer_canvas_ImageLayer_['handles'] = function (type, layer) {\n  return type === _ol_renderer_Type_.CANVAS && (layer.getType() === _ol_LayerType_.IMAGE || layer.getType() === _ol_LayerType_.VECTOR &&\n  /** @type {ol.layer.Vector} */\n  layer.getRenderMode() === _ol_layer_VectorRenderType_.IMAGE);\n};\n/**\n * Create a layer renderer.\n * @param {ol.renderer.Map} mapRenderer The map renderer.\n * @param {ol.layer.Layer} layer The layer to be rendererd.\n * @return {ol.renderer.canvas.ImageLayer} The layer renderer.\n */\n\n\n_ol_renderer_canvas_ImageLayer_['create'] = function (mapRenderer, layer) {\n  var renderer = new _ol_renderer_canvas_ImageLayer_(\n  /** @type {ol.layer.Image} */\n  layer);\n\n  if (layer.getType() === _ol_LayerType_.VECTOR) {\n    var candidates = _ol_plugins_.getLayerRendererPlugins();\n\n    for (var i = 0, ii = candidates.length; i < ii; ++i) {\n      var candidate =\n      /** @type {Object.<string, Function>} */\n      candidates[i];\n\n      if (candidate !== _ol_renderer_canvas_ImageLayer_ && candidate['handles'](_ol_renderer_Type_.CANVAS, layer)) {\n        renderer.setVectorRenderer(candidate['create'](mapRenderer, layer));\n      }\n    }\n  }\n\n  return renderer;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_ImageLayer_.prototype.getImage = function () {\n  return !this.image_ ? null : this.image_.getImage();\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_ImageLayer_.prototype.getImageTransform = function () {\n  return this.imageTransform_;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_ImageLayer_.prototype.prepareFrame = function (frameState, layerState) {\n  var pixelRatio = frameState.pixelRatio;\n  var size = frameState.size;\n  var viewState = frameState.viewState;\n  var viewCenter = viewState.center;\n  var viewResolution = viewState.resolution;\n  var image;\n  var imageLayer =\n  /** @type {ol.layer.Image} */\n  this.getLayer();\n  var imageSource = imageLayer.getSource();\n  var hints = frameState.viewHints;\n  var renderedExtent = frameState.extent;\n\n  if (layerState.extent !== undefined) {\n    renderedExtent = _ol_extent_.getIntersection(renderedExtent, layerState.extent);\n  }\n\n  if (!hints[_ol_ViewHint_.ANIMATING] && !hints[_ol_ViewHint_.INTERACTING] && !_ol_extent_.isEmpty(renderedExtent)) {\n    var projection = viewState.projection;\n\n    if (!_ol_.ENABLE_RASTER_REPROJECTION) {\n      var sourceProjection = imageSource.getProjection();\n\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n    }\n\n    var vectorRenderer = this.vectorRenderer_;\n\n    if (vectorRenderer) {\n      var context = vectorRenderer.context;\n\n      var imageFrameState =\n      /** @type {olx.FrameState} */\n      _ol_obj_.assign({}, frameState, {\n        size: [_ol_extent_.getWidth(renderedExtent) / viewResolution, _ol_extent_.getHeight(renderedExtent) / viewResolution],\n        viewState:\n        /** @type {olx.ViewState} */\n        _ol_obj_.assign({}, frameState.viewState, {\n          rotation: 0\n        })\n      });\n\n      var skippedFeatures = Object.keys(imageFrameState.skippedFeatureUids).sort();\n\n      if (vectorRenderer.prepareFrame(imageFrameState, layerState) && (vectorRenderer.replayGroupChanged || !_ol_array_.equals(skippedFeatures, this.skippedFeatures_))) {\n        context.canvas.width = imageFrameState.size[0] * pixelRatio;\n        context.canvas.height = imageFrameState.size[1] * pixelRatio;\n        vectorRenderer.composeFrame(imageFrameState, layerState, context);\n        this.image_ = new _ol_ImageCanvas_(renderedExtent, viewResolution, pixelRatio, context.canvas);\n        this.skippedFeatures_ = skippedFeatures;\n      }\n    } else {\n      image = imageSource.getImage(renderedExtent, viewResolution, pixelRatio, projection);\n\n      if (image) {\n        var loaded = this.loadImage(image);\n\n        if (loaded) {\n          this.image_ = image;\n        }\n      }\n    }\n  }\n\n  if (this.image_) {\n    image = this.image_;\n    var imageExtent = image.getExtent();\n    var imageResolution = image.getResolution();\n    var imagePixelRatio = image.getPixelRatio();\n    var scale = pixelRatio * imageResolution / (viewResolution * imagePixelRatio);\n\n    var transform = _ol_transform_.compose(this.imageTransform_, pixelRatio * size[0] / 2, pixelRatio * size[1] / 2, scale, scale, 0, imagePixelRatio * (imageExtent[0] - viewCenter[0]) / imageResolution, imagePixelRatio * (viewCenter[1] - imageExtent[3]) / imageResolution);\n\n    _ol_transform_.compose(this.coordinateToCanvasPixelTransform, pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5], pixelRatio / viewResolution, -pixelRatio / viewResolution, 0, -viewCenter[0], -viewCenter[1]);\n\n    this.updateLogos(frameState, imageSource);\n    this.renderedResolution = imageResolution * pixelRatio / imagePixelRatio;\n  }\n\n  return !!this.image_;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_ImageLayer_.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (this.vectorRenderer_) {\n    return this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);\n  } else {\n    return _ol_renderer_canvas_IntermediateCanvas_.prototype.forEachFeatureAtCoordinate.call(this, coordinate, frameState, hitTolerance, callback, thisArg);\n  }\n};\n/**\n * @param {ol.renderer.canvas.VectorLayer} renderer Vector renderer.\n */\n\n\n_ol_renderer_canvas_ImageLayer_.prototype.setVectorRenderer = function (renderer) {\n  this.vectorRenderer_ = renderer;\n};\n\nexport default _ol_renderer_canvas_ImageLayer_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/canvas/imagelayer.js"],"names":["_ol_","_ol_ImageCanvas_","_ol_LayerType_","_ol_ViewHint_","_ol_array_","_ol_extent_","_ol_layer_VectorRenderType_","_ol_obj_","_ol_plugins_","_ol_renderer_Type_","_ol_renderer_canvas_IntermediateCanvas_","_ol_transform_","_ol_renderer_canvas_ImageLayer_","imageLayer","call","image_","imageTransform_","create","skippedFeatures_","vectorRenderer_","inherits","type","layer","CANVAS","getType","IMAGE","VECTOR","getRenderMode","mapRenderer","renderer","candidates","getLayerRendererPlugins","i","ii","length","candidate","setVectorRenderer","prototype","getImage","getImageTransform","prepareFrame","frameState","layerState","pixelRatio","size","viewState","viewCenter","center","viewResolution","resolution","image","getLayer","imageSource","getSource","hints","viewHints","renderedExtent","extent","undefined","getIntersection","ANIMATING","INTERACTING","isEmpty","projection","ENABLE_RASTER_REPROJECTION","sourceProjection","getProjection","vectorRenderer","context","imageFrameState","assign","getWidth","getHeight","rotation","skippedFeatures","Object","keys","skippedFeatureUids","sort","replayGroupChanged","equals","canvas","width","height","composeFrame","loaded","loadImage","imageExtent","getExtent","imageResolution","getResolution","imagePixelRatio","getPixelRatio","scale","transform","compose","coordinateToCanvasPixelTransform","updateLogos","renderedResolution","forEachFeatureAtCoordinate","coordinate","hitTolerance","callback","thisArg"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_ImageCanvas_ from '../../imagecanvas.js';\nimport _ol_LayerType_ from '../../layertype.js';\nimport _ol_ViewHint_ from '../../viewhint.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_layer_VectorRenderType_ from '../../layer/vectorrendertype.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_plugins_ from '../../plugins.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_renderer_canvas_IntermediateCanvas_ from '../canvas/intermediatecanvas.js';\nimport _ol_transform_ from '../../transform.js';\n\n/**\n * @constructor\n * @extends {ol.renderer.canvas.IntermediateCanvas}\n * @param {ol.layer.Image} imageLayer Single image layer.\n * @api\n */\nvar _ol_renderer_canvas_ImageLayer_ = function(imageLayer) {\n\n  _ol_renderer_canvas_IntermediateCanvas_.call(this, imageLayer);\n\n  /**\n   * @private\n   * @type {?ol.ImageBase}\n   */\n  this.image_ = null;\n\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n  this.imageTransform_ = _ol_transform_.create();\n\n  /**\n   * @type {!Array.<string>}\n   */\n  this.skippedFeatures_ = [];\n\n  /**\n   * @private\n   * @type {ol.renderer.canvas.VectorLayer}\n   */\n  this.vectorRenderer_ = null;\n\n};\n\n_ol_.inherits(_ol_renderer_canvas_ImageLayer_, _ol_renderer_canvas_IntermediateCanvas_);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @param {ol.layer.Layer} layer The candidate layer.\n * @return {boolean} The renderer can render the layer.\n */\n_ol_renderer_canvas_ImageLayer_['handles'] = function(type, layer) {\n  return type === _ol_renderer_Type_.CANVAS && (layer.getType() === _ol_LayerType_.IMAGE ||\n      layer.getType() === _ol_LayerType_.VECTOR &&\n      /** @type {ol.layer.Vector} */ (layer).getRenderMode() === _ol_layer_VectorRenderType_.IMAGE);\n};\n\n\n/**\n * Create a layer renderer.\n * @param {ol.renderer.Map} mapRenderer The map renderer.\n * @param {ol.layer.Layer} layer The layer to be rendererd.\n * @return {ol.renderer.canvas.ImageLayer} The layer renderer.\n */\n_ol_renderer_canvas_ImageLayer_['create'] = function(mapRenderer, layer) {\n  var renderer = new _ol_renderer_canvas_ImageLayer_(/** @type {ol.layer.Image} */ (layer));\n  if (layer.getType() === _ol_LayerType_.VECTOR) {\n    var candidates = _ol_plugins_.getLayerRendererPlugins();\n    for (var i = 0, ii = candidates.length; i < ii; ++i) {\n      var candidate = /** @type {Object.<string, Function>} */ (candidates[i]);\n      if (candidate !== _ol_renderer_canvas_ImageLayer_ && candidate['handles'](_ol_renderer_Type_.CANVAS, layer)) {\n        renderer.setVectorRenderer(candidate['create'](mapRenderer, layer));\n      }\n    }\n  }\n  return renderer;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_ImageLayer_.prototype.getImage = function() {\n  return !this.image_ ? null : this.image_.getImage();\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_ImageLayer_.prototype.getImageTransform = function() {\n  return this.imageTransform_;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_ImageLayer_.prototype.prepareFrame = function(frameState, layerState) {\n\n  var pixelRatio = frameState.pixelRatio;\n  var size = frameState.size;\n  var viewState = frameState.viewState;\n  var viewCenter = viewState.center;\n  var viewResolution = viewState.resolution;\n\n  var image;\n  var imageLayer = /** @type {ol.layer.Image} */ (this.getLayer());\n  var imageSource = imageLayer.getSource();\n\n  var hints = frameState.viewHints;\n\n  var renderedExtent = frameState.extent;\n  if (layerState.extent !== undefined) {\n    renderedExtent = _ol_extent_.getIntersection(\n        renderedExtent, layerState.extent);\n  }\n\n  if (!hints[_ol_ViewHint_.ANIMATING] && !hints[_ol_ViewHint_.INTERACTING] &&\n      !_ol_extent_.isEmpty(renderedExtent)) {\n    var projection = viewState.projection;\n    if (!_ol_.ENABLE_RASTER_REPROJECTION) {\n      var sourceProjection = imageSource.getProjection();\n      if (sourceProjection) {\n        projection = sourceProjection;\n      }\n    }\n    var vectorRenderer = this.vectorRenderer_;\n    if (vectorRenderer) {\n      var context = vectorRenderer.context;\n      var imageFrameState = /** @type {olx.FrameState} */ (_ol_obj_.assign({}, frameState, {\n        size: [\n          _ol_extent_.getWidth(renderedExtent) / viewResolution,\n          _ol_extent_.getHeight(renderedExtent) / viewResolution\n        ],\n        viewState: /** @type {olx.ViewState} */ (_ol_obj_.assign({}, frameState.viewState, {\n          rotation: 0\n        }))\n      }));\n      var skippedFeatures = Object.keys(imageFrameState.skippedFeatureUids).sort();\n      if (vectorRenderer.prepareFrame(imageFrameState, layerState) &&\n          (vectorRenderer.replayGroupChanged ||\n          !_ol_array_.equals(skippedFeatures, this.skippedFeatures_))) {\n        context.canvas.width = imageFrameState.size[0] * pixelRatio;\n        context.canvas.height = imageFrameState.size[1] * pixelRatio;\n        vectorRenderer.composeFrame(imageFrameState, layerState, context);\n        this.image_ = new _ol_ImageCanvas_(renderedExtent, viewResolution, pixelRatio, context.canvas);\n        this.skippedFeatures_ = skippedFeatures;\n      }\n    } else {\n      image = imageSource.getImage(\n          renderedExtent, viewResolution, pixelRatio, projection);\n      if (image) {\n        var loaded = this.loadImage(image);\n        if (loaded) {\n          this.image_ = image;\n        }\n      }\n    }\n  }\n\n  if (this.image_) {\n    image = this.image_;\n    var imageExtent = image.getExtent();\n    var imageResolution = image.getResolution();\n    var imagePixelRatio = image.getPixelRatio();\n    var scale = pixelRatio * imageResolution /\n        (viewResolution * imagePixelRatio);\n    var transform = _ol_transform_.compose(this.imageTransform_,\n        pixelRatio * size[0] / 2, pixelRatio * size[1] / 2,\n        scale, scale,\n        0,\n        imagePixelRatio * (imageExtent[0] - viewCenter[0]) / imageResolution,\n        imagePixelRatio * (viewCenter[1] - imageExtent[3]) / imageResolution);\n    _ol_transform_.compose(this.coordinateToCanvasPixelTransform,\n        pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5],\n        pixelRatio / viewResolution, -pixelRatio / viewResolution,\n        0,\n        -viewCenter[0], -viewCenter[1]);\n\n    this.updateLogos(frameState, imageSource);\n    this.renderedResolution = imageResolution * pixelRatio / imagePixelRatio;\n  }\n\n  return !!this.image_;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_ImageLayer_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg) {\n  if (this.vectorRenderer_) {\n    return this.vectorRenderer_.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, callback, thisArg);\n  } else {\n    return _ol_renderer_canvas_IntermediateCanvas_.prototype.forEachFeatureAtCoordinate.call(this, coordinate, frameState, hitTolerance, callback, thisArg);\n  }\n};\n\n\n/**\n * @param {ol.renderer.canvas.VectorLayer} renderer Vector renderer.\n */\n_ol_renderer_canvas_ImageLayer_.prototype.setVectorRenderer = function(renderer) {\n  this.vectorRenderer_ = renderer;\n};\nexport default _ol_renderer_canvas_ImageLayer_;\n"]},"metadata":{},"sourceType":"module"}