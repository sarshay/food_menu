{"ast":null,"code":"// FIXME offset panning\nimport _ol_transform_ from '../../transform.js';\nimport _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_css_ from '../../css.js';\nimport _ol_dom_ from '../../dom.js';\nimport _ol_layer_Layer_ from '../../layer/layer.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_canvas_ from '../../render/canvas.js';\nimport _ol_render_canvas_Immediate_ from '../../render/canvas/immediate.js';\nimport _ol_renderer_Map_ from '../map.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_source_State_ from '../../source/state.js';\n/**\n * @constructor\n * @extends {ol.renderer.Map}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @api\n */\n\nvar _ol_renderer_canvas_Map_ = function (container, map) {\n  _ol_renderer_Map_.call(this, container, map);\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n\n\n  this.context_ = _ol_dom_.createCanvasContext2D();\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n\n  this.canvas_ = this.context_.canvas;\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = _ol_css_.CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n  /**\n   * @private\n   * @type {boolean}\n   */\n\n  this.renderedVisible_ = true;\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n\n  this.transform_ = _ol_transform_.create();\n};\n\n_ol_.inherits(_ol_renderer_canvas_Map_, _ol_renderer_Map_);\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @return {boolean} The renderer can render the layer.\n */\n\n\n_ol_renderer_canvas_Map_['handles'] = function (type) {\n  return type === _ol_renderer_Type_.CANVAS;\n};\n/**\n * Create the map renderer.\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @return {ol.renderer.canvas.Map} The map renderer.\n */\n\n\n_ol_renderer_canvas_Map_['create'] = function (container, map) {\n  return new _ol_renderer_canvas_Map_(container, map);\n};\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n\n_ol_renderer_canvas_Map_.prototype.dispatchComposeEvent_ = function (type, frameState) {\n  var map = this.getMap();\n  var context = this.context_;\n\n  if (map.hasListener(type)) {\n    var extent = frameState.extent;\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var rotation = viewState.rotation;\n    var transform = this.getTransform(frameState);\n    var vectorContext = new _ol_render_canvas_Immediate_(context, pixelRatio, extent, transform, rotation);\n    var composeEvent = new _ol_render_Event_(type, vectorContext, frameState, context, null);\n    map.dispatchEvent(composeEvent);\n  }\n};\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @protected\n * @return {!ol.Transform} Transform.\n */\n\n\n_ol_renderer_canvas_Map_.prototype.getTransform = function (frameState) {\n  var viewState = frameState.viewState;\n  var dx1 = this.canvas_.width / 2;\n  var dy1 = this.canvas_.height / 2;\n  var sx = frameState.pixelRatio / viewState.resolution;\n  var sy = -sx;\n  var angle = -viewState.rotation;\n  var dx2 = -viewState.center[0];\n  var dy2 = -viewState.center[1];\n  return _ol_transform_.compose(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_Map_.prototype.getType = function () {\n  return _ol_renderer_Type_.CANVAS;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_Map_.prototype.renderFrame = function (frameState) {\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n\n    return;\n  }\n\n  var context = this.context_;\n  var pixelRatio = frameState.pixelRatio;\n  var width = Math.round(frameState.size[0] * pixelRatio);\n  var height = Math.round(frameState.size[1] * pixelRatio);\n\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  } else {\n    context.clearRect(0, 0, width, height);\n  }\n\n  var rotation = frameState.viewState.rotation;\n  this.calculateMatrices2D(frameState);\n  this.dispatchComposeEvent_(_ol_render_EventType_.PRECOMPOSE, frameState);\n  var layerStatesArray = frameState.layerStatesArray;\n\n  _ol_array_.stableSort(layerStatesArray, _ol_renderer_Map_.sortByZIndex);\n\n  if (rotation) {\n    context.save();\n\n    _ol_render_canvas_.rotateAtOffset(context, rotation, width / 2, height / 2);\n  }\n\n  var viewResolution = frameState.viewState.resolution;\n  var i, ii, layer, layerRenderer, layerState;\n\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n    layer = layerState.layer;\n    layerRenderer =\n    /** @type {ol.renderer.canvas.Layer} */\n    this.getLayerRenderer(layer);\n\n    if (!_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) || layerState.sourceState != _ol_source_State_.READY) {\n      continue;\n    }\n\n    if (layerRenderer.prepareFrame(frameState, layerState)) {\n      layerRenderer.composeFrame(frameState, layerState, context);\n    }\n  }\n\n  if (rotation) {\n    context.restore();\n  }\n\n  this.dispatchComposeEvent_(_ol_render_EventType_.POSTCOMPOSE, frameState);\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_renderer_canvas_Map_.prototype.forEachLayerAtPixel = function (pixel, frameState, callback, thisArg, layerFilter, thisArg2) {\n  var result;\n  var viewState = frameState.viewState;\n  var viewResolution = viewState.resolution;\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n\n  var coordinate = _ol_transform_.apply(frameState.pixelToCoordinateTransform, pixel.slice());\n\n  var i;\n\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {\n      var layerRenderer =\n      /** @type {ol.renderer.canvas.Layer} */\n      this.getLayerRenderer(layer);\n      result = layerRenderer.forEachLayerAtCoordinate(coordinate, frameState, callback, thisArg);\n\n      if (result) {\n        return result;\n      }\n    }\n  }\n\n  return undefined;\n};\n\nexport default _ol_renderer_canvas_Map_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/canvas/map.js"],"names":["_ol_transform_","_ol_","_ol_array_","_ol_css_","_ol_dom_","_ol_layer_Layer_","_ol_render_Event_","_ol_render_EventType_","_ol_render_canvas_","_ol_render_canvas_Immediate_","_ol_renderer_Map_","_ol_renderer_Type_","_ol_source_State_","_ol_renderer_canvas_Map_","container","map","call","context_","createCanvasContext2D","canvas_","canvas","style","width","height","display","className","CLASS_UNSELECTABLE","insertBefore","childNodes","renderedVisible_","transform_","create","inherits","type","CANVAS","prototype","dispatchComposeEvent_","frameState","getMap","context","hasListener","extent","pixelRatio","viewState","rotation","transform","getTransform","vectorContext","composeEvent","dispatchEvent","dx1","dy1","sx","resolution","sy","angle","dx2","center","dy2","compose","getType","renderFrame","Math","round","size","clearRect","calculateMatrices2D","PRECOMPOSE","layerStatesArray","stableSort","sortByZIndex","save","rotateAtOffset","viewResolution","i","ii","layer","layerRenderer","layerState","length","getLayerRenderer","visibleAtResolution","sourceState","READY","prepareFrame","composeFrame","restore","POSTCOMPOSE","scheduleRemoveUnusedLayerRenderers","scheduleExpireIconCache","forEachLayerAtPixel","pixel","callback","thisArg","layerFilter","thisArg2","result","layerStates","numLayers","coordinate","apply","pixelToCoordinateTransform","slice","forEachLayerAtCoordinate","undefined"],"mappings":"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","sourcesContent":["// FIXME offset panning\n\nimport _ol_transform_ from '../../transform.js';\nimport _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_css_ from '../../css.js';\nimport _ol_dom_ from '../../dom.js';\nimport _ol_layer_Layer_ from '../../layer/layer.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_canvas_ from '../../render/canvas.js';\nimport _ol_render_canvas_Immediate_ from '../../render/canvas/immediate.js';\nimport _ol_renderer_Map_ from '../map.js';\nimport _ol_renderer_Type_ from '../type.js';\nimport _ol_source_State_ from '../../source/state.js';\n\n/**\n * @constructor\n * @extends {ol.renderer.Map}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @api\n */\nvar _ol_renderer_canvas_Map_ = function(container, map) {\n\n  _ol_renderer_Map_.call(this, container, map);\n\n  /**\n   * @private\n   * @type {CanvasRenderingContext2D}\n   */\n  this.context_ = _ol_dom_.createCanvasContext2D();\n\n  /**\n   * @private\n   * @type {HTMLCanvasElement}\n   */\n  this.canvas_ = this.context_.canvas;\n\n  this.canvas_.style.width = '100%';\n  this.canvas_.style.height = '100%';\n  this.canvas_.style.display = 'block';\n  this.canvas_.className = _ol_css_.CLASS_UNSELECTABLE;\n  container.insertBefore(this.canvas_, container.childNodes[0] || null);\n\n  /**\n   * @private\n   * @type {boolean}\n   */\n  this.renderedVisible_ = true;\n\n  /**\n   * @private\n   * @type {ol.Transform}\n   */\n  this.transform_ = _ol_transform_.create();\n\n};\n\n_ol_.inherits(_ol_renderer_canvas_Map_, _ol_renderer_Map_);\n\n\n/**\n * Determine if this renderer handles the provided layer.\n * @param {ol.renderer.Type} type The renderer type.\n * @return {boolean} The renderer can render the layer.\n */\n_ol_renderer_canvas_Map_['handles'] = function(type) {\n  return type === _ol_renderer_Type_.CANVAS;\n};\n\n\n/**\n * Create the map renderer.\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @return {ol.renderer.canvas.Map} The map renderer.\n */\n_ol_renderer_canvas_Map_['create'] = function(container, map) {\n  return new _ol_renderer_canvas_Map_(container, map);\n};\n\n\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_canvas_Map_.prototype.dispatchComposeEvent_ = function(type, frameState) {\n  var map = this.getMap();\n  var context = this.context_;\n  if (map.hasListener(type)) {\n    var extent = frameState.extent;\n    var pixelRatio = frameState.pixelRatio;\n    var viewState = frameState.viewState;\n    var rotation = viewState.rotation;\n\n    var transform = this.getTransform(frameState);\n\n    var vectorContext = new _ol_render_canvas_Immediate_(context, pixelRatio,\n        extent, transform, rotation);\n    var composeEvent = new _ol_render_Event_(type, vectorContext,\n        frameState, context, null);\n    map.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @protected\n * @return {!ol.Transform} Transform.\n */\n_ol_renderer_canvas_Map_.prototype.getTransform = function(frameState) {\n  var viewState = frameState.viewState;\n  var dx1 = this.canvas_.width / 2;\n  var dy1 = this.canvas_.height / 2;\n  var sx = frameState.pixelRatio / viewState.resolution;\n  var sy = -sx;\n  var angle = -viewState.rotation;\n  var dx2 = -viewState.center[0];\n  var dy2 = -viewState.center[1];\n  return _ol_transform_.compose(this.transform_, dx1, dy1, sx, sy, angle, dx2, dy2);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_Map_.prototype.getType = function() {\n  return _ol_renderer_Type_.CANVAS;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_Map_.prototype.renderFrame = function(frameState) {\n\n  if (!frameState) {\n    if (this.renderedVisible_) {\n      this.canvas_.style.display = 'none';\n      this.renderedVisible_ = false;\n    }\n    return;\n  }\n\n  var context = this.context_;\n  var pixelRatio = frameState.pixelRatio;\n  var width = Math.round(frameState.size[0] * pixelRatio);\n  var height = Math.round(frameState.size[1] * pixelRatio);\n  if (this.canvas_.width != width || this.canvas_.height != height) {\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n  } else {\n    context.clearRect(0, 0, width, height);\n  }\n\n  var rotation = frameState.viewState.rotation;\n\n  this.calculateMatrices2D(frameState);\n\n  this.dispatchComposeEvent_(_ol_render_EventType_.PRECOMPOSE, frameState);\n\n  var layerStatesArray = frameState.layerStatesArray;\n  _ol_array_.stableSort(layerStatesArray, _ol_renderer_Map_.sortByZIndex);\n\n  if (rotation) {\n    context.save();\n    _ol_render_canvas_.rotateAtOffset(context, rotation, width / 2, height / 2);\n  }\n\n  var viewResolution = frameState.viewState.resolution;\n  var i, ii, layer, layerRenderer, layerState;\n  for (i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n    layerState = layerStatesArray[i];\n    layer = layerState.layer;\n    layerRenderer = /** @type {ol.renderer.canvas.Layer} */ (this.getLayerRenderer(layer));\n    if (!_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) ||\n        layerState.sourceState != _ol_source_State_.READY) {\n      continue;\n    }\n    if (layerRenderer.prepareFrame(frameState, layerState)) {\n      layerRenderer.composeFrame(frameState, layerState, context);\n    }\n  }\n\n  if (rotation) {\n    context.restore();\n  }\n\n  this.dispatchComposeEvent_(\n      _ol_render_EventType_.POSTCOMPOSE, frameState);\n\n  if (!this.renderedVisible_) {\n    this.canvas_.style.display = '';\n    this.renderedVisible_ = true;\n  }\n\n  this.scheduleRemoveUnusedLayerRenderers(frameState);\n  this.scheduleExpireIconCache(frameState);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_renderer_canvas_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg,\n    layerFilter, thisArg2) {\n  var result;\n  var viewState = frameState.viewState;\n  var viewResolution = viewState.resolution;\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n\n  var coordinate = _ol_transform_.apply(\n      frameState.pixelToCoordinateTransform, pixel.slice());\n\n  var i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) &&\n        layerFilter.call(thisArg2, layer)) {\n      var layerRenderer = /** @type {ol.renderer.canvas.Layer} */ (this.getLayerRenderer(layer));\n      result = layerRenderer.forEachLayerAtCoordinate(\n          coordinate, frameState, callback, thisArg);\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\nexport default _ol_renderer_canvas_Map_;\n"]},"metadata":{},"sourceType":"module"}