{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_color_ from '../../color.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_geom_flat_orient_ from '../../geom/flat/orient.js';\nimport _ol_geom_flat_transform_ from '../../geom/flat/transform.js';\nimport _ol_geom_flat_topology_ from '../../geom/flat/topology.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_render_webgl_ from '../webgl.js';\nimport _ol_render_webgl_Replay_ from '../webgl/replay.js';\nimport _ol_render_webgl_linestringreplay_defaultshader_ from '../webgl/linestringreplay/defaultshader.js';\nimport _ol_render_webgl_linestringreplay_defaultshader_Locations_ from '../webgl/linestringreplay/defaultshader/locations.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\n/**\n * @constructor\n * @extends {ol.render.webgl.Replay}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\n\nvar _ol_render_webgl_LineStringReplay_ = function (tolerance, maxExtent) {\n  _ol_render_webgl_Replay_.call(this, tolerance, maxExtent);\n  /**\n   * @private\n   * @type {ol.render.webgl.linestringreplay.defaultshader.Locations}\n   */\n\n\n  this.defaultLocations_ = null;\n  /**\n   * @private\n   * @type {Array.<Array.<?>>}\n   */\n\n  this.styles_ = [];\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n\n  this.styleIndices_ = [];\n  /**\n   * @private\n   * @type {{strokeColor: (Array.<number>|null),\n   *         lineCap: (string|undefined),\n   *         lineDash: Array.<number>,\n   *         lineDashOffset: (number|undefined),\n   *         lineJoin: (string|undefined),\n   *         lineWidth: (number|undefined),\n   *         miterLimit: (number|undefined),\n   *         changed: boolean}|null}\n   */\n\n  this.state_ = {\n    strokeColor: null,\n    lineCap: undefined,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineJoin: undefined,\n    lineWidth: undefined,\n    miterLimit: undefined,\n    changed: false\n  };\n};\n\n_ol_.inherits(_ol_render_webgl_LineStringReplay_, _ol_render_webgl_Replay_);\n/**\n * Draw one segment.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawCoordinates_ = function (flatCoordinates, offset, end, stride) {\n  var i, ii;\n  var numVertices = this.vertices.length;\n  var numIndices = this.indices.length; //To save a vertex, the direction of a point is a product of the sign (1 or -1), a prime from\n  //ol.render.webgl.LineStringReplay.Instruction_, and a rounding factor (1 or 2). If the product is even,\n  //we round it. If it is odd, we don't.\n\n  var lineJoin = this.state_.lineJoin === 'bevel' ? 0 : this.state_.lineJoin === 'miter' ? 1 : 2;\n  var lineCap = this.state_.lineCap === 'butt' ? 0 : this.state_.lineCap === 'square' ? 1 : 2;\n\n  var closed = _ol_geom_flat_topology_.lineStringIsClosed(flatCoordinates, offset, end, stride);\n\n  var startCoords, sign, n;\n  var lastIndex = numIndices;\n  var lastSign = 1; //We need the adjacent vertices to define normals in joins. p0 = last, p1 = current, p2 = next.\n\n  var p0, p1, p2;\n\n  for (i = offset, ii = end; i < ii; i += stride) {\n    n = numVertices / 7;\n    p0 = p1;\n    p1 = p2 || [flatCoordinates[i], flatCoordinates[i + 1]]; //First vertex.\n\n    if (i === offset) {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n\n      if (end - offset === stride * 2 && _ol_array_.equals(p1, p2)) {\n        break;\n      }\n\n      if (closed) {\n        //A closed line! Complete the circle.\n        p0 = [flatCoordinates[end - stride * 2], flatCoordinates[end - stride * 2 + 1]];\n        startCoords = p2;\n      } else {\n        //Add the first two/four vertices.\n        if (lineCap) {\n          numVertices = this.addVertices_([0, 0], p1, p2, lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);\n          numVertices = this.addVertices_([0, 0], p1, p2, -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n        }\n\n        numVertices = this.addVertices_([0, 0], p1, p2, lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);\n        numVertices = this.addVertices_([0, 0], p1, p2, -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);\n        lastIndex = numVertices / 7 - 1;\n        continue;\n      }\n    } else if (i === end - stride) {\n      //Last vertex.\n      if (closed) {\n        //Same as the first vertex.\n        p2 = startCoords;\n        break;\n      } else {\n        p0 = p0 || [0, 0];\n        numVertices = this.addVertices_(p0, p1, [0, 0], lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);\n        numVertices = this.addVertices_(p0, p1, [0, 0], -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);\n        this.indices[numIndices++] = n;\n        this.indices[numIndices++] = lastIndex - 1;\n        this.indices[numIndices++] = lastIndex;\n        this.indices[numIndices++] = lastIndex;\n        this.indices[numIndices++] = n + 1;\n        this.indices[numIndices++] = n;\n\n        if (lineCap) {\n          numVertices = this.addVertices_(p0, p1, [0, 0], lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);\n          numVertices = this.addVertices_(p0, p1, [0, 0], -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n        }\n\n        break;\n      }\n    } else {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n    } // We group CW and straight lines, thus the not so inituitive CCW checking function.\n\n\n    sign = _ol_render_webgl_.triangleIsCounterClockwise(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1]) ? -1 : 1;\n    numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);\n    numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_SECOND * (lineJoin || 1), numVertices);\n    numVertices = this.addVertices_(p0, p1, p2, -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);\n\n    if (i > offset) {\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastIndex - 1;\n      this.indices[numIndices++] = lastIndex;\n      this.indices[numIndices++] = n + 2;\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n    }\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n + 1;\n    lastIndex = n + 2;\n    lastSign = sign; //Add miter\n\n    if (lineJoin) {\n      numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_TOP * lineJoin, numVertices);\n      this.indices[numIndices++] = n + 1;\n      this.indices[numIndices++] = n + 3;\n      this.indices[numIndices++] = n;\n    }\n  }\n\n  if (closed) {\n    n = n || numVertices / 7;\n    sign = _ol_geom_flat_orient_.linearRingIsClockwise([p0[0], p0[1], p1[0], p1[1], p2[0], p2[1]], 0, 6, 2) ? 1 : -1;\n    numVertices = this.addVertices_(p0, p1, p2, sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);\n    numVertices = this.addVertices_(p0, p1, p2, -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastIndex - 1;\n    this.indices[numIndices++] = lastIndex;\n    this.indices[numIndices++] = n + 1;\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n  }\n};\n/**\n * @param {Array.<number>} p0 Last coordinates.\n * @param {Array.<number>} p1 Current coordinates.\n * @param {Array.<number>} p2 Next coordinates.\n * @param {number} product Sign, instruction, and rounding product.\n * @param {number} numVertices Vertex counter.\n * @return {number} Vertex counter.\n * @private\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.addVertices_ = function (p0, p1, p2, product, numVertices) {\n  this.vertices[numVertices++] = p0[0];\n  this.vertices[numVertices++] = p0[1];\n  this.vertices[numVertices++] = p1[0];\n  this.vertices[numVertices++] = p1[1];\n  this.vertices[numVertices++] = p2[0];\n  this.vertices[numVertices++] = p2[1];\n  this.vertices[numVertices++] = product;\n  return numVertices;\n};\n/**\n * Check if the linestring can be drawn (i. e. valid).\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {boolean} The linestring can be drawn.\n * @private\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.isValid_ = function (flatCoordinates, offset, end, stride) {\n  var range = end - offset;\n\n  if (range < stride * 2) {\n    return false;\n  } else if (range === stride * 2) {\n    var firstP = [flatCoordinates[offset], flatCoordinates[offset + 1]];\n    var lastP = [flatCoordinates[offset + stride], flatCoordinates[offset + stride + 1]];\n    return !_ol_array_.equals(firstP, lastP);\n  }\n\n  return true;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawLineString = function (lineStringGeometry, feature) {\n  var flatCoordinates = lineStringGeometry.getFlatCoordinates();\n  var stride = lineStringGeometry.getStride();\n\n  if (this.isValid_(flatCoordinates, 0, flatCoordinates.length, stride)) {\n    flatCoordinates = _ol_geom_flat_transform_.translate(flatCoordinates, 0, flatCoordinates.length, stride, -this.origin[0], -this.origin[1]);\n\n    if (this.state_.changed) {\n      this.styleIndices_.push(this.indices.length);\n      this.state_.changed = false;\n    }\n\n    this.startIndices.push(this.indices.length);\n    this.startIndicesFeature.push(feature);\n    this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawMultiLineString = function (multiLineStringGeometry, feature) {\n  var indexCount = this.indices.length;\n  var ends = multiLineStringGeometry.getEnds();\n  ends.unshift(0);\n  var flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\n  var stride = multiLineStringGeometry.getStride();\n  var i, ii;\n\n  if (ends.length > 1) {\n    for (i = 1, ii = ends.length; i < ii; ++i) {\n      if (this.isValid_(flatCoordinates, ends[i - 1], ends[i], stride)) {\n        var lineString = _ol_geom_flat_transform_.translate(flatCoordinates, ends[i - 1], ends[i], stride, -this.origin[0], -this.origin[1]);\n\n        this.drawCoordinates_(lineString, 0, lineString.length, stride);\n      }\n    }\n  }\n\n  if (this.indices.length > indexCount) {\n    this.startIndices.push(indexCount);\n    this.startIndicesFeature.push(feature);\n\n    if (this.state_.changed) {\n      this.styleIndices_.push(indexCount);\n      this.state_.changed = false;\n    }\n  }\n};\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawPolygonCoordinates = function (flatCoordinates, holeFlatCoordinates, stride) {\n  if (!_ol_geom_flat_topology_.lineStringIsClosed(flatCoordinates, 0, flatCoordinates.length, stride)) {\n    flatCoordinates.push(flatCoordinates[0]);\n    flatCoordinates.push(flatCoordinates[1]);\n  }\n\n  this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n\n  if (holeFlatCoordinates.length) {\n    var i, ii;\n\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      if (!_ol_geom_flat_topology_.lineStringIsClosed(holeFlatCoordinates[i], 0, holeFlatCoordinates[i].length, stride)) {\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][0]);\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][1]);\n      }\n\n      this.drawCoordinates_(holeFlatCoordinates[i], 0, holeFlatCoordinates[i].length, stride);\n    }\n  }\n};\n/**\n * @param {ol.Feature|ol.render.Feature} feature Feature.\n * @param {number=} opt_index Index count.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.setPolygonStyle = function (feature, opt_index) {\n  var index = opt_index === undefined ? this.indices.length : opt_index;\n  this.startIndices.push(index);\n  this.startIndicesFeature.push(feature);\n\n  if (this.state_.changed) {\n    this.styleIndices_.push(index);\n    this.state_.changed = false;\n  }\n};\n/**\n * @return {number} Current index.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.getCurrentIndex = function () {\n  return this.indices.length;\n};\n/**\n * @inheritDoc\n **/\n\n\n_ol_render_webgl_LineStringReplay_.prototype.finish = function (context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new _ol_webgl_Buffer_(this.vertices); // create, bind, and populate the indices buffer\n\n  this.indicesBuffer = new _ol_webgl_Buffer_(this.indices);\n  this.startIndices.push(this.indices.length); //Clean up, if there is nothing to draw\n\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.getDeleteResourcesFunction = function (context) {\n  var verticesBuffer = this.verticesBuffer;\n  var indicesBuffer = this.indicesBuffer;\n  return function () {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n  };\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.setUpProgram = function (gl, context, size, pixelRatio) {\n  // get the program\n  var fragmentShader, vertexShader;\n  fragmentShader = _ol_render_webgl_linestringreplay_defaultshader_.fragment;\n  vertexShader = _ol_render_webgl_linestringreplay_defaultshader_.vertex;\n  var program = context.getProgram(fragmentShader, vertexShader); // get the locations\n\n  var locations;\n\n  if (!this.defaultLocations_) {\n    locations = new _ol_render_webgl_linestringreplay_defaultshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program); // enable the vertex attrib arrays\n\n  gl.enableVertexAttribArray(locations.a_lastPos);\n  gl.vertexAttribPointer(locations.a_lastPos, 2, _ol_webgl_.FLOAT, false, 28, 0);\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, _ol_webgl_.FLOAT, false, 28, 8);\n  gl.enableVertexAttribArray(locations.a_nextPos);\n  gl.vertexAttribPointer(locations.a_nextPos, 2, _ol_webgl_.FLOAT, false, 28, 16);\n  gl.enableVertexAttribArray(locations.a_direction);\n  gl.vertexAttribPointer(locations.a_direction, 1, _ol_webgl_.FLOAT, false, 28, 24); // Enable renderer specific uniforms.\n\n  gl.uniform2fv(locations.u_size, size);\n  gl.uniform1f(locations.u_pixelRatio, pixelRatio);\n  return locations;\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.shutDownProgram = function (gl, locations) {\n  gl.disableVertexAttribArray(locations.a_lastPos);\n  gl.disableVertexAttribArray(locations.a_position);\n  gl.disableVertexAttribArray(locations.a_nextPos);\n  gl.disableVertexAttribArray(locations.a_direction);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawReplay = function (gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  var tmpDepthFunc =\n  /** @type {number} */\n  gl.getParameter(gl.DEPTH_FUNC);\n  var tmpDepthMask =\n  /** @type {boolean} */\n  gl.getParameter(gl.DEPTH_WRITEMASK);\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!_ol_obj_.isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    var i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      end = start;\n    }\n  }\n\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT); //Restore GL parameters.\n\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawReplaySkipping_ = function (gl, context, skippedFeaturesHash) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n\n        end = featureStart;\n      }\n\n      featureIndex--;\n      start = featureStart;\n    }\n\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n\n    start = end = groupStart;\n  }\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.drawHitDetectionReplayOneByOne = function (gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 && this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined && feature.getGeometry() && (opt_hitExtent === undefined || _ol_extent_.intersects(\n      /** @type {Array<number>} */\n      opt_hitExtent, feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n        var result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n      }\n\n      featureIndex--;\n      end = start;\n    }\n  }\n\n  return undefined;\n};\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n * @param {number} lineWidth Line width.\n * @param {number} miterLimit Miter limit.\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.setStrokeStyle_ = function (gl, color, lineWidth, miterLimit) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n  gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);\n  gl.uniform1f(this.defaultLocations_.u_miterLimit, miterLimit);\n};\n/**\n * @inheritDoc\n */\n\n\n_ol_render_webgl_LineStringReplay_.prototype.setFillStrokeStyle = function (fillStyle, strokeStyle) {\n  var strokeStyleLineCap = strokeStyle.getLineCap();\n  this.state_.lineCap = strokeStyleLineCap !== undefined ? strokeStyleLineCap : _ol_render_webgl_.defaultLineCap;\n  var strokeStyleLineDash = strokeStyle.getLineDash();\n  this.state_.lineDash = strokeStyleLineDash ? strokeStyleLineDash : _ol_render_webgl_.defaultLineDash;\n  var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n  this.state_.lineDashOffset = strokeStyleLineDashOffset ? strokeStyleLineDashOffset : _ol_render_webgl_.defaultLineDashOffset;\n  var strokeStyleLineJoin = strokeStyle.getLineJoin();\n  this.state_.lineJoin = strokeStyleLineJoin !== undefined ? strokeStyleLineJoin : _ol_render_webgl_.defaultLineJoin;\n  var strokeStyleColor = strokeStyle.getColor();\n\n  if (!(strokeStyleColor instanceof CanvasGradient) && !(strokeStyleColor instanceof CanvasPattern)) {\n    strokeStyleColor = _ol_color_.asArray(strokeStyleColor).map(function (c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || _ol_render_webgl_.defaultStrokeStyle;\n  } else {\n    strokeStyleColor = _ol_render_webgl_.defaultStrokeStyle;\n  }\n\n  var strokeStyleWidth = strokeStyle.getWidth();\n  strokeStyleWidth = strokeStyleWidth !== undefined ? strokeStyleWidth : _ol_render_webgl_.defaultLineWidth;\n  var strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n  strokeStyleMiterLimit = strokeStyleMiterLimit !== undefined ? strokeStyleMiterLimit : _ol_render_webgl_.defaultMiterLimit;\n\n  if (!this.state_.strokeColor || !_ol_array_.equals(this.state_.strokeColor, strokeStyleColor) || this.state_.lineWidth !== strokeStyleWidth || this.state_.miterLimit !== strokeStyleMiterLimit) {\n    this.state_.changed = true;\n    this.state_.strokeColor = strokeStyleColor;\n    this.state_.lineWidth = strokeStyleWidth;\n    this.state_.miterLimit = strokeStyleMiterLimit;\n    this.styles_.push([strokeStyleColor, strokeStyleWidth, strokeStyleMiterLimit]);\n  }\n};\n/**\n * @enum {number}\n * @private\n */\n\n\n_ol_render_webgl_LineStringReplay_.Instruction_ = {\n  ROUND: 2,\n  BEGIN_LINE: 3,\n  END_LINE: 5,\n  BEGIN_LINE_CAP: 7,\n  END_LINE_CAP: 11,\n  BEVEL_FIRST: 13,\n  BEVEL_SECOND: 17,\n  MITER_BOTTOM: 19,\n  MITER_TOP: 23\n};\nexport default _ol_render_webgl_LineStringReplay_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/render/webgl/linestringreplay.js"],"names":["_ol_","_ol_array_","_ol_color_","_ol_extent_","_ol_geom_flat_orient_","_ol_geom_flat_transform_","_ol_geom_flat_topology_","_ol_obj_","_ol_render_webgl_","_ol_render_webgl_Replay_","_ol_render_webgl_linestringreplay_defaultshader_","_ol_render_webgl_linestringreplay_defaultshader_Locations_","_ol_webgl_","_ol_webgl_Buffer_","_ol_render_webgl_LineStringReplay_","tolerance","maxExtent","call","defaultLocations_","styles_","styleIndices_","state_","strokeColor","lineCap","undefined","lineDash","lineDashOffset","lineJoin","lineWidth","miterLimit","changed","inherits","prototype","drawCoordinates_","flatCoordinates","offset","end","stride","i","ii","numVertices","vertices","length","numIndices","indices","closed","lineStringIsClosed","startCoords","sign","n","lastIndex","lastSign","p0","p1","p2","equals","addVertices_","Instruction_","BEGIN_LINE_CAP","BEGIN_LINE","END_LINE","END_LINE_CAP","triangleIsCounterClockwise","BEVEL_FIRST","BEVEL_SECOND","MITER_BOTTOM","MITER_TOP","linearRingIsClockwise","product","isValid_","range","firstP","lastP","drawLineString","lineStringGeometry","feature","getFlatCoordinates","getStride","translate","origin","push","startIndices","startIndicesFeature","drawMultiLineString","multiLineStringGeometry","indexCount","ends","getEnds","unshift","lineString","drawPolygonCoordinates","holeFlatCoordinates","setPolygonStyle","opt_index","index","getCurrentIndex","finish","context","verticesBuffer","indicesBuffer","getDeleteResourcesFunction","deleteBuffer","setUpProgram","gl","size","pixelRatio","fragmentShader","vertexShader","fragment","vertex","program","getProgram","locations","useProgram","enableVertexAttribArray","a_lastPos","vertexAttribPointer","FLOAT","a_position","a_nextPos","a_direction","uniform2fv","u_size","uniform1f","u_pixelRatio","shutDownProgram","disableVertexAttribArray","drawReplay","skippedFeaturesHash","hitDetection","tmpDepthFunc","getParameter","DEPTH_FUNC","tmpDepthMask","DEPTH_WRITEMASK","enable","DEPTH_TEST","depthMask","depthFunc","NOTEQUAL","isEmpty","drawReplaySkipping_","start","nextStyle","setStrokeStyle_","drawElements","clear","DEPTH_BUFFER_BIT","disable","groupStart","featureUid","featureIndex","featureStart","getUid","toString","drawHitDetectionReplayOneByOne","featureCallback","opt_hitExtent","getGeometry","intersects","getExtent","COLOR_BUFFER_BIT","result","color","uniform4fv","u_color","u_lineWidth","u_miterLimit","setFillStrokeStyle","fillStyle","strokeStyle","strokeStyleLineCap","getLineCap","defaultLineCap","strokeStyleLineDash","getLineDash","defaultLineDash","strokeStyleLineDashOffset","getLineDashOffset","defaultLineDashOffset","strokeStyleLineJoin","getLineJoin","defaultLineJoin","strokeStyleColor","getColor","CanvasGradient","CanvasPattern","asArray","map","c","defaultStrokeStyle","strokeStyleWidth","getWidth","defaultLineWidth","strokeStyleMiterLimit","getMiterLimit","defaultMiterLimit","ROUND"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_array_ from '../../array.js';\nimport _ol_color_ from '../../color.js';\nimport _ol_extent_ from '../../extent.js';\nimport _ol_geom_flat_orient_ from '../../geom/flat/orient.js';\nimport _ol_geom_flat_transform_ from '../../geom/flat/transform.js';\nimport _ol_geom_flat_topology_ from '../../geom/flat/topology.js';\nimport _ol_obj_ from '../../obj.js';\nimport _ol_render_webgl_ from '../webgl.js';\nimport _ol_render_webgl_Replay_ from '../webgl/replay.js';\nimport _ol_render_webgl_linestringreplay_defaultshader_ from '../webgl/linestringreplay/defaultshader.js';\nimport _ol_render_webgl_linestringreplay_defaultshader_Locations_ from '../webgl/linestringreplay/defaultshader/locations.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\n\n/**\n * @constructor\n * @extends {ol.render.webgl.Replay}\n * @param {number} tolerance Tolerance.\n * @param {ol.Extent} maxExtent Max extent.\n * @struct\n */\nvar _ol_render_webgl_LineStringReplay_ = function(tolerance, maxExtent) {\n  _ol_render_webgl_Replay_.call(this, tolerance, maxExtent);\n\n  /**\n   * @private\n   * @type {ol.render.webgl.linestringreplay.defaultshader.Locations}\n   */\n  this.defaultLocations_ = null;\n\n  /**\n   * @private\n   * @type {Array.<Array.<?>>}\n   */\n  this.styles_ = [];\n\n  /**\n   * @private\n   * @type {Array.<number>}\n   */\n  this.styleIndices_ = [];\n\n  /**\n   * @private\n   * @type {{strokeColor: (Array.<number>|null),\n   *         lineCap: (string|undefined),\n   *         lineDash: Array.<number>,\n   *         lineDashOffset: (number|undefined),\n   *         lineJoin: (string|undefined),\n   *         lineWidth: (number|undefined),\n   *         miterLimit: (number|undefined),\n   *         changed: boolean}|null}\n   */\n  this.state_ = {\n    strokeColor: null,\n    lineCap: undefined,\n    lineDash: null,\n    lineDashOffset: undefined,\n    lineJoin: undefined,\n    lineWidth: undefined,\n    miterLimit: undefined,\n    changed: false\n  };\n\n};\n\n_ol_.inherits(_ol_render_webgl_LineStringReplay_, _ol_render_webgl_Replay_);\n\n\n/**\n * Draw one segment.\n * @private\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawCoordinates_ = function(flatCoordinates, offset, end, stride) {\n\n  var i, ii;\n  var numVertices = this.vertices.length;\n  var numIndices = this.indices.length;\n  //To save a vertex, the direction of a point is a product of the sign (1 or -1), a prime from\n  //ol.render.webgl.LineStringReplay.Instruction_, and a rounding factor (1 or 2). If the product is even,\n  //we round it. If it is odd, we don't.\n  var lineJoin = this.state_.lineJoin === 'bevel' ? 0 :\n    this.state_.lineJoin === 'miter' ? 1 : 2;\n  var lineCap = this.state_.lineCap === 'butt' ? 0 :\n    this.state_.lineCap === 'square' ? 1 : 2;\n  var closed = _ol_geom_flat_topology_.lineStringIsClosed(flatCoordinates, offset, end, stride);\n  var startCoords, sign, n;\n  var lastIndex = numIndices;\n  var lastSign = 1;\n  //We need the adjacent vertices to define normals in joins. p0 = last, p1 = current, p2 = next.\n  var p0, p1, p2;\n\n  for (i = offset, ii = end; i < ii; i += stride) {\n\n    n = numVertices / 7;\n\n    p0 = p1;\n    p1 = p2 || [flatCoordinates[i], flatCoordinates[i + 1]];\n    //First vertex.\n    if (i === offset) {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n      if (end - offset === stride * 2 && _ol_array_.equals(p1, p2)) {\n        break;\n      }\n      if (closed) {\n        //A closed line! Complete the circle.\n        p0 = [flatCoordinates[end - stride * 2],\n          flatCoordinates[end - stride * 2 + 1]];\n\n        startCoords = p2;\n      } else {\n        //Add the first two/four vertices.\n\n        if (lineCap) {\n          numVertices = this.addVertices_([0, 0], p1, p2,\n              lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);\n\n          numVertices = this.addVertices_([0, 0], p1, p2,\n              -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE_CAP * lineCap, numVertices);\n\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n\n        }\n\n        numVertices = this.addVertices_([0, 0], p1, p2,\n            lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);\n\n        numVertices = this.addVertices_([0, 0], p1, p2,\n            -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.BEGIN_LINE * (lineCap || 1), numVertices);\n\n        lastIndex = numVertices / 7 - 1;\n\n        continue;\n      }\n    } else if (i === end - stride) {\n      //Last vertex.\n      if (closed) {\n        //Same as the first vertex.\n        p2 = startCoords;\n        break;\n      } else {\n        p0 = p0 || [0, 0];\n\n        numVertices = this.addVertices_(p0, p1, [0, 0],\n            lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);\n\n        numVertices = this.addVertices_(p0, p1, [0, 0],\n            -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE * (lineCap || 1), numVertices);\n\n        this.indices[numIndices++] = n;\n        this.indices[numIndices++] = lastIndex - 1;\n        this.indices[numIndices++] = lastIndex;\n\n        this.indices[numIndices++] = lastIndex;\n        this.indices[numIndices++] = n + 1;\n        this.indices[numIndices++] = n;\n\n        if (lineCap) {\n          numVertices = this.addVertices_(p0, p1, [0, 0],\n              lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);\n\n          numVertices = this.addVertices_(p0, p1, [0, 0],\n              -lastSign * _ol_render_webgl_LineStringReplay_.Instruction_.END_LINE_CAP * lineCap, numVertices);\n\n          this.indices[numIndices++] = n + 2;\n          this.indices[numIndices++] = n;\n          this.indices[numIndices++] = n + 1;\n\n          this.indices[numIndices++] = n + 1;\n          this.indices[numIndices++] = n + 3;\n          this.indices[numIndices++] = n + 2;\n\n        }\n\n        break;\n      }\n    } else {\n      p2 = [flatCoordinates[i + stride], flatCoordinates[i + stride + 1]];\n    }\n\n    // We group CW and straight lines, thus the not so inituitive CCW checking function.\n    sign = _ol_render_webgl_.triangleIsCounterClockwise(p0[0], p0[1], p1[0], p1[1], p2[0], p2[1])\n      ? -1 : 1;\n\n    numVertices = this.addVertices_(p0, p1, p2,\n        sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n        sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_SECOND * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n        -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);\n\n    if (i > offset) {\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastIndex - 1;\n      this.indices[numIndices++] = lastIndex;\n\n      this.indices[numIndices++] = n + 2;\n      this.indices[numIndices++] = n;\n      this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n    }\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = n + 2;\n    this.indices[numIndices++] = n + 1;\n\n    lastIndex = n + 2;\n    lastSign = sign;\n\n    //Add miter\n    if (lineJoin) {\n      numVertices = this.addVertices_(p0, p1, p2,\n          sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_TOP * lineJoin, numVertices);\n\n      this.indices[numIndices++] = n + 1;\n      this.indices[numIndices++] = n + 3;\n      this.indices[numIndices++] = n;\n    }\n  }\n\n  if (closed) {\n    n = n || numVertices / 7;\n    sign = _ol_geom_flat_orient_.linearRingIsClockwise([p0[0], p0[1], p1[0], p1[1], p2[0], p2[1]], 0, 6, 2)\n      ? 1 : -1;\n\n    numVertices = this.addVertices_(p0, p1, p2,\n        sign * _ol_render_webgl_LineStringReplay_.Instruction_.BEVEL_FIRST * (lineJoin || 1), numVertices);\n\n    numVertices = this.addVertices_(p0, p1, p2,\n        -sign * _ol_render_webgl_LineStringReplay_.Instruction_.MITER_BOTTOM * (lineJoin || 1), numVertices);\n\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastIndex - 1;\n    this.indices[numIndices++] = lastIndex;\n\n    this.indices[numIndices++] = n + 1;\n    this.indices[numIndices++] = n;\n    this.indices[numIndices++] = lastSign * sign > 0 ? lastIndex : lastIndex - 1;\n  }\n};\n\n/**\n * @param {Array.<number>} p0 Last coordinates.\n * @param {Array.<number>} p1 Current coordinates.\n * @param {Array.<number>} p2 Next coordinates.\n * @param {number} product Sign, instruction, and rounding product.\n * @param {number} numVertices Vertex counter.\n * @return {number} Vertex counter.\n * @private\n */\n_ol_render_webgl_LineStringReplay_.prototype.addVertices_ = function(p0, p1, p2, product, numVertices) {\n  this.vertices[numVertices++] = p0[0];\n  this.vertices[numVertices++] = p0[1];\n  this.vertices[numVertices++] = p1[0];\n  this.vertices[numVertices++] = p1[1];\n  this.vertices[numVertices++] = p2[0];\n  this.vertices[numVertices++] = p2[1];\n  this.vertices[numVertices++] = product;\n\n  return numVertices;\n};\n\n/**\n * Check if the linestring can be drawn (i. e. valid).\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} offset Offset.\n * @param {number} end End.\n * @param {number} stride Stride.\n * @return {boolean} The linestring can be drawn.\n * @private\n */\n_ol_render_webgl_LineStringReplay_.prototype.isValid_ = function(flatCoordinates, offset, end, stride) {\n  var range = end - offset;\n  if (range < stride * 2) {\n    return false;\n  } else if (range === stride * 2) {\n    var firstP = [flatCoordinates[offset], flatCoordinates[offset + 1]];\n    var lastP = [flatCoordinates[offset + stride], flatCoordinates[offset + stride + 1]];\n    return !_ol_array_.equals(firstP, lastP);\n  }\n\n  return true;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawLineString = function(lineStringGeometry, feature) {\n  var flatCoordinates = lineStringGeometry.getFlatCoordinates();\n  var stride = lineStringGeometry.getStride();\n  if (this.isValid_(flatCoordinates, 0, flatCoordinates.length, stride)) {\n    flatCoordinates = _ol_geom_flat_transform_.translate(flatCoordinates, 0, flatCoordinates.length,\n        stride, -this.origin[0], -this.origin[1]);\n    if (this.state_.changed) {\n      this.styleIndices_.push(this.indices.length);\n      this.state_.changed = false;\n    }\n    this.startIndices.push(this.indices.length);\n    this.startIndicesFeature.push(feature);\n    this.drawCoordinates_(\n        flatCoordinates, 0, flatCoordinates.length, stride);\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawMultiLineString = function(multiLineStringGeometry, feature) {\n  var indexCount = this.indices.length;\n  var ends = multiLineStringGeometry.getEnds();\n  ends.unshift(0);\n  var flatCoordinates = multiLineStringGeometry.getFlatCoordinates();\n  var stride = multiLineStringGeometry.getStride();\n  var i, ii;\n  if (ends.length > 1) {\n    for (i = 1, ii = ends.length; i < ii; ++i) {\n      if (this.isValid_(flatCoordinates, ends[i - 1], ends[i], stride)) {\n        var lineString = _ol_geom_flat_transform_.translate(flatCoordinates, ends[i - 1], ends[i],\n            stride, -this.origin[0], -this.origin[1]);\n        this.drawCoordinates_(\n            lineString, 0, lineString.length, stride);\n      }\n    }\n  }\n  if (this.indices.length > indexCount) {\n    this.startIndices.push(indexCount);\n    this.startIndicesFeature.push(feature);\n    if (this.state_.changed) {\n      this.styleIndices_.push(indexCount);\n      this.state_.changed = false;\n    }\n  }\n};\n\n\n/**\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {Array.<Array.<number>>} holeFlatCoordinates Hole flat coordinates.\n * @param {number} stride Stride.\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawPolygonCoordinates = function(\n    flatCoordinates, holeFlatCoordinates, stride) {\n  if (!_ol_geom_flat_topology_.lineStringIsClosed(flatCoordinates, 0,\n      flatCoordinates.length, stride)) {\n    flatCoordinates.push(flatCoordinates[0]);\n    flatCoordinates.push(flatCoordinates[1]);\n  }\n  this.drawCoordinates_(flatCoordinates, 0, flatCoordinates.length, stride);\n  if (holeFlatCoordinates.length) {\n    var i, ii;\n    for (i = 0, ii = holeFlatCoordinates.length; i < ii; ++i) {\n      if (!_ol_geom_flat_topology_.lineStringIsClosed(holeFlatCoordinates[i], 0,\n          holeFlatCoordinates[i].length, stride)) {\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][0]);\n        holeFlatCoordinates[i].push(holeFlatCoordinates[i][1]);\n      }\n      this.drawCoordinates_(holeFlatCoordinates[i], 0,\n          holeFlatCoordinates[i].length, stride);\n    }\n  }\n};\n\n\n/**\n * @param {ol.Feature|ol.render.Feature} feature Feature.\n * @param {number=} opt_index Index count.\n */\n_ol_render_webgl_LineStringReplay_.prototype.setPolygonStyle = function(feature, opt_index) {\n  var index = opt_index === undefined ? this.indices.length : opt_index;\n  this.startIndices.push(index);\n  this.startIndicesFeature.push(feature);\n  if (this.state_.changed) {\n    this.styleIndices_.push(index);\n    this.state_.changed = false;\n  }\n};\n\n\n/**\n * @return {number} Current index.\n */\n_ol_render_webgl_LineStringReplay_.prototype.getCurrentIndex = function() {\n  return this.indices.length;\n};\n\n\n/**\n * @inheritDoc\n **/\n_ol_render_webgl_LineStringReplay_.prototype.finish = function(context) {\n  // create, bind, and populate the vertices buffer\n  this.verticesBuffer = new _ol_webgl_Buffer_(this.vertices);\n\n  // create, bind, and populate the indices buffer\n  this.indicesBuffer = new _ol_webgl_Buffer_(this.indices);\n\n  this.startIndices.push(this.indices.length);\n\n  //Clean up, if there is nothing to draw\n  if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\n    this.styles_ = [];\n  }\n\n  this.vertices = null;\n  this.indices = null;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.getDeleteResourcesFunction = function(context) {\n  var verticesBuffer = this.verticesBuffer;\n  var indicesBuffer = this.indicesBuffer;\n  return function() {\n    context.deleteBuffer(verticesBuffer);\n    context.deleteBuffer(indicesBuffer);\n  };\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.setUpProgram = function(gl, context, size, pixelRatio) {\n  // get the program\n  var fragmentShader, vertexShader;\n  fragmentShader = _ol_render_webgl_linestringreplay_defaultshader_.fragment;\n  vertexShader = _ol_render_webgl_linestringreplay_defaultshader_.vertex;\n  var program = context.getProgram(fragmentShader, vertexShader);\n\n  // get the locations\n  var locations;\n  if (!this.defaultLocations_) {\n    locations = new _ol_render_webgl_linestringreplay_defaultshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  context.useProgram(program);\n\n  // enable the vertex attrib arrays\n  gl.enableVertexAttribArray(locations.a_lastPos);\n  gl.vertexAttribPointer(locations.a_lastPos, 2, _ol_webgl_.FLOAT,\n      false, 28, 0);\n\n  gl.enableVertexAttribArray(locations.a_position);\n  gl.vertexAttribPointer(locations.a_position, 2, _ol_webgl_.FLOAT,\n      false, 28, 8);\n\n  gl.enableVertexAttribArray(locations.a_nextPos);\n  gl.vertexAttribPointer(locations.a_nextPos, 2, _ol_webgl_.FLOAT,\n      false, 28, 16);\n\n  gl.enableVertexAttribArray(locations.a_direction);\n  gl.vertexAttribPointer(locations.a_direction, 1, _ol_webgl_.FLOAT,\n      false, 28, 24);\n\n  // Enable renderer specific uniforms.\n  gl.uniform2fv(locations.u_size, size);\n  gl.uniform1f(locations.u_pixelRatio, pixelRatio);\n\n  return locations;\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.shutDownProgram = function(gl, locations) {\n  gl.disableVertexAttribArray(locations.a_lastPos);\n  gl.disableVertexAttribArray(locations.a_position);\n  gl.disableVertexAttribArray(locations.a_nextPos);\n  gl.disableVertexAttribArray(locations.a_direction);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawReplay = function(gl, context, skippedFeaturesHash, hitDetection) {\n  //Save GL parameters.\n  var tmpDepthFunc = /** @type {number} */ (gl.getParameter(gl.DEPTH_FUNC));\n  var tmpDepthMask = /** @type {boolean} */ (gl.getParameter(gl.DEPTH_WRITEMASK));\n\n  if (!hitDetection) {\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    gl.depthFunc(gl.NOTEQUAL);\n  }\n\n  if (!_ol_obj_.isEmpty(skippedFeaturesHash)) {\n    this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\n  } else {\n    //Draw by style groups to minimize drawElements() calls.\n    var i, start, end, nextStyle;\n    end = this.startIndices[this.startIndices.length - 1];\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n      start = this.styleIndices_[i];\n      nextStyle = this.styles_[i];\n      this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n      end = start;\n    }\n  }\n  if (!hitDetection) {\n    gl.disable(gl.DEPTH_TEST);\n    gl.clear(gl.DEPTH_BUFFER_BIT);\n    //Restore GL parameters.\n    gl.depthMask(tmpDepthMask);\n    gl.depthFunc(tmpDepthFunc);\n  }\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {ol.webgl.Context} context Context.\n * @param {Object} skippedFeaturesHash Ids of features to skip.\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawReplaySkipping_ = function(gl, context, skippedFeaturesHash) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\n  featureIndex = this.startIndices.length - 2;\n  end = start = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      featureStart = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid]) {\n        if (start !== end) {\n          this.drawElements(gl, context, start, end);\n          gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        end = featureStart;\n      }\n      featureIndex--;\n      start = featureStart;\n    }\n    if (start !== end) {\n      this.drawElements(gl, context, start, end);\n      gl.clear(gl.DEPTH_BUFFER_BIT);\n    }\n    start = end = groupStart;\n  }\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.drawHitDetectionReplayOneByOne = function(gl, context, skippedFeaturesHash,\n    featureCallback, opt_hitExtent) {\n  var i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\n  featureIndex = this.startIndices.length - 2;\n  end = this.startIndices[featureIndex + 1];\n  for (i = this.styleIndices_.length - 1; i >= 0; --i) {\n    nextStyle = this.styles_[i];\n    this.setStrokeStyle_(gl, nextStyle[0], nextStyle[1], nextStyle[2]);\n    groupStart = this.styleIndices_[i];\n\n    while (featureIndex >= 0 &&\n        this.startIndices[featureIndex] >= groupStart) {\n      start = this.startIndices[featureIndex];\n      feature = this.startIndicesFeature[featureIndex];\n      featureUid = _ol_.getUid(feature).toString();\n\n      if (skippedFeaturesHash[featureUid] === undefined &&\n          feature.getGeometry() &&\n          (opt_hitExtent === undefined || _ol_extent_.intersects(\n              /** @type {Array<number>} */ (opt_hitExtent),\n              feature.getGeometry().getExtent()))) {\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.drawElements(gl, context, start, end);\n\n        var result = featureCallback(feature);\n\n        if (result) {\n          return result;\n        }\n\n      }\n      featureIndex--;\n      end = start;\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @private\n * @param {WebGLRenderingContext} gl gl.\n * @param {Array.<number>} color Color.\n * @param {number} lineWidth Line width.\n * @param {number} miterLimit Miter limit.\n */\n_ol_render_webgl_LineStringReplay_.prototype.setStrokeStyle_ = function(gl, color, lineWidth, miterLimit) {\n  gl.uniform4fv(this.defaultLocations_.u_color, color);\n  gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);\n  gl.uniform1f(this.defaultLocations_.u_miterLimit, miterLimit);\n};\n\n\n/**\n * @inheritDoc\n */\n_ol_render_webgl_LineStringReplay_.prototype.setFillStrokeStyle = function(fillStyle, strokeStyle) {\n  var strokeStyleLineCap = strokeStyle.getLineCap();\n  this.state_.lineCap = strokeStyleLineCap !== undefined ?\n    strokeStyleLineCap : _ol_render_webgl_.defaultLineCap;\n  var strokeStyleLineDash = strokeStyle.getLineDash();\n  this.state_.lineDash = strokeStyleLineDash ?\n    strokeStyleLineDash : _ol_render_webgl_.defaultLineDash;\n  var strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\n  this.state_.lineDashOffset = strokeStyleLineDashOffset ?\n    strokeStyleLineDashOffset : _ol_render_webgl_.defaultLineDashOffset;\n  var strokeStyleLineJoin = strokeStyle.getLineJoin();\n  this.state_.lineJoin = strokeStyleLineJoin !== undefined ?\n    strokeStyleLineJoin : _ol_render_webgl_.defaultLineJoin;\n  var strokeStyleColor = strokeStyle.getColor();\n  if (!(strokeStyleColor instanceof CanvasGradient) &&\n      !(strokeStyleColor instanceof CanvasPattern)) {\n    strokeStyleColor = _ol_color_.asArray(strokeStyleColor).map(function(c, i) {\n      return i != 3 ? c / 255 : c;\n    }) || _ol_render_webgl_.defaultStrokeStyle;\n  } else {\n    strokeStyleColor = _ol_render_webgl_.defaultStrokeStyle;\n  }\n  var strokeStyleWidth = strokeStyle.getWidth();\n  strokeStyleWidth = strokeStyleWidth !== undefined ?\n    strokeStyleWidth : _ol_render_webgl_.defaultLineWidth;\n  var strokeStyleMiterLimit = strokeStyle.getMiterLimit();\n  strokeStyleMiterLimit = strokeStyleMiterLimit !== undefined ?\n    strokeStyleMiterLimit : _ol_render_webgl_.defaultMiterLimit;\n  if (!this.state_.strokeColor || !_ol_array_.equals(this.state_.strokeColor, strokeStyleColor) ||\n      this.state_.lineWidth !== strokeStyleWidth || this.state_.miterLimit !== strokeStyleMiterLimit) {\n    this.state_.changed = true;\n    this.state_.strokeColor = strokeStyleColor;\n    this.state_.lineWidth = strokeStyleWidth;\n    this.state_.miterLimit = strokeStyleMiterLimit;\n    this.styles_.push([strokeStyleColor, strokeStyleWidth, strokeStyleMiterLimit]);\n  }\n};\n\n/**\n * @enum {number}\n * @private\n */\n_ol_render_webgl_LineStringReplay_.Instruction_ = {\n  ROUND: 2,\n  BEGIN_LINE: 3,\n  END_LINE: 5,\n  BEGIN_LINE_CAP: 7,\n  END_LINE_CAP: 11,\n  BEVEL_FIRST: 13,\n  BEVEL_SECOND: 17,\n  MITER_BOTTOM: 19,\n  MITER_TOP: 23\n};\nexport default _ol_render_webgl_LineStringReplay_;\n"]},"metadata":{},"sourceType":"module"}