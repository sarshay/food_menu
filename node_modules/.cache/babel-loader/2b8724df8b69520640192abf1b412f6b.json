{"ast":null,"code":"import _ol_ from '../../index.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_webgl_Immediate_ from '../../render/webgl/immediate.js';\nimport _ol_renderer_Layer_ from '../layer.js';\nimport _ol_renderer_webgl_defaultmapshader_ from '../webgl/defaultmapshader.js';\nimport _ol_renderer_webgl_defaultmapshader_Locations_ from '../webgl/defaultmapshader/locations.js';\nimport _ol_transform_ from '../../transform.js';\nimport _ol_vec_Mat4_ from '../../vec/mat4.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\nimport _ol_webgl_Context_ from '../../webgl/context.js';\n/**\n * @constructor\n * @abstract\n * @extends {ol.renderer.Layer}\n * @param {ol.renderer.webgl.Map} mapRenderer Map renderer.\n * @param {ol.layer.Layer} layer Layer.\n */\n\nvar _ol_renderer_webgl_Layer_ = function (mapRenderer, layer) {\n  _ol_renderer_Layer_.call(this, layer);\n  /**\n   * @protected\n   * @type {ol.renderer.webgl.Map}\n   */\n\n\n  this.mapRenderer = mapRenderer;\n  /**\n   * @private\n   * @type {ol.webgl.Buffer}\n   */\n\n  this.arrayBuffer_ = new _ol_webgl_Buffer_([-1, -1, 0, 0, 1, -1, 1, 0, -1, 1, 0, 1, 1, 1, 1, 1]);\n  /**\n   * @protected\n   * @type {WebGLTexture}\n   */\n\n  this.texture = null;\n  /**\n   * @protected\n   * @type {WebGLFramebuffer}\n   */\n\n  this.framebuffer = null;\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n\n  this.framebufferDimension = undefined;\n  /**\n   * @protected\n   * @type {ol.Transform}\n   */\n\n  this.texCoordMatrix = _ol_transform_.create();\n  /**\n   * @protected\n   * @type {ol.Transform}\n   */\n\n  this.projectionMatrix = _ol_transform_.create();\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n\n  this.tmpMat4_ = _ol_vec_Mat4_.create();\n  /**\n   * @private\n   * @type {ol.renderer.webgl.defaultmapshader.Locations}\n   */\n\n  this.defaultLocations_ = null;\n};\n\n_ol_.inherits(_ol_renderer_webgl_Layer_, _ol_renderer_Layer_);\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @param {number} framebufferDimension Framebuffer dimension.\n * @protected\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.bindFramebuffer = function (frameState, framebufferDimension) {\n  var gl = this.mapRenderer.getGL();\n\n  if (this.framebufferDimension === undefined || this.framebufferDimension != framebufferDimension) {\n    /**\n     * @param {WebGLRenderingContext} gl GL.\n     * @param {WebGLFramebuffer} framebuffer Framebuffer.\n     * @param {WebGLTexture} texture Texture.\n     */\n    var postRenderFunction = function (gl, framebuffer, texture) {\n      if (!gl.isContextLost()) {\n        gl.deleteFramebuffer(framebuffer);\n        gl.deleteTexture(texture);\n      }\n    }.bind(null, gl, this.framebuffer, this.texture);\n\n    frameState.postRenderFunctions.push(\n    /** @type {ol.PostRenderFunction} */\n    postRenderFunction);\n\n    var texture = _ol_webgl_Context_.createEmptyTexture(gl, framebufferDimension, framebufferDimension);\n\n    var framebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(_ol_webgl_.FRAMEBUFFER, _ol_webgl_.COLOR_ATTACHMENT0, _ol_webgl_.TEXTURE_2D, texture, 0);\n    this.texture = texture;\n    this.framebuffer = framebuffer;\n    this.framebufferDimension = framebufferDimension;\n  } else {\n    gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, this.framebuffer);\n  }\n};\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @param {ol.LayerState} layerState Layer state.\n * @param {ol.webgl.Context} context Context.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.composeFrame = function (frameState, layerState, context) {\n  this.dispatchComposeEvent_(_ol_render_EventType_.PRECOMPOSE, context, frameState);\n  context.bindBuffer(_ol_webgl_.ARRAY_BUFFER, this.arrayBuffer_);\n  var gl = context.getGL();\n  var fragmentShader = _ol_renderer_webgl_defaultmapshader_.fragment;\n  var vertexShader = _ol_renderer_webgl_defaultmapshader_.vertex;\n  var program = context.getProgram(fragmentShader, vertexShader);\n  var locations;\n\n  if (!this.defaultLocations_) {\n    locations = new _ol_renderer_webgl_defaultmapshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  if (context.useProgram(program)) {\n    gl.enableVertexAttribArray(locations.a_position);\n    gl.vertexAttribPointer(locations.a_position, 2, _ol_webgl_.FLOAT, false, 16, 0);\n    gl.enableVertexAttribArray(locations.a_texCoord);\n    gl.vertexAttribPointer(locations.a_texCoord, 2, _ol_webgl_.FLOAT, false, 16, 8);\n    gl.uniform1i(locations.u_texture, 0);\n  }\n\n  gl.uniformMatrix4fv(locations.u_texCoordMatrix, false, _ol_vec_Mat4_.fromTransform(this.tmpMat4_, this.getTexCoordMatrix()));\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false, _ol_vec_Mat4_.fromTransform(this.tmpMat4_, this.getProjectionMatrix()));\n  gl.uniform1f(locations.u_opacity, layerState.opacity);\n  gl.bindTexture(_ol_webgl_.TEXTURE_2D, this.getTexture());\n  gl.drawArrays(_ol_webgl_.TRIANGLE_STRIP, 0, 4);\n  this.dispatchComposeEvent_(_ol_render_EventType_.POSTCOMPOSE, context, frameState);\n};\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {ol.webgl.Context} context WebGL context.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.dispatchComposeEvent_ = function (type, context, frameState) {\n  var layer = this.getLayer();\n\n  if (layer.hasListener(type)) {\n    var viewState = frameState.viewState;\n    var resolution = viewState.resolution;\n    var pixelRatio = frameState.pixelRatio;\n    var extent = frameState.extent;\n    var center = viewState.center;\n    var rotation = viewState.rotation;\n    var size = frameState.size;\n    var render = new _ol_render_webgl_Immediate_(context, center, resolution, rotation, size, extent, pixelRatio);\n    var composeEvent = new _ol_render_Event_(type, render, frameState, null, context);\n    layer.dispatchEvent(composeEvent);\n  }\n};\n/**\n * @return {!ol.Transform} Matrix.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.getTexCoordMatrix = function () {\n  return this.texCoordMatrix;\n};\n/**\n * @return {WebGLTexture} Texture.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.getTexture = function () {\n  return this.texture;\n};\n/**\n * @return {!ol.Transform} Matrix.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.getProjectionMatrix = function () {\n  return this.projectionMatrix;\n};\n/**\n * Handle webglcontextlost.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.handleWebGLContextLost = function () {\n  this.texture = null;\n  this.framebuffer = null;\n  this.framebufferDimension = undefined;\n};\n/**\n * @abstract\n * @param {olx.FrameState} frameState Frame state.\n * @param {ol.LayerState} layerState Layer state.\n * @param {ol.webgl.Context} context Context.\n * @return {boolean} whether composeFrame should be called.\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.prepareFrame = function (frameState, layerState, context) {};\n/**\n * @abstract\n * @param {ol.Pixel} pixel Pixel.\n * @param {olx.FrameState} frameState FrameState.\n * @param {function(this: S, ol.layer.Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n\n\n_ol_renderer_webgl_Layer_.prototype.forEachLayerAtPixel = function (pixel, frameState, callback, thisArg) {};\n\nexport default _ol_renderer_webgl_Layer_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/webgl/layer.js"],"names":["_ol_","_ol_render_Event_","_ol_render_EventType_","_ol_render_webgl_Immediate_","_ol_renderer_Layer_","_ol_renderer_webgl_defaultmapshader_","_ol_renderer_webgl_defaultmapshader_Locations_","_ol_transform_","_ol_vec_Mat4_","_ol_webgl_","_ol_webgl_Buffer_","_ol_webgl_Context_","_ol_renderer_webgl_Layer_","mapRenderer","layer","call","arrayBuffer_","texture","framebuffer","framebufferDimension","undefined","texCoordMatrix","create","projectionMatrix","tmpMat4_","defaultLocations_","inherits","prototype","bindFramebuffer","frameState","gl","getGL","postRenderFunction","isContextLost","deleteFramebuffer","deleteTexture","bind","postRenderFunctions","push","createEmptyTexture","createFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","composeFrame","layerState","context","dispatchComposeEvent_","PRECOMPOSE","bindBuffer","ARRAY_BUFFER","fragmentShader","fragment","vertexShader","vertex","program","getProgram","locations","useProgram","enableVertexAttribArray","a_position","vertexAttribPointer","FLOAT","a_texCoord","uniform1i","u_texture","uniformMatrix4fv","u_texCoordMatrix","fromTransform","getTexCoordMatrix","u_projectionMatrix","getProjectionMatrix","uniform1f","u_opacity","opacity","bindTexture","getTexture","drawArrays","TRIANGLE_STRIP","POSTCOMPOSE","type","getLayer","hasListener","viewState","resolution","pixelRatio","extent","center","rotation","size","render","composeEvent","dispatchEvent","handleWebGLContextLost","prepareFrame","forEachLayerAtPixel","pixel","callback","thisArg"],"mappings":"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","sourcesContent":["import _ol_ from '../../index.js';\nimport _ol_render_Event_ from '../../render/event.js';\nimport _ol_render_EventType_ from '../../render/eventtype.js';\nimport _ol_render_webgl_Immediate_ from '../../render/webgl/immediate.js';\nimport _ol_renderer_Layer_ from '../layer.js';\nimport _ol_renderer_webgl_defaultmapshader_ from '../webgl/defaultmapshader.js';\nimport _ol_renderer_webgl_defaultmapshader_Locations_ from '../webgl/defaultmapshader/locations.js';\nimport _ol_transform_ from '../../transform.js';\nimport _ol_vec_Mat4_ from '../../vec/mat4.js';\nimport _ol_webgl_ from '../../webgl.js';\nimport _ol_webgl_Buffer_ from '../../webgl/buffer.js';\nimport _ol_webgl_Context_ from '../../webgl/context.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {ol.renderer.Layer}\n * @param {ol.renderer.webgl.Map} mapRenderer Map renderer.\n * @param {ol.layer.Layer} layer Layer.\n */\nvar _ol_renderer_webgl_Layer_ = function(mapRenderer, layer) {\n\n  _ol_renderer_Layer_.call(this, layer);\n\n  /**\n   * @protected\n   * @type {ol.renderer.webgl.Map}\n   */\n  this.mapRenderer = mapRenderer;\n\n  /**\n   * @private\n   * @type {ol.webgl.Buffer}\n   */\n  this.arrayBuffer_ = new _ol_webgl_Buffer_([\n    -1, -1, 0, 0,\n    1, -1, 1, 0,\n    -1, 1, 0, 1,\n    1, 1, 1, 1\n  ]);\n\n  /**\n   * @protected\n   * @type {WebGLTexture}\n   */\n  this.texture = null;\n\n  /**\n   * @protected\n   * @type {WebGLFramebuffer}\n   */\n  this.framebuffer = null;\n\n  /**\n   * @protected\n   * @type {number|undefined}\n   */\n  this.framebufferDimension = undefined;\n\n  /**\n   * @protected\n   * @type {ol.Transform}\n   */\n  this.texCoordMatrix = _ol_transform_.create();\n\n  /**\n   * @protected\n   * @type {ol.Transform}\n   */\n  this.projectionMatrix = _ol_transform_.create();\n\n  /**\n   * @type {Array.<number>}\n   * @private\n   */\n  this.tmpMat4_ = _ol_vec_Mat4_.create();\n\n  /**\n   * @private\n   * @type {ol.renderer.webgl.defaultmapshader.Locations}\n   */\n  this.defaultLocations_ = null;\n\n};\n\n_ol_.inherits(_ol_renderer_webgl_Layer_, _ol_renderer_Layer_);\n\n\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @param {number} framebufferDimension Framebuffer dimension.\n * @protected\n */\n_ol_renderer_webgl_Layer_.prototype.bindFramebuffer = function(frameState, framebufferDimension) {\n\n  var gl = this.mapRenderer.getGL();\n\n  if (this.framebufferDimension === undefined ||\n      this.framebufferDimension != framebufferDimension) {\n    /**\n     * @param {WebGLRenderingContext} gl GL.\n     * @param {WebGLFramebuffer} framebuffer Framebuffer.\n     * @param {WebGLTexture} texture Texture.\n     */\n    var postRenderFunction = function(gl, framebuffer, texture) {\n      if (!gl.isContextLost()) {\n        gl.deleteFramebuffer(framebuffer);\n        gl.deleteTexture(texture);\n      }\n    }.bind(null, gl, this.framebuffer, this.texture);\n\n    frameState.postRenderFunctions.push(\n        /** @type {ol.PostRenderFunction} */ (postRenderFunction)\n    );\n\n    var texture = _ol_webgl_Context_.createEmptyTexture(\n        gl, framebufferDimension, framebufferDimension);\n\n    var framebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(_ol_webgl_.FRAMEBUFFER,\n        _ol_webgl_.COLOR_ATTACHMENT0, _ol_webgl_.TEXTURE_2D, texture, 0);\n\n    this.texture = texture;\n    this.framebuffer = framebuffer;\n    this.framebufferDimension = framebufferDimension;\n\n  } else {\n    gl.bindFramebuffer(_ol_webgl_.FRAMEBUFFER, this.framebuffer);\n  }\n\n};\n\n\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @param {ol.LayerState} layerState Layer state.\n * @param {ol.webgl.Context} context Context.\n */\n_ol_renderer_webgl_Layer_.prototype.composeFrame = function(frameState, layerState, context) {\n\n  this.dispatchComposeEvent_(\n      _ol_render_EventType_.PRECOMPOSE, context, frameState);\n\n  context.bindBuffer(_ol_webgl_.ARRAY_BUFFER, this.arrayBuffer_);\n\n  var gl = context.getGL();\n\n  var fragmentShader = _ol_renderer_webgl_defaultmapshader_.fragment;\n  var vertexShader = _ol_renderer_webgl_defaultmapshader_.vertex;\n\n  var program = context.getProgram(fragmentShader, vertexShader);\n\n  var locations;\n  if (!this.defaultLocations_) {\n    locations = new _ol_renderer_webgl_defaultmapshader_Locations_(gl, program);\n    this.defaultLocations_ = locations;\n  } else {\n    locations = this.defaultLocations_;\n  }\n\n  if (context.useProgram(program)) {\n    gl.enableVertexAttribArray(locations.a_position);\n    gl.vertexAttribPointer(\n        locations.a_position, 2, _ol_webgl_.FLOAT, false, 16, 0);\n    gl.enableVertexAttribArray(locations.a_texCoord);\n    gl.vertexAttribPointer(\n        locations.a_texCoord, 2, _ol_webgl_.FLOAT, false, 16, 8);\n    gl.uniform1i(locations.u_texture, 0);\n  }\n\n  gl.uniformMatrix4fv(locations.u_texCoordMatrix, false,\n      _ol_vec_Mat4_.fromTransform(this.tmpMat4_, this.getTexCoordMatrix()));\n  gl.uniformMatrix4fv(locations.u_projectionMatrix, false,\n      _ol_vec_Mat4_.fromTransform(this.tmpMat4_, this.getProjectionMatrix()));\n  gl.uniform1f(locations.u_opacity, layerState.opacity);\n  gl.bindTexture(_ol_webgl_.TEXTURE_2D, this.getTexture());\n  gl.drawArrays(_ol_webgl_.TRIANGLE_STRIP, 0, 4);\n\n  this.dispatchComposeEvent_(\n      _ol_render_EventType_.POSTCOMPOSE, context, frameState);\n\n};\n\n\n/**\n * @param {ol.render.EventType} type Event type.\n * @param {ol.webgl.Context} context WebGL context.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_webgl_Layer_.prototype.dispatchComposeEvent_ = function(type, context, frameState) {\n  var layer = this.getLayer();\n  if (layer.hasListener(type)) {\n    var viewState = frameState.viewState;\n    var resolution = viewState.resolution;\n    var pixelRatio = frameState.pixelRatio;\n    var extent = frameState.extent;\n    var center = viewState.center;\n    var rotation = viewState.rotation;\n    var size = frameState.size;\n\n    var render = new _ol_render_webgl_Immediate_(\n        context, center, resolution, rotation, size, extent, pixelRatio);\n    var composeEvent = new _ol_render_Event_(\n        type, render, frameState, null, context);\n    layer.dispatchEvent(composeEvent);\n  }\n};\n\n\n/**\n * @return {!ol.Transform} Matrix.\n */\n_ol_renderer_webgl_Layer_.prototype.getTexCoordMatrix = function() {\n  return this.texCoordMatrix;\n};\n\n\n/**\n * @return {WebGLTexture} Texture.\n */\n_ol_renderer_webgl_Layer_.prototype.getTexture = function() {\n  return this.texture;\n};\n\n\n/**\n * @return {!ol.Transform} Matrix.\n */\n_ol_renderer_webgl_Layer_.prototype.getProjectionMatrix = function() {\n  return this.projectionMatrix;\n};\n\n\n/**\n * Handle webglcontextlost.\n */\n_ol_renderer_webgl_Layer_.prototype.handleWebGLContextLost = function() {\n  this.texture = null;\n  this.framebuffer = null;\n  this.framebufferDimension = undefined;\n};\n\n\n/**\n * @abstract\n * @param {olx.FrameState} frameState Frame state.\n * @param {ol.LayerState} layerState Layer state.\n * @param {ol.webgl.Context} context Context.\n * @return {boolean} whether composeFrame should be called.\n */\n_ol_renderer_webgl_Layer_.prototype.prepareFrame = function(frameState, layerState, context) {};\n\n\n/**\n * @abstract\n * @param {ol.Pixel} pixel Pixel.\n * @param {olx.FrameState} frameState FrameState.\n * @param {function(this: S, ol.layer.Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n_ol_renderer_webgl_Layer_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg) {};\nexport default _ol_renderer_webgl_Layer_;\n"]},"metadata":{},"sourceType":"module"}