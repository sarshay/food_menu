{"ast":null,"code":"import _ol_ from '../index.js';\nimport _ol_Disposable_ from '../disposable.js';\nimport _ol_events_ from '../events.js';\nimport _ol_events_EventType_ from '../events/eventtype.js';\nimport _ol_extent_ from '../extent.js';\nimport _ol_functions_ from '../functions.js';\nimport _ol_layer_Layer_ from '../layer/layer.js';\nimport _ol_plugins_ from '../plugins.js';\nimport _ol_style_ from '../style.js';\nimport _ol_transform_ from '../transform.js';\n/**\n * @constructor\n * @abstract\n * @extends {ol.Disposable}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @struct\n */\n\nvar _ol_renderer_Map_ = function (container, map) {\n  _ol_Disposable_.call(this);\n  /**\n   * @private\n   * @type {ol.PluggableMap}\n   */\n\n\n  this.map_ = map;\n  /**\n   * @private\n   * @type {Object.<string, ol.renderer.Layer>}\n   */\n\n  this.layerRenderers_ = {};\n  /**\n   * @private\n   * @type {Object.<string, ol.EventsKey>}\n   */\n\n  this.layerRendererListeners_ = {};\n};\n\n_ol_.inherits(_ol_renderer_Map_, _ol_Disposable_);\n/**\n * @param {olx.FrameState} frameState FrameState.\n * @protected\n */\n\n\n_ol_renderer_Map_.prototype.calculateMatrices2D = function (frameState) {\n  var viewState = frameState.viewState;\n  var coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n  var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n\n  _ol_transform_.compose(coordinateToPixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / viewState.resolution, -1 / viewState.resolution, -viewState.rotation, -viewState.center[0], -viewState.center[1]);\n\n  _ol_transform_.invert(_ol_transform_.setFromArray(pixelToCoordinateTransform, coordinateToPixelTransform));\n};\n/**\n * Removes all layer renderers.\n */\n\n\n_ol_renderer_Map_.prototype.removeLayerRenderers = function () {\n  for (var key in this.layerRenderers_) {\n    this.removeLayerRendererByKey_(key).dispose();\n  }\n};\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n\n_ol_renderer_Map_.expireIconCache_ = function (map, frameState) {\n  var cache = _ol_style_.iconImageCache;\n  cache.expire();\n};\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {olx.FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, (ol.Feature|ol.render.Feature),\n *     ol.layer.Layer): T} callback Feature callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n\n\n_ol_renderer_Map_.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, thisArg, layerFilter, thisArg2) {\n  var result;\n  var viewState = frameState.viewState;\n  var viewResolution = viewState.resolution;\n  /**\n   * @param {ol.Feature|ol.render.Feature} feature Feature.\n   * @param {ol.layer.Layer} layer Layer.\n   * @return {?} Callback result.\n   */\n\n  function forEachFeatureAtCoordinate(feature, layer) {\n    var key = _ol_.getUid(feature).toString();\n\n    var managed = frameState.layerStates[_ol_.getUid(layer)].managed;\n\n    if (!(key in frameState.skippedFeatureUids && !managed)) {\n      return callback.call(thisArg, feature, managed ? layer : null);\n    }\n  }\n\n  var projection = viewState.projection;\n  var translatedCoordinate = coordinate;\n\n  if (projection.canWrapX()) {\n    var projectionExtent = projection.getExtent();\n\n    var worldWidth = _ol_extent_.getWidth(projectionExtent);\n\n    var x = coordinate[0];\n\n    if (x < projectionExtent[0] || x > projectionExtent[2]) {\n      var worldsAway = Math.ceil((projectionExtent[0] - x) / worldWidth);\n      translatedCoordinate = [x + worldWidth * worldsAway, coordinate[1]];\n    }\n  }\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) && layerFilter.call(thisArg2, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n\n      if (layer.getSource()) {\n        result = layerRenderer.forEachFeatureAtCoordinate(layer.getSource().getWrapX() ? translatedCoordinate : coordinate, frameState, hitTolerance, forEachFeatureAtCoordinate, thisArg);\n      }\n\n      if (result) {\n        return result;\n      }\n    }\n  }\n\n  return undefined;\n};\n/**\n * @abstract\n * @param {ol.Pixel} pixel Pixel.\n * @param {olx.FrameState} frameState FrameState.\n * @param {function(this: S, ol.layer.Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n\n\n_ol_renderer_Map_.prototype.forEachLayerAtPixel = function (pixel, frameState, callback, thisArg, layerFilter, thisArg2) {};\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {olx.FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n * @return {boolean} Is there a feature at the given coordinate?\n * @template U\n */\n\n\n_ol_renderer_Map_.prototype.hasFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, _ol_functions_.TRUE, this, layerFilter, thisArg);\n  return hasFeature !== undefined;\n};\n/**\n * @param {ol.layer.Layer} layer Layer.\n * @protected\n * @return {ol.renderer.Layer} Layer renderer.\n */\n\n\n_ol_renderer_Map_.prototype.getLayerRenderer = function (layer) {\n  var layerKey = _ol_.getUid(layer).toString();\n\n  if (layerKey in this.layerRenderers_) {\n    return this.layerRenderers_[layerKey];\n  } else {\n    var layerRendererPlugins = _ol_plugins_.getLayerRendererPlugins();\n\n    var renderer;\n    var type = this.getType();\n\n    for (var i = 0, ii = layerRendererPlugins.length; i < ii; ++i) {\n      var plugin = layerRendererPlugins[i];\n\n      if (plugin['handles'](type, layer)) {\n        renderer = plugin['create'](this, layer);\n        break;\n      }\n    }\n\n    if (renderer) {\n      this.layerRenderers_[layerKey] = renderer;\n      this.layerRendererListeners_[layerKey] = _ol_events_.listen(renderer, _ol_events_EventType_.CHANGE, this.handleLayerRendererChange_, this);\n    } else {\n      throw new Error('Unable to create renderer for layer: ' + layer.getType());\n    }\n\n    return renderer;\n  }\n};\n/**\n * @param {string} layerKey Layer key.\n * @protected\n * @return {ol.renderer.Layer} Layer renderer.\n */\n\n\n_ol_renderer_Map_.prototype.getLayerRendererByKey = function (layerKey) {\n  return this.layerRenderers_[layerKey];\n};\n/**\n * @protected\n * @return {Object.<string, ol.renderer.Layer>} Layer renderers.\n */\n\n\n_ol_renderer_Map_.prototype.getLayerRenderers = function () {\n  return this.layerRenderers_;\n};\n/**\n * @return {ol.PluggableMap} Map.\n */\n\n\n_ol_renderer_Map_.prototype.getMap = function () {\n  return this.map_;\n};\n/**\n * @abstract\n * @return {ol.renderer.Type} Type\n */\n\n\n_ol_renderer_Map_.prototype.getType = function () {};\n/**\n * Handle changes in a layer renderer.\n * @private\n */\n\n\n_ol_renderer_Map_.prototype.handleLayerRendererChange_ = function () {\n  this.map_.render();\n};\n/**\n * @param {string} layerKey Layer key.\n * @return {ol.renderer.Layer} Layer renderer.\n * @private\n */\n\n\n_ol_renderer_Map_.prototype.removeLayerRendererByKey_ = function (layerKey) {\n  var layerRenderer = this.layerRenderers_[layerKey];\n  delete this.layerRenderers_[layerKey];\n\n  _ol_events_.unlistenByKey(this.layerRendererListeners_[layerKey]);\n\n  delete this.layerRendererListeners_[layerKey];\n  return layerRenderer;\n};\n/**\n * Render.\n * @param {?olx.FrameState} frameState Frame state.\n */\n\n\n_ol_renderer_Map_.prototype.renderFrame = _ol_.nullFunction;\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n\n_ol_renderer_Map_.prototype.removeUnusedLayerRenderers_ = function (map, frameState) {\n  var layerKey;\n\n  for (layerKey in this.layerRenderers_) {\n    if (!frameState || !(layerKey in frameState.layerStates)) {\n      this.removeLayerRendererByKey_(layerKey).dispose();\n    }\n  }\n};\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @protected\n */\n\n\n_ol_renderer_Map_.prototype.scheduleExpireIconCache = function (frameState) {\n  frameState.postRenderFunctions.push(\n  /** @type {ol.PostRenderFunction} */\n  _ol_renderer_Map_.expireIconCache_);\n};\n/**\n * @param {!olx.FrameState} frameState Frame state.\n * @protected\n */\n\n\n_ol_renderer_Map_.prototype.scheduleRemoveUnusedLayerRenderers = function (frameState) {\n  var layerKey;\n\n  for (layerKey in this.layerRenderers_) {\n    if (!(layerKey in frameState.layerStates)) {\n      frameState.postRenderFunctions.push(\n      /** @type {ol.PostRenderFunction} */\n      this.removeUnusedLayerRenderers_.bind(this));\n      return;\n    }\n  }\n};\n/**\n * @param {ol.LayerState} state1 First layer state.\n * @param {ol.LayerState} state2 Second layer state.\n * @return {number} The zIndex difference.\n */\n\n\n_ol_renderer_Map_.sortByZIndex = function (state1, state2) {\n  return state1.zIndex - state2.zIndex;\n};\n\nexport default _ol_renderer_Map_;","map":{"version":3,"sources":["C:/xampp/htdocs/food_menu/node_modules/ol/renderer/map.js"],"names":["_ol_","_ol_Disposable_","_ol_events_","_ol_events_EventType_","_ol_extent_","_ol_functions_","_ol_layer_Layer_","_ol_plugins_","_ol_style_","_ol_transform_","_ol_renderer_Map_","container","map","call","map_","layerRenderers_","layerRendererListeners_","inherits","prototype","calculateMatrices2D","frameState","viewState","coordinateToPixelTransform","pixelToCoordinateTransform","compose","size","resolution","rotation","center","invert","setFromArray","removeLayerRenderers","key","removeLayerRendererByKey_","dispose","expireIconCache_","cache","iconImageCache","expire","forEachFeatureAtCoordinate","coordinate","hitTolerance","callback","thisArg","layerFilter","thisArg2","result","viewResolution","feature","layer","getUid","toString","managed","layerStates","skippedFeatureUids","projection","translatedCoordinate","canWrapX","projectionExtent","getExtent","worldWidth","getWidth","x","worldsAway","Math","ceil","layerStatesArray","numLayers","length","i","layerState","visibleAtResolution","layerRenderer","getLayerRenderer","getSource","getWrapX","undefined","forEachLayerAtPixel","pixel","hasFeatureAtCoordinate","hasFeature","TRUE","layerKey","layerRendererPlugins","getLayerRendererPlugins","renderer","type","getType","ii","plugin","listen","CHANGE","handleLayerRendererChange_","Error","getLayerRendererByKey","getLayerRenderers","getMap","render","unlistenByKey","renderFrame","nullFunction","removeUnusedLayerRenderers_","scheduleExpireIconCache","postRenderFunctions","push","scheduleRemoveUnusedLayerRenderers","bind","sortByZIndex","state1","state2","zIndex"],"mappings":"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","sourcesContent":["import _ol_ from '../index.js';\nimport _ol_Disposable_ from '../disposable.js';\nimport _ol_events_ from '../events.js';\nimport _ol_events_EventType_ from '../events/eventtype.js';\nimport _ol_extent_ from '../extent.js';\nimport _ol_functions_ from '../functions.js';\nimport _ol_layer_Layer_ from '../layer/layer.js';\nimport _ol_plugins_ from '../plugins.js';\nimport _ol_style_ from '../style.js';\nimport _ol_transform_ from '../transform.js';\n\n/**\n * @constructor\n * @abstract\n * @extends {ol.Disposable}\n * @param {Element} container Container.\n * @param {ol.PluggableMap} map Map.\n * @struct\n */\nvar _ol_renderer_Map_ = function(container, map) {\n\n  _ol_Disposable_.call(this);\n\n\n  /**\n   * @private\n   * @type {ol.PluggableMap}\n   */\n  this.map_ = map;\n\n  /**\n   * @private\n   * @type {Object.<string, ol.renderer.Layer>}\n   */\n  this.layerRenderers_ = {};\n\n  /**\n   * @private\n   * @type {Object.<string, ol.EventsKey>}\n   */\n  this.layerRendererListeners_ = {};\n\n};\n\n_ol_.inherits(_ol_renderer_Map_, _ol_Disposable_);\n\n\n/**\n * @param {olx.FrameState} frameState FrameState.\n * @protected\n */\n_ol_renderer_Map_.prototype.calculateMatrices2D = function(frameState) {\n  var viewState = frameState.viewState;\n  var coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n  var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n\n  _ol_transform_.compose(coordinateToPixelTransform,\n      frameState.size[0] / 2, frameState.size[1] / 2,\n      1 / viewState.resolution, -1 / viewState.resolution,\n      -viewState.rotation,\n      -viewState.center[0], -viewState.center[1]);\n\n  _ol_transform_.invert(\n      _ol_transform_.setFromArray(pixelToCoordinateTransform, coordinateToPixelTransform));\n};\n\n\n/**\n * Removes all layer renderers.\n */\n_ol_renderer_Map_.prototype.removeLayerRenderers = function() {\n  for (var key in this.layerRenderers_) {\n    this.removeLayerRendererByKey_(key).dispose();\n  }\n};\n\n\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_Map_.expireIconCache_ = function(map, frameState) {\n  var cache = _ol_style_.iconImageCache;\n  cache.expire();\n};\n\n\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {olx.FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: S, (ol.Feature|ol.render.Feature),\n *     ol.layer.Layer): T} callback Feature callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n_ol_renderer_Map_.prototype.forEachFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, callback, thisArg,\n    layerFilter, thisArg2) {\n  var result;\n  var viewState = frameState.viewState;\n  var viewResolution = viewState.resolution;\n\n  /**\n   * @param {ol.Feature|ol.render.Feature} feature Feature.\n   * @param {ol.layer.Layer} layer Layer.\n   * @return {?} Callback result.\n   */\n  function forEachFeatureAtCoordinate(feature, layer) {\n    var key = _ol_.getUid(feature).toString();\n    var managed = frameState.layerStates[_ol_.getUid(layer)].managed;\n    if (!(key in frameState.skippedFeatureUids && !managed)) {\n      return callback.call(thisArg, feature, managed ? layer : null);\n    }\n  }\n\n  var projection = viewState.projection;\n\n  var translatedCoordinate = coordinate;\n  if (projection.canWrapX()) {\n    var projectionExtent = projection.getExtent();\n    var worldWidth = _ol_extent_.getWidth(projectionExtent);\n    var x = coordinate[0];\n    if (x < projectionExtent[0] || x > projectionExtent[2]) {\n      var worldsAway = Math.ceil((projectionExtent[0] - x) / worldWidth);\n      translatedCoordinate = [x + worldWidth * worldsAway, coordinate[1]];\n    }\n  }\n\n  var layerStates = frameState.layerStatesArray;\n  var numLayers = layerStates.length;\n  var i;\n  for (i = numLayers - 1; i >= 0; --i) {\n    var layerState = layerStates[i];\n    var layer = layerState.layer;\n    if (_ol_layer_Layer_.visibleAtResolution(layerState, viewResolution) &&\n        layerFilter.call(thisArg2, layer)) {\n      var layerRenderer = this.getLayerRenderer(layer);\n      if (layer.getSource()) {\n        result = layerRenderer.forEachFeatureAtCoordinate(\n            layer.getSource().getWrapX() ? translatedCoordinate : coordinate,\n            frameState, hitTolerance, forEachFeatureAtCoordinate, thisArg);\n      }\n      if (result) {\n        return result;\n      }\n    }\n  }\n  return undefined;\n};\n\n\n/**\n * @abstract\n * @param {ol.Pixel} pixel Pixel.\n * @param {olx.FrameState} frameState FrameState.\n * @param {function(this: S, ol.layer.Layer, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n *     callback.\n * @param {S} thisArg Value to use as `this` when executing `callback`.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n * @return {T|undefined} Callback result.\n * @template S,T,U\n */\n_ol_renderer_Map_.prototype.forEachLayerAtPixel = function(pixel, frameState, callback, thisArg,\n    layerFilter, thisArg2) {};\n\n\n/**\n * @param {ol.Coordinate} coordinate Coordinate.\n * @param {olx.FrameState} frameState FrameState.\n * @param {number} hitTolerance Hit tolerance in pixels.\n * @param {function(this: U, ol.layer.Layer): boolean} layerFilter Layer filter\n *     function, only layers which are visible and for which this function\n *     returns `true` will be tested for features.  By default, all visible\n *     layers will be tested.\n * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n * @return {boolean} Is there a feature at the given coordinate?\n * @template U\n */\n_ol_renderer_Map_.prototype.hasFeatureAtCoordinate = function(coordinate, frameState, hitTolerance, layerFilter, thisArg) {\n  var hasFeature = this.forEachFeatureAtCoordinate(\n      coordinate, frameState, hitTolerance, _ol_functions_.TRUE, this, layerFilter, thisArg);\n\n  return hasFeature !== undefined;\n};\n\n\n/**\n * @param {ol.layer.Layer} layer Layer.\n * @protected\n * @return {ol.renderer.Layer} Layer renderer.\n */\n_ol_renderer_Map_.prototype.getLayerRenderer = function(layer) {\n  var layerKey = _ol_.getUid(layer).toString();\n  if (layerKey in this.layerRenderers_) {\n    return this.layerRenderers_[layerKey];\n  } else {\n    var layerRendererPlugins = _ol_plugins_.getLayerRendererPlugins();\n    var renderer;\n    var type = this.getType();\n    for (var i = 0, ii = layerRendererPlugins.length; i < ii; ++i) {\n      var plugin = layerRendererPlugins[i];\n      if (plugin['handles'](type, layer)) {\n        renderer = plugin['create'](this, layer);\n        break;\n      }\n    }\n    if (renderer) {\n      this.layerRenderers_[layerKey] = renderer;\n      this.layerRendererListeners_[layerKey] = _ol_events_.listen(renderer,\n          _ol_events_EventType_.CHANGE, this.handleLayerRendererChange_, this);\n    } else {\n      throw new Error('Unable to create renderer for layer: ' + layer.getType());\n    }\n    return renderer;\n  }\n};\n\n\n/**\n * @param {string} layerKey Layer key.\n * @protected\n * @return {ol.renderer.Layer} Layer renderer.\n */\n_ol_renderer_Map_.prototype.getLayerRendererByKey = function(layerKey) {\n  return this.layerRenderers_[layerKey];\n};\n\n\n/**\n * @protected\n * @return {Object.<string, ol.renderer.Layer>} Layer renderers.\n */\n_ol_renderer_Map_.prototype.getLayerRenderers = function() {\n  return this.layerRenderers_;\n};\n\n\n/**\n * @return {ol.PluggableMap} Map.\n */\n_ol_renderer_Map_.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * @abstract\n * @return {ol.renderer.Type} Type\n */\n_ol_renderer_Map_.prototype.getType = function() {};\n\n\n/**\n * Handle changes in a layer renderer.\n * @private\n */\n_ol_renderer_Map_.prototype.handleLayerRendererChange_ = function() {\n  this.map_.render();\n};\n\n\n/**\n * @param {string} layerKey Layer key.\n * @return {ol.renderer.Layer} Layer renderer.\n * @private\n */\n_ol_renderer_Map_.prototype.removeLayerRendererByKey_ = function(layerKey) {\n  var layerRenderer = this.layerRenderers_[layerKey];\n  delete this.layerRenderers_[layerKey];\n\n  _ol_events_.unlistenByKey(this.layerRendererListeners_[layerKey]);\n  delete this.layerRendererListeners_[layerKey];\n\n  return layerRenderer;\n};\n\n\n/**\n * Render.\n * @param {?olx.FrameState} frameState Frame state.\n */\n_ol_renderer_Map_.prototype.renderFrame = _ol_.nullFunction;\n\n\n/**\n * @param {ol.PluggableMap} map Map.\n * @param {olx.FrameState} frameState Frame state.\n * @private\n */\n_ol_renderer_Map_.prototype.removeUnusedLayerRenderers_ = function(map, frameState) {\n  var layerKey;\n  for (layerKey in this.layerRenderers_) {\n    if (!frameState || !(layerKey in frameState.layerStates)) {\n      this.removeLayerRendererByKey_(layerKey).dispose();\n    }\n  }\n};\n\n\n/**\n * @param {olx.FrameState} frameState Frame state.\n * @protected\n */\n_ol_renderer_Map_.prototype.scheduleExpireIconCache = function(frameState) {\n  frameState.postRenderFunctions.push(\n      /** @type {ol.PostRenderFunction} */ (_ol_renderer_Map_.expireIconCache_)\n  );\n};\n\n\n/**\n * @param {!olx.FrameState} frameState Frame state.\n * @protected\n */\n_ol_renderer_Map_.prototype.scheduleRemoveUnusedLayerRenderers = function(frameState) {\n  var layerKey;\n  for (layerKey in this.layerRenderers_) {\n    if (!(layerKey in frameState.layerStates)) {\n      frameState.postRenderFunctions.push(\n          /** @type {ol.PostRenderFunction} */ (this.removeUnusedLayerRenderers_.bind(this))\n      );\n      return;\n    }\n  }\n};\n\n\n/**\n * @param {ol.LayerState} state1 First layer state.\n * @param {ol.LayerState} state2 Second layer state.\n * @return {number} The zIndex difference.\n */\n_ol_renderer_Map_.sortByZIndex = function(state1, state2) {\n  return state1.zIndex - state2.zIndex;\n};\nexport default _ol_renderer_Map_;\n"]},"metadata":{},"sourceType":"module"}